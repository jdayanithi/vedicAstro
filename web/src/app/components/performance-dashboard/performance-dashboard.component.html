<div class="performance-dashboard">
  <div class="dashboard-header">
    <h2>üöÄ Performance Dashboard</h2>
    <div class="dashboard-controls">
      <select [(ngModel)]="selectedType" (change)="onTypeFilterChange()" class="type-filter">
        <option *ngFor="let type of metricTypes" [value]="type.value">{{ type.label }}</option>
      </select>
      <button (click)="clearMetrics()" class="btn btn-warning">Clear Metrics</button>
      <button (click)="exportMetrics()" class="btn btn-primary">Export Data</button>
    </div>
  </div>

  <!-- Performance Stats Summary -->
  <div class="stats-grid" *ngIf="stats">
    <div class="stat-card">
      <div class="stat-title">Total Measurements</div>
      <div class="stat-value">{{ stats.totalMeasurements }}</div>
    </div>
    <div class="stat-card">
      <div class="stat-title">Average Duration</div>
      <div class="stat-value">{{ formatDuration(stats.averageDuration) }}</div>
    </div>
    <div class="stat-card" *ngIf="stats.slowestOperation">
      <div class="stat-title">Slowest Operation</div>
      <div class="stat-value" [style.color]="getPerformanceColor(stats.slowestOperation.duration)">
        {{ stats.slowestOperation.name }}
      </div>
      <div class="stat-detail">{{ formatDuration(stats.slowestOperation.duration) }}</div>
    </div>
    <div class="stat-card" *ngIf="stats.fastestOperation">
      <div class="stat-title">Fastest Operation</div>
      <div class="stat-value" [style.color]="getPerformanceColor(stats.fastestOperation.duration)">
        {{ stats.fastestOperation.name }}
      </div>
      <div class="stat-detail">{{ formatDuration(stats.fastestOperation.duration) }}</div>
    </div>
  </div>

  <!-- Memory Stats -->
  <div class="memory-stats" *ngIf="memoryStats">
    <h3>Memory Usage</h3>
    <div class="memory-grid">
      <div class="memory-item">
        <span>Used JS Heap:</span>
        <span>{{ formatBytes(memoryStats.usedJSHeapSize) }}</span>
      </div>
      <div class="memory-item">
        <span>Total JS Heap:</span>
        <span>{{ formatBytes(memoryStats.totalJSHeapSize) }}</span>
      </div>
      <div class="memory-item">
        <span>JS Heap Limit:</span>
        <span>{{ formatBytes(memoryStats.jsHeapSizeLimit) }}</span>
      </div>
    </div>
  </div>

  <!-- Recent Metrics Table -->
  <div class="metrics-table-container">
    <h3>Recent Performance Metrics ({{ filteredMetrics.length }} items)</h3>
    <div class="table-wrapper">
      <table class="metrics-table">
        <thead>
          <tr>
            <th>Time</th>
            <th>Operation</th>
            <th>Type</th>
            <th>Duration</th>
            <th>Status</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let metric of filteredMetrics | slice:0:50; trackBy: trackByFn" 
              [class.slow]="metric.duration > 100"
              [class.critical]="metric.duration > 500">
            <td>{{ formatTimestamp(metric.timestamp) }}</td>
            <td class="operation-name">{{ metric.name }}</td>
            <td>
              <span class="type-badge" [class]="'type-' + metric.type">
                {{ metric.type }}
              </span>
            </td>
            <td [style.color]="getPerformanceColor(metric.duration)">
              {{ formatDuration(metric.duration) }}
            </td>
            <td>
              <span class="status-indicator" 
                    [class.success]="!metric.details?.error"
                    [class.error]="metric.details?.error">
                {{ metric.details?.error ? 'Error' : 'Success' }}
              </span>
            </td>
            <td class="details-cell">
              <details *ngIf="metric.details">
                <summary>View Details</summary>
                <pre>{{ metric.details | json }}</pre>
              </details>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Performance Tips -->
  <div class="performance-tips" *ngIf="stats && stats.totalMeasurements > 10">
    <h3>Performance Insights</h3>
    <div class="tips-grid">
      <div class="tip-card" *ngIf="getSlowOperations().length > 0">
        <h4>üêå Slow Operations Detected</h4>
        <ul>
          <li *ngFor="let op of getSlowOperations() | slice:0:3">
            {{ op.name }} ({{ formatDuration(op.duration) }})
          </li>
        </ul>
      </div>
      <div class="tip-card" *ngIf="getApiMetrics().length > 0">
        <h4>üåê API Performance</h4>
        <p>Average API response time: {{ formatDuration(getAverageApiTime()) }}</p>
        <p>Total API calls: {{ getApiMetrics().length }}</p>
      </div>
    </div>
  </div>
</div>

<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>ЁЯО╡ родрпЖропрпНро╡ ро╡ро┤ро┐рокро╛роЯрпБ рокро╛роЯро▓рпНроХро│рпН</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleBookmark()">
        <ion-icon [name]="isBookmarked ? 'bookmark' : 'bookmark-outline'" color="light"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">ЁЯО╡ родрпЖропрпНро╡ ро╡ро┤ро┐рокро╛роЯрпБ рокро╛роЯро▓рпНроХро│рпН</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <div class="hero-icon">ЁЯО╡</div>
      <h1>родрпЖропрпНро╡ ро╡ро┤ро┐рокро╛роЯрпБ рокро╛роЯро▓рпНроХро│рпН</h1>
      <p>ро╡ро┐роиро╛ропроХро░рпН роЕроХро╡ро▓рпН, роЪроХро▓роХро▓ро╛ро╡ро▓рпНро▓ро┐ рооро╛ро▓рпИ, роЪро╖рпНроЯро┐ роХро╡роЪроорпН рооро▒рпНро▒рпБроорпН рокро▓ рокрпБройро┐род рокро╛роЯро▓рпНроХро│рпН</p>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="search-container">
    <ion-searchbar 
      [(ngModel)]="searchTerm" 
      (ionInput)="searchPadals()" 
      placeholder="рокро╛роЯро▓рпНроХро│рпИ родрпЗроЯрпБроЩрпНроХро│рпН..."
      show-clear-button="focus">
    </ion-searchbar>
  </div>

  <!-- Categories Grid -->
  <div class="categories-grid">
    <div 
      *ngFor="let category of padalCategories; trackBy: trackByPadalId" 
      class="category-card"
      [class.expanded]="expandedCategories[category.id]"
      (click)="toggleCategory(category.id)">
      
      <div class="category-header">
        <div class="category-icon">{{category.icon}}</div>
        <div class="category-info">
          <h3>{{category.name}}</h3>
          <p>{{category.mantras.length}} рокро╛роЯро▓рпНроХро│рпН</p>
        </div>
        <ion-icon 
          [name]="expandedCategories[category.id] ? 'chevron-up' : 'chevron-down'"
          class="expand-icon">
        </ion-icon>
      </div>

      <!-- Expandable Content -->
      <div 
        class="category-content" 
        *ngIf="expandedCategories[category.id]"
        [@slideInOut]>
        
        <div 
          *ngFor="let padal of category.mantras; trackBy: trackByPadalId" 
          class="padal-card"
          (click)="openPadalDetail(padal)">
          
          <div class="padal-header">
            <h4>{{padal.name}}</h4>
            <div class="padal-meta">
              <span class="deity">{{padal.deity}}</span>
              <span class="author" *ngIf="padal.author">- {{padal.author}}</span>
            </div>
          </div>

          <div class="padal-preview">
            <p>{{padal.text | slice:0:100}}...</p>
          </div>

          <div class="padal-info">
            <span class="verses" *ngIf="padal.verses">{{padal.verses}} рокро╛роЯро▓рпНроХро│рпН</span>
            <span class="duration" *ngIf="padal.duration">{{padal.duration}}</span>
          </div>

          <div class="padal-actions" (click)="$event.stopPropagation()">
            <ion-button 
              fill="clear" 
              size="small" 
              (click)="toggleFavoritePadal(padal)">
              <ion-icon 
                [name]="isFavoritePadal(padal) ? 'heart' : 'heart-outline'" 
                [color]="isFavoritePadal(padal) ? 'danger' : 'medium'">
              </ion-icon>
            </ion-button>

            <ion-button 
              fill="clear" 
              size="small" 
              (click)="sharePadal(padal)">
              <ion-icon name="share-outline" color="medium"></ion-icon>
            </ion-button>

            <ion-button 
              fill="clear" 
              size="small" 
              (click)="copyPadal(padal)">
              <ion-icon name="copy-outline" color="medium"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Detail Modal -->
  <ion-modal #detailModal [isOpen]="false" [presentingElement]="null">
    <ng-template>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>{{selectedPadal?.name}}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closePadalDetail()">
              <ion-icon name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="modal-content">
        <div *ngIf="selectedPadal" class="padal-detail">
          
          <div class="padal-header-detail">
            <h1>{{selectedPadal.name}}</h1>
            <div class="padal-meta-detail">
              <p><strong>родрпЖропрпНро╡роорпН:</strong> {{selectedPadal.deity}}</p>
              <p *ngIf="selectedPadal.author"><strong>роЖроЪро┐ро░ро┐ропро░рпН:</strong> {{selectedPadal.author}}</p>
              <p *ngIf="selectedPadal.verses"><strong>рокро╛роЯро▓рпНроХро│рпН:</strong> {{selectedPadal.verses}}</p>
            </div>
          </div>

          <div class="padal-text-section">
            <h3>рокро╛роЯро▓рпН</h3>
            <div class="padal-text">
              <p>{{selectedPadal.text}}</p>
            </div>
          </div>

          <div class="padal-meaning-section" *ngIf="selectedPadal.meaning">
            <h3>рокрпКро░рпБро│рпН</h3>
            <p>{{selectedPadal.meaning}}</p>
          </div>

          <div class="padal-benefits-section">
            <h3>рокро▓ройрпНроХро│рпН</h3>
            <ion-list>
              <ion-item *ngFor="let benefit of selectedPadal.benefits">
                <ion-icon name="checkmark-circle" slot="start" color="success"></ion-icon>
                <ion-label>{{benefit}}</ion-label>
              </ion-item>
            </ion-list>
          </div>

          <div class="padal-practice-section">
            <h3>рокро╛роЯрпБроорпН роорпБро▒рпИ</h3>
            <ion-list>
              <ion-item *ngIf="selectedPadal.howToSing">
                <ion-icon name="musical-notes" slot="start" color="primary"></ion-icon>
                <ion-label>
                  <h4>роОрокрпНрокроЯро┐ рокро╛роЯрпБро╡родрпБ</h4>
                  <p>{{selectedPadal.howToSing}}</p>
                </ion-label>
              </ion-item>
              <ion-item *ngIf="selectedPadal.bestTime">
                <ion-icon name="time" slot="start" color="secondary"></ion-icon>
                <ion-label>
                  <h4>роЪро┐ро▒роирпНрод роирпЗро░роорпН</h4>
                  <p>{{selectedPadal.bestTime}}</p>
                </ion-label>
              </ion-item>
              <ion-item *ngIf="selectedPadal.duration">
                <ion-icon name="timer" slot="start" color="tertiary"></ion-icon>
                <ion-label>
                  <h4>роХро╛ро▓ роЕро│ро╡рпБ</h4>
                  <p>{{selectedPadal.duration}}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </div>

          <div class="padal-links-section" *ngIf="selectedPadal.webLink || selectedPadal.videoLink">
            <h3>роорпЗро▓рпБроорпН родроХро╡ро▓рпНроХро│рпН</h3>
            <ion-list>
              <ion-item *ngIf="selectedPadal.webLink" button (click)="openWebLink(selectedPadal)">
                <ion-icon name="link" slot="start" color="primary"></ion-icon>
                <ion-label>
                  <h4>роорпБро┤рпБроорпИропро╛рой рокро╛роЯро▓рпН (ро╡рпЖрокрпНроЪрпИроЯрпН)</h4>
                  <p>роорпБро┤рпБ рокро╛роЯро▓рпИрокрпН рокроЯро┐роХрпНроХ роЗроЩрпНроХрпЗ роХро┐ро│ро┐роХрпН роЪрпЖропрпНропрпБроЩрпНроХро│рпН</p>
                </ion-label>
                <ion-icon name="open-outline" slot="end" color="medium"></ion-icon>
              </ion-item>
              <ion-item *ngIf="selectedPadal.videoLink" button (click)="openVideoLink(selectedPadal)">
                <ion-icon name="play-circle" slot="start" color="danger"></ion-icon>
                <ion-label>
                  <h4>ро╡рпАроЯро┐ропрпЛ (YouTube)</h4>
                  <p>рокро╛роЯро▓рпИ роХрпЗроЯрпНроХ роЗроЩрпНроХрпЗ роХро┐ро│ро┐роХрпН роЪрпЖропрпНропрпБроЩрпНроХро│рпН</p>
                </ion-label>
                <ion-icon name="open-outline" slot="end" color="medium"></ion-icon>
              </ion-item>
            </ion-list>
          </div>

          <!-- Individual Abhirami Anthathi Songs Section -->
          <div class="individual-songs-section" *ngIf="selectedPadal?.id === 'abhirami_anthathi' && selectedPadal?.individualSongs">
            <h3>роЕрокро┐ро░ро╛рооро┐ роЕроирпНродро╛родро┐ рокро╛роЯро▓рпНроХро│рпН (1-20)</h3>
            <div class="songs-grid">
              <div 
                *ngFor="let song of selectedPadal.individualSongs?.slice(0, 20); let i = index" 
                class="individual-song-card"
                (click)="viewSongDetail(song)">
                <div class="song-header">
                  <h4>рокро╛роЯро▓рпН {{i + 1}}</h4>
                  <p class="song-preview">{{song.text | slice:0:50}}...</p>
                </div>
                <div class="song-benefits">
                  <ion-chip 
                    *ngFor="let benefit of song.benefits?.slice(0, 2)" 
                    color="primary" 
                    outline="true">
                    {{benefit}}
                  </ion-chip>
                </div>
              </div>
            </div>
            
            <ion-button 
              expand="block" 
              fill="outline" 
              (click)="viewAllAbhiramiSongs()"
              class="view-all-songs-btn">
              <ion-icon name="list" slot="start"></ion-icon>
              роЕройрпИродрпНродрпБ 100 рокро╛роЯро▓рпНроХро│рпИропрпБроорпН роХро╛рогрпНроХ
            </ion-button>
          </div>

          <!-- Special Features Section -->
          <div class="special-features-section" *ngIf="selectedPadal?.specialFeatures">
            <h3>роЪро┐ро▒рокрпНрокрпБ роЕроорпНроЪроЩрпНроХро│рпН</h3>
            <ion-list>
              <ion-item *ngFor="let feature of selectedPadal.specialFeatures">
                <ion-icon name="star" slot="start" color="warning"></ion-icon>
                <ion-label>{{feature}}</ion-label>
              </ion-item>
            </ion-list>
          </div>

          <div class="padal-actions-detail">
            <ion-button 
              expand="block" 
              fill="outline" 
              (click)="toggleFavoritePadal(selectedPadal)">
              <ion-icon 
                [name]="isFavoritePadal(selectedPadal) ? 'heart' : 'heart-outline'" 
                slot="start">
              </ion-icon>
              {{isFavoritePadal(selectedPadal) ? 'ро╡ро┐ро░рпБрокрпНрокродрпНродро┐ро▓ро┐ро░рпБроирпНродрпБ роирпАроХрпНроХрпБ' : 'ро╡ро┐ро░рпБрокрпНрокродрпНродро┐ро▓рпН роЪрпЗро░рпН'}}
            </ion-button>

            <ion-button 
              expand="block" 
              fill="outline" 
              (click)="sharePadal(selectedPadal)">
              <ion-icon name="share" slot="start"></ion-icon>
              рокроХро┐ро░рпН
            </ion-button>

            <ion-button 
              expand="block" 
              fill="outline" 
              (click)="copyPadal(selectedPadal)">
              <ion-icon name="copy" slot="start"></ion-icon>
              роироХро▓рпН роОроЯрпБ
            </ion-button>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Preview Modal -->
  <ion-modal #previewModal [isOpen]="false" class="preview-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{selectedPadalForPreview?.name}}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closePadalPreview()">
              <ion-icon name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content>
        <div *ngIf="selectedPadalForPreview" class="preview-content">
          <p><strong>родрпЖропрпНро╡роорпН:</strong> {{selectedPadalForPreview.deity}}</p>
          <div class="preview-text">
            <p>{{selectedPadalForPreview.text | slice:0:200}}...</p>
          </div>
          <ion-button 
            expand="block" 
            (click)="openPadalDetail(selectedPadalForPreview)">
            роорпБро┤рпБ рокро╛роЯро▓рпИрокрпН рокро╛ро░рпНроХрпНроХ
          </ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>

<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/concepts"></ion-back-button>
    </ion-buttons>
    <ion-title class="tamil-text">ЁЯФо роЬрпЛродро┐роЯ ро╡ро┐родро┐роХро│рпН</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleBookmark()">
        <ion-icon [name]="isBookmarked ? 'bookmark' : 'bookmark-outline'" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Hero Header -->
  <div class="hero-header" *ngIf="!selectedCategory && !searchTerm">
    <div class="hero-content">
      <div class="hero-icon-wrapper">
        <ion-icon name="book" class="floating-icon"></ion-icon>
      </div>
      <h1 class="tamil-text">ЁЯФо роЬрпЛродро┐роЯ ро╡ро┐родро┐роХро│рпН</h1>
      <p class="subtitle">ро╡ро╛ро┤рпНроХрпНроХрпИропро┐ройрпН роЕройрпИродрпНродрпБ роЕроорпНроЪроЩрпНроХро│рпБроХрпНроХро╛рой роЕроЯро┐рокрпНрокроЯрпИ ро╡ро┐родро┐роХро│рпН</p>
      <div class="meta-chips">
        <ion-chip color="success" size="small">
          <ion-icon name="checkmark-circle" slot="start"></ion-icon>
          <ion-label>ESSENTIAL</ion-label>
        </ion-chip>
        <ion-chip color="warning" size="small">
          <ion-icon name="star" slot="start"></ion-icon>
          <ion-label>{{ rules.length }} ро╡ро┐родро┐роХро│рпН</ion-label>
        </ion-chip>
        <ion-chip color="tertiary" size="small">
          <ion-icon name="shield-checkmark" slot="start"></ion-icon>
          <ion-label>роЬрпЛродро┐роЯ роЕроЯро┐рокрпНрокроЯрпИ</ion-label>
        </ion-chip>
      </div>
    </div>
  </div>

  <!-- Category Grid -->
  <div class="category-section" *ngIf="!selectedCategory && !searchTerm">
    <div class="section-header">
      <ion-icon name="grid" color="primary"></ion-icon>
      <h2 class="tamil-text section-title">ро╡ро┐родро┐ ро╡роХрпИроХро│рпН</h2>
    </div>
    <ion-grid>
      <ion-row>
        <ion-col size="12" size-md="6" *ngFor="let category of categories; let i = index">
          <ion-card class="category-card" (click)="selectCategory(category.id)" [style.animation-delay]="i * 100 + 'ms'">
            <ion-card-content>
              <div class="category-icon-wrapper">
                <ion-icon [name]="category.icon" [style.color]="category.color"></ion-icon>
              </div>
              <h3 class="tamil-text category-title">{{ category.name }}</h3>
              <p class="category-subtitle">{{ category.nameEnglish }}</p>
              <p class="category-count">
                <ion-icon name="documents" color="medium"></ion-icon>
                {{ getRuleCount(category.id) }} ро╡ро┐родро┐роХро│рпН
              </p>
              <div class="category-arrow">
                <ion-icon name="arrow-forward-circle" color="primary"></ion-icon>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- Search Section -->
  <div class="search-section" *ngIf="!selectedCategory && !searchTerm">
    <ion-card>
      <ion-card-content>
        <div class="search-header">
          <ion-icon name="search" class="search-icon"></ion-icon>
          <h3 class="tamil-text search-title">ро╡ро┐родро┐роХро│рпН родрпЗроЯрпБроЩрпНроХро│рпН</h3>
        </div>
        <ion-searchbar
          [(ngModel)]="searchTerm"
          placeholder="роЙродро╛ро░рогроорпН: роХро▓рпНро╡ро┐, родро┐ро░рпБроорогроорпН, роирпЛропрпН, ро╡рпЗро▓рпИ, роЪройро┐, роХрпБро░рпБ..."
          (ionInput)="searchRules()"
          show-clear-button="focus">
        </ion-searchbar>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Rules List -->
  <div *ngIf="filteredRules.length > 0" class="rules-section">
    <div class="section-header" *ngIf="selectedCategory || searchTerm">
      <ion-buttons>
        <ion-button fill="clear" (click)="goBack()">
          <ion-icon name="arrow-back" slot="start"></ion-icon>
          <ion-label>рокро┐ройрпН роЪрпЖро▓рпНро▓рпБроЩрпНроХро│рпН</ion-label>
        </ion-button>
      </ion-buttons>
      <h2 class="tamil-text">
        <span *ngIf="selectedCategory">{{ getCategoryName(selectedCategory) }} ро╡ро┐родро┐роХро│рпН</span>
        <span *ngIf="searchTerm && !selectedCategory">родрпЗроЯро▓рпН роорпБроЯро┐ро╡рпБроХро│рпН</span>
      </h2>
    </div>

    <ion-grid>
      <ion-row>
        <ion-col size="12" size-md="6" size-lg="4" *ngFor="let rule of filteredRules; let i = index">
          <ion-card class="rule-card" [style.animation-delay]="i * 50 + 'ms'">
            <ion-card-content>
              <div class="rule-category-chip">
                <ion-chip [color]="getCategoryColor(rule.category)" size="small">
                  <ion-icon [name]="getCategoryIcon(rule.category)" slot="start"></ion-icon>
                  <ion-label>{{ getCategoryName(rule.category) }}</ion-label>
                </ion-chip>
              </div>
              
              <h3 class="tamil-text rule-title">{{ rule.rule }}</h3>
              <p class="rule-title-english">{{ rule.ruleEnglish }}</p>
              
              <div class="rule-details">
                <div class="planets-section" *ngIf="rule.planets?.length">
                  <h4 class="detail-header">
                    <ion-icon name="planet" color="warning"></ion-icon>
                    роЪроорпНрокроирпНродрокрпНрокроЯрпНроЯ роХро┐ро░роХроЩрпНроХро│рпН
                  </h4>
                  <div class="planets-list">
                    <ion-chip *ngFor="let planet of rule.planets" color="warning" size="small">
                      <ion-label>{{ planet }}</ion-label>
                    </ion-chip>
                  </div>
                </div>

                <div class="condition-section" *ngIf="rule.condition">
                  <h4 class="detail-header">
                    <ion-icon name="clipboard" color="primary"></ion-icon>
                    роиро┐рокроирпНродройрпИ
                  </h4>
                  <p class="tamil-text condition-text">{{ rule.condition }}</p>
                </div>

                <div class="result-section" *ngIf="rule.result">
                  <h4 class="detail-header">
                    <ion-icon name="sparkles" color="success"></ion-icon>
                    рокро▓ройрпН
                  </h4>
                  <p class="tamil-text result-text">{{ rule.result }}</p>
                </div>

                <div class="tags-section" *ngIf="rule.tags?.length">
                  <div class="tags-wrapper">
                    <ion-chip *ngFor="let tag of rule.tags" color="tertiary" size="small">
                      <ion-icon name="pricetag" slot="start"></ion-icon>
                      <ion-label>{{ tag }}</ion-label>
                    </ion-chip>
                  </div>
                </div>
              </div>

              <div class="rule-actions">
                <ion-button fill="clear" size="small" color="primary" (click)="shareRule(rule)">
                  <ion-icon name="share-social" slot="start"></ion-icon>
                  Share
                </ion-button>
                <ion-button fill="clear" size="small" color="medium" (click)="copyRule(rule)">
                  <ion-icon name="copy" slot="start"></ion-icon>
                  Copy
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- No Results -->
  <div *ngIf="!isLoading && filteredRules.length === 0 && (searchTerm || selectedCategory)" class="no-results">
    <ion-icon name="search" color="medium"></ion-icon>
    <h3>роорпБроЯро┐ро╡рпБроХро│рпН роЗро▓рпНро▓рпИ</h3>
    <p *ngIf="searchTerm">
      "{{ searchTerm }}" роХрпНроХро╛рой родрпЗроЯро▓ро┐ро▓рпН роОродрпБро╡рпБроорпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ
    </p>
    <p *ngIf="selectedCategory && !searchTerm">
      роЗроирпНрод ро╡роХрпИропро┐ро▓рпН роЗройрпНройрпБроорпН ро╡ро┐родро┐роХро│рпН роЪрпЗро░рпНроХрпНроХрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ
    </p>
    <ion-button fill="clear" (click)="clearSearch()">
      <ion-icon name="refresh" slot="start"></ion-icon>
      роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН
    </ion-button>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p class="tamil-text">ро╡ро┐родро┐роХро│рпИ роПро▒рпНро▒рпБроХро┐ро▒родрпБ...</p>
  </div>

</ion-content>

import './polyfills.server.mjs';
import{a as Vn}from"./chunk-MYRNSIYN.mjs";import{a as $e}from"./chunk-6A3K3BSM.mjs";import{a as Bn}from"./chunk-5IP63SBN.mjs";import{a as Ue,b as Nn}from"./chunk-BHWVXLCB.mjs";import{a as He,b as Ke,c as je}from"./chunk-P7WQKVYS.mjs";import{a as Rn}from"./chunk-SX6NWBXY.mjs";import{a as Ln,b as On}from"./chunk-NFHMUV43.mjs";import{a as ze}from"./chunk-OCQ4I3D6.mjs";import{b as Dn,c as Fn}from"./chunk-V4J2KMOZ.mjs";import{a as on,b as an}from"./chunk-7ZOCCRSD.mjs";import{a as dn,c as Be}from"./chunk-GR3LLAU7.mjs";import{a as qt,b as Ht}from"./chunk-QEKNV4IY.mjs";import{a as Ie,b as Ee,c as Me,e as ke,g as se}from"./chunk-E6ZNZ33O.mjs";import{a as Nt,d as _e}from"./chunk-KXFPEN3X.mjs";import{a as An}from"./chunk-SCHKAQX2.mjs";import{b as Pn}from"./chunk-BMK6653C.mjs";import{a as kn,b as wn}from"./chunk-ROAWYUGG.mjs";import{a as Cn,b as bn,c as Tn,d as Sn,e as In,f as En,g as Mn,h as st}from"./chunk-QDJP6RQO.mjs";import{a as cn,b as mn,c as pn,d as un,e as gn,f as fn,g as hn,h as _n,i as xn,j as yn,k as vn,l as Re,m as qe}from"./chunk-2Z4EWZLB.mjs";import{b as Le,c as Oe,d as De,e as Fe}from"./chunk-MF5VOUAK.mjs";import{b as rn,d as sn,e as ln,l as Ne,m as Ve}from"./chunk-MT5RISYH.mjs";import{f as ve}from"./chunk-XPM65WGF.mjs";import{a as we,b as en,c as tn,e as nn,h as Pe,i as Ae}from"./chunk-ZWJQV4AG.mjs";import{Ba as Se,Ca as ae,D as Bt,Da as re,I as Rt,X as xe,ba as ie,da as ye,ea as oe,ga as Ce,ia as I,j as Vt,ka as be,la as Kt,na as Te,pa as jt,qa as zt,ra as $t,sa as Ut,ta as Gt,ua as Qt,va as Wt,wa as Zt,xa as Xt,ya as Yt,za as Jt}from"./chunk-S5MTBZC4.mjs";import{Ab as x,C as G,Cb as g,Db as Je,E as _t,Eb as q,Ec as ge,Fa as Xe,Fb as wt,Fc as fe,Gb as Pt,Gc as J,H as Q,Hb as et,Ib as tt,Ic as he,Jc as Ft,Kc as it,La as Ct,Lb as Z,Ma as bt,Mb as r,Nb as w,Oa as d,Ob as C,Oc as ee,Pa as f,Pb as At,Q as B,R,Ra as Tt,Tb as ue,Ub as F,Va as St,Vb as Lt,Xb as N,Y as me,Yb as z,Zb as nt,_ as H,_a as It,a as ce,ab as W,ba as M,db as p,ea as O,f as We,fa as pe,ga as K,hb as Ye,i as ft,ib as c,id as ot,jb as Et,jd as at,k as S,kb as j,la as Ze,lb as Mt,ma as y,md as te,na as v,nb as kt,nc as X,nd as ne,oa as xt,pd as rt,ra as yt,rb as a,rc as Y,sb as n,sc as Ot,tb as _,ub as P,va as D,vb as A,x as ht,xb as k,y as U,za as vt,zc as Dt}from"./chunk-T4Y5KKE3.mjs";import{a as $,b as de,h as L}from"./chunk-5XUXGTUW.mjs";var mi=()=>[5,10,20];function pi(o,t){if(o&1&&(a(0,"mat-option",16),r(1),n()),o&2){let e=t.$implicit;c("value",e.categoryId),d(),C(" ",e.name," ")}}function ui(o,t){if(o&1&&(a(0,"mat-option",16),r(1),n()),o&2){let e=t.$implicit;c("value",e.courseId),d(),C(" ",e.title," ")}}function gi(o,t){if(o&1&&(a(0,"mat-option",16),r(1),n()),o&2){let e=t.$implicit,i=g();c("value",e),d(),C(" ",i.displayTopicFn(e)," ")}}function fi(o,t){if(o&1&&(a(0,"span",33),r(1),n()),o&2){let e=g(2);d(),At(" (",e.selectedCourse.title," - ",e.selectedCategory.name,") ")}}function hi(o,t){o&1&&(a(0,"th",34),r(1,"ID"),n())}function _i(o,t){if(o&1&&(a(0,"td",35),r(1),n()),o&2){let e=t.$implicit;d(),w(e.lessonId)}}function xi(o,t){o&1&&(a(0,"th",34),r(1,"Order"),n())}function yi(o,t){if(o&1&&(a(0,"td",35),r(1),n()),o&2){let e=t.$implicit;d(),w(e.orderNumber)}}function vi(o,t){o&1&&(a(0,"th",34),r(1,"Title"),n())}function Ci(o,t){if(o&1&&(a(0,"td",35),r(1),n()),o&2){let e=t.$implicit;d(),w(e.title)}}function bi(o,t){o&1&&(a(0,"th",34),r(1,"Content Type"),n())}function Ti(o,t){if(o&1&&(a(0,"td",35)(1,"span",36),r(2),N(3,"titlecase"),n()()),o&2){let e=t.$implicit;d(),Mt("content-type-"+e.contentType),d(),C(" ",z(3,3,e.contentType)," ")}}function Si(o,t){o&1&&(a(0,"th",34),r(1,"Duration"),n())}function Ii(o,t){if(o&1&&(a(0,"td",35),r(1),n()),o&2){let e=t.$implicit;d(),C(" ",e.durationMinutes?e.durationMinutes+" min":"-"," ")}}function Ei(o,t){o&1&&(a(0,"th",34),r(1,"Free"),n())}function Mi(o,t){if(o&1&&(a(0,"td",35)(1,"mat-icon",37),r(2),n()()),o&2){let e=t.$implicit;d(),c("color",e.isFree?"primary":"warn"),d(),C(" ",e.isFree?"check_circle":"lock"," ")}}function ki(o,t){o&1&&(a(0,"th",34),r(1,"Created"),n())}function wi(o,t){if(o&1&&(a(0,"td",35),r(1),N(2,"date"),n()),o&2){let e=t.$implicit;d(),w(nt(2,1,e.createdAt,"short"))}}function Pi(o,t){o&1&&(a(0,"th",34),r(1,"Actions"),n())}function Ai(o,t){if(o&1){let e=k();a(0,"td",35)(1,"button",38),x("click",function(){let s=y(e).$implicit,l=g(2);return v(l.viewLessonDetails(s))}),a(2,"mat-icon"),r(3,"visibility"),n()(),a(4,"button",39),x("click",function(){let s=y(e).$implicit,l=g(2);return v(l.navigateToEditLesson(s.lessonId))}),a(5,"mat-icon"),r(6,"edit"),n()(),a(7,"button",40),x("click",function(){let s=y(e).$implicit,l=g(2);return v(l.deleteLesson(s.lessonId))}),a(8,"mat-icon"),r(9,"delete"),n()()()}}function Li(o,t){o&1&&_(0,"tr",41)}function Oi(o,t){o&1&&_(0,"tr",42)}function Di(o,t){o&1&&(a(0,"div",43)(1,"p"),r(2,"No lessons found for this topic."),n()())}function Fi(o,t){if(o&1){let e=k();a(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),r(3),p(4,fi,2,2,"span",17),n()(),a(5,"mat-card-content")(6,"table",18),P(7,19),p(8,hi,2,0,"th",20)(9,_i,2,1,"td",21),A(),P(10,22),p(11,xi,2,0,"th",20)(12,yi,2,1,"td",21),A(),P(13,23),p(14,vi,2,0,"th",20)(15,Ci,2,1,"td",21),A(),P(16,24),p(17,bi,2,0,"th",20)(18,Ti,4,5,"td",21),A(),P(19,25),p(20,Si,2,0,"th",20)(21,Ii,2,1,"td",21),A(),P(22,26),p(23,Ei,2,0,"th",20)(24,Mi,3,2,"td",21),A(),P(25,27),p(26,ki,2,0,"th",20)(27,wi,3,4,"td",21),A(),P(28,28),p(29,Pi,2,0,"th",20)(30,Ai,10,0,"td",21),A(),p(31,Li,1,0,"tr",29)(32,Oi,1,0,"tr",30),n(),a(33,"mat-paginator",31),x("page",function(s){y(e);let l=g();return v(l.onPageChange(s))}),n(),p(34,Di,3,0,"div",32),n()()}if(o&2){let e=g();d(3),C(" Lessons for: ",e.selectedTopic.title," "),d(),c("ngIf",e.selectedCourse&&e.selectedCategory),d(2),c("dataSource",e.pagedLessons),d(25),c("matHeaderRowDef",e.displayedColumns),d(),c("matRowDefColumns",e.displayedColumns),d(),c("length",e.lessons.length)("pageSize",e.pageSize)("pageIndex",e.pageIndex)("pageSizeOptions",Lt(10,mi)),d(),c("ngIf",e.lessons.length===0)}}function Ni(o,t){o&1&&(a(0,"mat-card",44)(1,"mat-card-content")(2,"div",43)(3,"mat-icon"),r(4,"play_lesson"),n(),a(5,"p"),r(6,"Please select a topic to view its lessons."),n()()()())}function Vi(o,t){if(o&1&&(a(0,"div",3)(1,"strong"),r(2,"Duration:"),n(),r(3),n()),o&2){let e=g();d(3),C(" ",e.data.lesson.durationMinutes," minutes ")}}function Bi(o,t){if(o&1&&(a(0,"div",3)(1,"strong"),r(2,"Content URL:"),n(),a(3,"a",12),r(4),n()()),o&2){let e=g();d(3),c("href",e.data.lesson.contentUrl,bt),d(),C(" ",e.data.lesson.contentUrl," ")}}function Ri(o,t){if(o&1&&(a(0,"div",3)(1,"strong"),r(2,"Created:"),n(),r(3),N(4,"date"),n()),o&2){let e=g();d(3),C(" ",nt(4,1,e.parseDate(e.data.lesson.createdAt),"medium")," ")}}function qi(o,t){if(o&1&&(a(0,"div",13)(1,"h3"),r(2,"Description"),n(),_(3,"div",14),n()),o&2){let e=g();d(3),c("innerHTML",e.data.lesson.description,Ct)}}var Ge=class o{constructor(t,e,i,s,l,u,h){this.lessonService=t;this.topicService=e;this.courseService=i;this.categoryService=s;this.snackBar=l;this.router=u;this.dialog=h}lessons=[];selectedTopic=null;selectedCourse=null;selectedCategory=null;categories=[];filteredCourses=[];allTopics=[];categoryControl=new Te("");courseControl=new Te("");topicSearchControl=new Te("");filteredTopics=S([]);displayedColumns=["lessonId","orderNumber","title","contentType","duration","isFree","createdAt","actions"];pageIndex=0;pageSize=10;get pagedLessons(){let t=this.pageIndex*this.pageSize;return this.lessons.slice(t,t+this.pageSize)}ngOnInit(){Promise.all([this.loadCategoriesAsync(),this.loadAllTopicsAsync()]).then(()=>{this.setupTopicAutocomplete(),this.restoreSelectedTopic()})}loadCategories(){this.categoryService.getCategories().subscribe({next:t=>{this.categories=t},error:()=>{this.snackBar.open("Error loading categories","Close",{duration:3e3})}})}loadAllTopics(){this.topicService.getAllTopics().subscribe({next:t=>{this.allTopics=t},error:()=>{this.snackBar.open("Error loading topics","Close",{duration:3e3})}})}loadCategoriesAsync(){return new Promise((t,e)=>{this.categoryService.getCategories().subscribe({next:i=>{this.categories=i,t()},error:i=>{this.snackBar.open("Error loading categories","Close",{duration:3e3}),e(i)}})})}loadAllTopicsAsync(){return new Promise((t,e)=>{this.topicService.getAllTopics().subscribe({next:i=>{this.allTopics=i,t()},error:i=>{this.snackBar.open("Error loading topics","Close",{duration:3e3}),e(i)}})})}onCategorySelected(t){let e=t.value;this.selectedCategory=e&&this.categories.find(i=>i.categoryId===e)||null,this.courseControl.setValue(""),this.topicSearchControl.setValue(""),this.selectedCourse=null,this.selectedTopic=null,this.lessons=[],e?this.loadCoursesByCategory(e):this.filteredCourses=[]}onCourseSelected(t){let e=t.value;this.selectedCourse=e&&this.filteredCourses.find(i=>i.courseId===e)||null,this.topicSearchControl.setValue(""),this.selectedTopic=null,this.lessons=[],this.setupTopicAutocomplete()}loadCoursesByCategory(t){this.courseService.getAllCourses().subscribe({next:e=>{this.filteredCourses=e.filter(i=>i.categoryId===t)},error:()=>{this.snackBar.open("Error loading courses","Close",{duration:3e3})}})}restoreSelectedTopic(){let t=history.state;if(t&&t.selectedTopic){let e=t.selectedTopic;this.selectedTopic=e,this.topicSearchControl.setValue(e),t.selectedCategory&&(this.selectedCategory=t.selectedCategory,this.selectedCategory&&this.selectedCategory.categoryId&&this.categoryControl.setValue(this.selectedCategory.categoryId)),t.selectedCourse?(this.selectedCourse=t.selectedCourse,this.selectedCourse&&(this.loadCoursesByCategory(this.selectedCourse.categoryId),this.courseControl.setValue(this.selectedCourse.courseId))):e.courseId&&this.courseService.getCourseById(e.courseId).subscribe({next:i=>{if(this.selectedCourse=i,this.courseControl.setValue(i.courseId),!this.selectedCategory&&i.categoryId){let s=this.categories.find(l=>l.categoryId===i.categoryId);s&&s.categoryId&&(this.selectedCategory=s,this.categoryControl.setValue(s.categoryId),this.loadCoursesByCategory(s.categoryId))}}}),this.loadLessons()}}setupTopicAutocomplete(){this.filteredTopics=this.topicSearchControl.valueChanges.pipe(B(""),G(300),Q(),R(t=>this._filterTopics(t||"")))}_filterTopics(t){let e=typeof t=="string"?t:t?.title||"";if(!e||e.trim()==="")return this.courseControl.value?S(this.allTopics.filter(s=>s.courseId===this.courseControl.value)):S(this.allTopics);let i=this.allTopics.filter(s=>s.title.toLowerCase().includes(e.toLowerCase()));return this.courseControl.value&&(i=i.filter(s=>s.courseId===this.courseControl.value)),S(i)}displayTopicFn=t=>{if(!t)return"";let e=t.title||"Untitled",i=t.topicId||"N/A",s="";return t.courseId&&this.selectedCourse&&(s=` - ${this.selectedCourse.title}`),`${e} (ID: ${i})${s}`};onTopicSelected(t){let e=t.option.value;this.selectedTopic=e,!this.selectedCourse&&e.courseId&&this.courseService.getCourseById(e.courseId).subscribe({next:i=>{if(this.selectedCourse=i,this.courseControl.setValue(i.courseId),!this.selectedCategory&&i.categoryId){let s=this.categories.find(l=>l.categoryId===i.categoryId);s&&s.categoryId&&(this.selectedCategory=s,this.categoryControl.setValue(s.categoryId),this.loadCoursesByCategory(s.categoryId))}}}),this.loadLessons()}navigateToAddLesson(){this.selectedTopic&&this.router.navigate(["lessons/add"],{state:{selectedTopic:this.selectedTopic,selectedCourse:this.selectedCourse,selectedCategory:this.selectedCategory}})}navigateToEditLesson(t){this.router.navigate(["lessons/update",t],{state:{selectedTopic:this.selectedTopic,selectedCourse:this.selectedCourse,selectedCategory:this.selectedCategory}})}loadLessons(){this.selectedTopic&&this.lessonService.getLessonsByTopicId(this.selectedTopic.topicId).subscribe({next:t=>{this.lessons=t.map(e=>de($({},e),{createdAt:lt(e.createdAt),updatedAt:lt(e.updatedAt)})),this.pageIndex=0},error:()=>{this.snackBar.open("Error loading lessons","Close",{duration:3e3})}})}onPageChange(t){this.pageIndex=t.pageIndex,this.pageSize=t.pageSize}deleteLesson(t){confirm("Are you sure you want to delete this lesson?")&&this.lessonService.deleteLesson(t).subscribe({next:()=>{this.loadLessons(),this.snackBar.open("Lesson deleted successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error deleting lesson","Close",{duration:3e3})}})}viewLessonDetails(t){this.dialog.open(dt,{width:"800px",maxHeight:"90vh",data:{lesson:t}})}static \u0275fac=function(e){return new(e||o)(f(Ue),f($e),f(ze),f(An),f(De),f(_e),f(Tn))};static \u0275cmp=O({type:o,selectors:[["app-lesson-list"]],standalone:!0,features:[F],decls:35,vars:14,consts:[["auto","matAutocomplete"],[1,"container"],[1,"header"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"filter-card"],[1,"filter-row"],[1,"filter-field"],[3,"selectionChange","formControl"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"selectionChange","formControl","disabled"],[1,"full-width"],["type","text","matInput","","placeholder","Type to search topics...",3,"formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[4,"ngIf"],["class","placeholder-card",4,"ngIf"],[3,"value"],["class","topic-context",4,"ngIf"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","lessonId"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","orderNumber"],["matColumnDef","title"],["matColumnDef","contentType"],["matColumnDef","duration"],["matColumnDef","isFree"],["matColumnDef","createdAt"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize","pageIndex","pageSizeOptions"],["class","no-data",4,"ngIf"],[1,"topic-context"],["mat-header-cell",""],["mat-cell",""],[1,"content-type-badge"],[3,"color"],["mat-icon-button","","color","accent","matTooltip","View Details",3,"click"],["mat-icon-button","","color","primary","matTooltip","Edit",3,"click"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click"],["mat-header-row",""],["mat-row",""],[1,"no-data"],[1,"placeholder-card"]],template:function(e,i){if(e&1){let s=k();a(0,"div",1)(1,"div",2)(2,"h1"),r(3,"Lessons"),n(),a(4,"button",3),x("click",function(){return y(s),v(i.navigateToAddLesson())}),a(5,"mat-icon"),r(6,"add"),n(),r(7," Add Lesson "),n()(),a(8,"mat-card",4)(9,"mat-card-content")(10,"div",5)(11,"mat-form-field",6)(12,"mat-label"),r(13,"Filter by Category"),n(),a(14,"mat-select",7),x("selectionChange",function(u){return y(s),v(i.onCategorySelected(u))}),a(15,"mat-option",8),r(16,"All Categories"),n(),p(17,pi,2,2,"mat-option",9),n()(),a(18,"mat-form-field",6)(19,"mat-label"),r(20,"Filter by Course"),n(),a(21,"mat-select",10),x("selectionChange",function(u){return y(s),v(i.onCourseSelected(u))}),a(22,"mat-option",8),r(23,"All Courses"),n(),p(24,ui,2,2,"mat-option",9),n()()(),a(25,"mat-form-field",11)(26,"mat-label"),r(27,"Search Topic"),n(),_(28,"input",12),a(29,"mat-autocomplete",13,0),x("optionSelected",function(u){return y(s),v(i.onTopicSelected(u))}),p(31,gi,2,2,"mat-option",9),N(32,"async"),n()()()(),p(33,Fi,35,11,"mat-card",14)(34,Ni,7,0,"mat-card",15),n()}if(e&2){let s=Z(30);d(4),c("disabled",!i.selectedTopic),d(10),c("formControl",i.categoryControl),d(3),c("ngForOf",i.categories),d(4),c("formControl",i.courseControl)("disabled",!i.categoryControl.value),d(3),c("ngForOf",i.filteredCourses),d(4),c("formControl",i.topicSearchControl)("matAutocomplete",s),d(),c("displayWith",i.displayTopicFn),d(2),c("ngForOf",z(32,12,i.filteredTopics)),d(2),c("ngIf",i.selectedTopic),d(),c("ngIf",!i.selectedTopic)}},dependencies:[ee,fe,J,he,Ft,it,vn,cn,pn,hn,un,mn,_n,gn,fn,xn,yn,oe,ie,ye,re,ae,se,Ie,Me,ke,Ee,Ae,Pe,we,Ve,Ne,xe,je,He,Ke,Oe,Le,st,Be,qe,Re,Fe,Pn,wn,kn,Se,Ce,be,$t],styles:[".container[_ngcontent-%COMP%]{padding:20px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.full-width[_ngcontent-%COMP%]{width:100%}.filter-card[_ngcontent-%COMP%]{margin-bottom:20px}.filter-row[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:16px}.filter-field[_ngcontent-%COMP%]{flex:1}.topic-context[_ngcontent-%COMP%]{font-size:14px;color:#666;font-weight:400}.no-data[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:16px}.placeholder-card[_ngcontent-%COMP%]{margin-top:20px}.content-type-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500}.content-type-video[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.content-type-article[_ngcontent-%COMP%]{background-color:#f3e5f5;color:#7b1fa2}.content-type-quiz[_ngcontent-%COMP%]{background-color:#fff3e0;color:#f57c00}.content-type-exercise[_ngcontent-%COMP%]{background-color:#e8f5e8;color:#388e3c}"]})};function lt(o){if(!o)return null;if(o instanceof Date)return o;if(typeof o=="string"&&o.includes(",")){let e=o.split(",").map(Number);if(e.length>=3)return new Date(e[0],e[1]-1,e[2],e[3]||0,e[4]||0,e[5]||0)}let t=new Date(o);return isNaN(t.getTime())?null:t}var dt=class o{constructor(t,e){this.dialogRef=t;this.data=e}parseDate(t){return lt(t)}static \u0275fac=function(e){return new(e||o)(f(Cn),f(bn))};static \u0275cmp=O({type:o,selectors:[["app-lesson-detail-dialog"]],standalone:!0,features:[F],decls:37,vars:14,consts:[["mat-dialog-title",""],[1,"dialog-content"],[1,"lesson-info"],[1,"info-row"],[1,"id-badge"],[1,"order-badge"],[1,"content-type-badge",3,"ngClass"],["class","info-row",4,"ngIf"],[1,"free-badge"],["class","lesson-content",4,"ngIf"],["align","end"],["mat-button","","mat-dialog-close",""],["target","_blank",1,"content-link",3,"href"],[1,"lesson-content"],[1,"content-text",3,"innerHTML"]],template:function(e,i){e&1&&(a(0,"h2",0)(1,"mat-icon"),r(2,"visibility"),n(),r(3," Lesson Details "),n(),a(4,"mat-dialog-content",1)(5,"div",2)(6,"div",3)(7,"strong"),r(8,"ID:"),n(),a(9,"span",4),r(10),n()(),a(11,"div",3)(12,"strong"),r(13,"Title:"),n(),r(14),n(),a(15,"div",3)(16,"strong"),r(17,"Order:"),n(),a(18,"span",5),r(19),n()(),a(20,"div",3)(21,"strong"),r(22,"Content Type:"),n(),a(23,"span",6),r(24),n()(),p(25,Vi,4,1,"div",7),a(26,"div",3)(27,"strong"),r(28,"Free:"),n(),a(29,"span",8),r(30),n()(),p(31,Bi,5,2,"div",7)(32,Ri,5,4,"div",7),n(),p(33,qi,4,1,"div",9),n(),a(34,"mat-dialog-actions",10)(35,"button",11),r(36,"Close"),n()()),e&2&&(d(10),w(i.data.lesson.lessonId),d(4),C(" ",i.data.lesson.title," "),d(5),w(i.data.lesson.orderNumber),d(4),c("ngClass","content-type-"+i.data.lesson.contentType),d(),C(" ",i.data.lesson.contentType," "),d(),c("ngIf",i.data.lesson.durationMinutes),d(4),j("is-free",i.data.lesson.isFree)("is-paid",!i.data.lesson.isFree),d(),C(" ",i.data.lesson.isFree?"Yes":"No"," "),d(),c("ngIf",i.data.lesson.contentUrl),d(),c("ngIf",i.data.lesson.createdAt),d(),c("ngIf",i.data.lesson.description))},dependencies:[ee,ge,J,it,st,Sn,In,Mn,En,oe,ie,re,ae,se],styles:[".dialog-content[_ngcontent-%COMP%]{max-height:70vh;overflow-y:auto}.lesson-info[_ngcontent-%COMP%]{margin-bottom:24px}.info-row[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:12px;gap:8px}.info-row[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{min-width:120px;color:#333}.id-badge[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2;padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500;font-family:Courier New,monospace}.order-badge[_ngcontent-%COMP%]{background-color:#fff3e0;color:#f57c00;padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500}.content-type-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500;text-transform:uppercase}.content-type-video[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.content-type-article[_ngcontent-%COMP%]{background-color:#f3e5f5;color:#7b1fa2}.content-type-quiz[_ngcontent-%COMP%]{background-color:#fff3e0;color:#f57c00}.content-type-exercise[_ngcontent-%COMP%]{background-color:#e8f5e8;color:#388e3c}.free-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500}.is-free[_ngcontent-%COMP%]{background-color:#e8f5e8;color:#2e7d32}.is-paid[_ngcontent-%COMP%]{background-color:#fff3e0;color:#f57c00}.content-link[_ngcontent-%COMP%]{color:#1976d2;text-decoration:none;word-break:break-all}.content-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.lesson-content[_ngcontent-%COMP%]{margin-bottom:24px}.lesson-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:12px;color:#333}.content-text[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:16px;border-radius:4px;border-left:4px solid #2196f3;max-height:300px;overflow-y:auto}"]})};var qn=new H("CdkAccordion");var Ki=0,Hn=(()=>{class o{get expanded(){return this._expanded}set expanded(e){if(this._expanded!==e){if(this._expanded=e,this.expandedChange.emit(e),e){this.opened.emit();let i=this.accordion?this.accordion.id:this.id;this._expansionDispatcher.notify(this.id,i)}else this.closed.emit();this._changeDetectorRef.markForCheck()}}constructor(e,i,s){this.accordion=e,this._changeDetectorRef=i,this._expansionDispatcher=s,this._openCloseAllSubscription=ce.EMPTY,this.closed=new D,this.opened=new D,this.destroyed=new D,this.expandedChange=new D,this.id=`cdk-accordion-child-${Ki++}`,this._expanded=!1,this.disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=s.listen((l,u)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===u&&this.id!==l&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(e=>{this.disabled||(this.expanded=e)})}static{this.\u0275fac=function(i){return new(i||o)(f(qn,12),f(X),f(ve))}}static{this.\u0275dir=K({type:o,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:[2,"expanded","expanded",Y],disabled:[2,"disabled","disabled",Y]},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],standalone:!0,features:[ue([{provide:qn,useValue:void 0}]),W]})}}return o})(),Kn=(()=>{class o{static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275mod=pe({type:o})}static{this.\u0275inj=me({})}}return o})();var $i=["body"],Ui=[[["mat-expansion-panel-header"]],"*",[["mat-action-row"]]],Gi=["mat-expansion-panel-header","*","mat-action-row"];function Qi(o,t){}var Wi=[[["mat-panel-title"]],[["mat-panel-description"]],"*"],Zi=["mat-panel-title","mat-panel-description","*"];function Xi(o,t){if(o&1&&(a(0,"span",1),xt(),a(1,"svg",2),_(2,"path",3),n()()),o&2){let e=g();c("@indicatorRotate",e._getExpandedState())}}var jn=new H("MAT_ACCORDION"),zn="225ms cubic-bezier(0.4,0.0,0.2,1)",Un={indicatorRotate:ot("indicatorRotate",[ne("collapsed, void",te({transform:"rotate(0deg)"})),ne("expanded",te({transform:"rotate(180deg)"})),rt("expanded <=> collapsed, void => collapsed",at(zn))]),bodyExpansion:ot("bodyExpansion",[ne("collapsed, void",te({height:"0px",visibility:"hidden"})),ne("expanded",te({height:"*",visibility:""})),rt("expanded <=> collapsed, void => collapsed",at(zn))])},Gn=new H("MAT_EXPANSION_PANEL"),Yi=(()=>{class o{constructor(e,i){this._template=e,this._expansionPanel=i}static{this.\u0275fac=function(i){return new(i||o)(f(Tt),f(Gn,8))}}static{this.\u0275dir=K({type:o,selectors:[["ng-template","matExpansionPanelContent",""]],standalone:!0})}}return o})(),Ji=0,Qn=new H("MAT_EXPANSION_PANEL_DEFAULT_OPTIONS"),mt=(()=>{class o extends Hn{get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(e){this._hideToggle=e}get togglePosition(){return this._togglePosition||this.accordion&&this.accordion.togglePosition}set togglePosition(e){this._togglePosition=e}constructor(e,i,s,l,u,h,b){super(e,i,s),this._viewContainerRef=l,this._animationMode=h,this._hideToggle=!1,this.afterExpand=new D,this.afterCollapse=new D,this._inputChanges=new We,this._headerId=`mat-expansion-panel-header-${Ji++}`,this.accordion=e,this._document=u,this._animationsDisabled=h==="NoopAnimations",b&&(this.hideToggle=b.hideToggle)}_hasSpacing(){return this.accordion?this.expanded&&this.accordion.displayMode==="default":!1}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(B(null),U(()=>this.expanded&&!this._portal),_t(1)).subscribe(()=>{this._portal=new rn(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(e){this._inputChanges.next(e)}ngOnDestroy(){super.ngOnDestroy(),this._inputChanges.complete()}_containsFocus(){if(this._body){let e=this._document.activeElement,i=this._body.nativeElement;return e===i||i.contains(e)}return!1}_animationStarted(e){!$n(e)&&!this._animationsDisabled&&this._body&&this._body?.nativeElement.setAttribute("inert","")}_animationDone(e){$n(e)||(e.toState==="expanded"?this.afterExpand.emit():e.toState==="collapsed"&&this.afterCollapse.emit(),!this._animationsDisabled&&this._body&&this._body.nativeElement.removeAttribute("inert"))}static{this.\u0275fac=function(i){return new(i||o)(f(jn,12),f(X),f(ve),f(St),f(Dt),f(Xe,8),f(Qn,8))}}static{this.\u0275cmp=O({type:o,selectors:[["mat-expansion-panel"]],contentQueries:function(i,s,l){if(i&1&&wt(l,Yi,5),i&2){let u;et(u=tt())&&(s._lazyContent=u.first)}},viewQuery:function(i,s){if(i&1&&Pt($i,5),i&2){let l;et(l=tt())&&(s._body=l.first)}},hostAttrs:[1,"mat-expansion-panel"],hostVars:6,hostBindings:function(i,s){i&2&&j("mat-expanded",s.expanded)("_mat-animation-noopable",s._animationsDisabled)("mat-expansion-panel-spacing",s._hasSpacing())},inputs:{hideToggle:[2,"hideToggle","hideToggle",Y],togglePosition:"togglePosition"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["matExpansionPanel"],standalone:!0,features:[ue([{provide:jn,useValue:void 0},{provide:Gn,useExisting:o}]),W,It,Ze,F],ngContentSelectors:Gi,decls:7,vars:4,consts:[["body",""],["role","region",1,"mat-expansion-panel-content",3,"id"],[1,"mat-expansion-panel-body"],[3,"cdkPortalOutlet"]],template:function(i,s){if(i&1){let l=k();Je(Ui),q(0),a(1,"div",1,0),x("@bodyExpansion.start",function(h){return y(l),v(s._animationStarted(h))})("@bodyExpansion.done",function(h){return y(l),v(s._animationDone(h))}),a(3,"div",2),q(4,1),p(5,Qi,0,0,"ng-template",3),n(),q(6,2),n()}i&2&&(d(),c("@bodyExpansion",s._getExpandedState())("id",s.id),Ye("aria-labelledby",s._headerId),d(4),c("cdkPortalOutlet",s._portal))},dependencies:[sn],styles:['.mat-expansion-panel{box-sizing:content-box;display:block;margin:0;overflow:hidden;transition:margin 225ms cubic-bezier(0.4, 0, 0.2, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);position:relative;background:var(--mat-expansion-container-background-color, var(--mat-app-surface));color:var(--mat-expansion-container-text-color, var(--mat-app-on-surface));border-radius:var(--mat-expansion-container-shape)}.mat-expansion-panel:not([class*=mat-elevation-z]){box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)}.mat-accordion .mat-expansion-panel:not(.mat-expanded),.mat-accordion .mat-expansion-panel:not(.mat-expansion-panel-spacing){border-radius:0}.mat-accordion .mat-expansion-panel:first-of-type{border-top-right-radius:var(--mat-expansion-container-shape);border-top-left-radius:var(--mat-expansion-container-shape)}.mat-accordion .mat-expansion-panel:last-of-type{border-bottom-right-radius:var(--mat-expansion-container-shape);border-bottom-left-radius:var(--mat-expansion-container-shape)}.cdk-high-contrast-active .mat-expansion-panel{outline:solid 1px}.mat-expansion-panel.ng-animate-disabled,.ng-animate-disabled .mat-expansion-panel,.mat-expansion-panel._mat-animation-noopable{transition:none}.mat-expansion-panel-content{display:flex;flex-direction:column;overflow:visible;font-family:var(--mat-expansion-container-text-font, var(--mat-app-body-large-font));font-size:var(--mat-expansion-container-text-size, var(--mat-app-body-large-size));font-weight:var(--mat-expansion-container-text-weight, var(--mat-app-body-large-weight));line-height:var(--mat-expansion-container-text-line-height, var(--mat-app-body-large-line-height));letter-spacing:var(--mat-expansion-container-text-tracking, var(--mat-app-body-large-tracking))}.mat-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.mat-expansion-panel-body{padding:0 24px 16px}.mat-expansion-panel-spacing{margin:16px 0}.mat-accordion>.mat-expansion-panel-spacing:first-child,.mat-accordion>*:first-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-top:0}.mat-accordion>.mat-expansion-panel-spacing:last-child,.mat-accordion>*:last-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-bottom:0}.mat-action-row{border-top-style:solid;border-top-width:1px;display:flex;flex-direction:row;justify-content:flex-end;padding:16px 8px 16px 24px;border-top-color:var(--mat-expansion-actions-divider-color, var(--mat-app-outline))}.mat-action-row .mat-button-base,.mat-action-row .mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-action-row .mat-button-base,[dir=rtl] .mat-action-row .mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2,data:{animation:[Un.bodyExpansion]},changeDetection:0})}}return o})();function $n(o){return o.fromState==="void"}var Wn=(()=>{class o{constructor(e,i,s,l,u,h,b){this.panel=e,this._element=i,this._focusMonitor=s,this._changeDetectorRef=l,this._animationMode=h,this._parentChangeSubscription=ce.EMPTY,this.tabIndex=0;let m=e.accordion?e.accordion._stateChanges.pipe(U(T=>!!(T.hideToggle||T.togglePosition))):ft;this.tabIndex=parseInt(b||"")||0,this._parentChangeSubscription=ht(e.opened,e.closed,m,e._inputChanges.pipe(U(T=>!!(T.hideToggle||T.disabled||T.togglePosition)))).subscribe(()=>this._changeDetectorRef.markForCheck()),e.closed.pipe(U(()=>e._containsFocus())).subscribe(()=>s.focusVia(i,"program")),u&&(this.expandedHeight=u.expandedHeight,this.collapsedHeight=u.collapsedHeight)}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_getTogglePosition(){return this.panel.togglePosition}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_getHeaderHeight(){let e=this._isExpanded();return e&&this.expandedHeight?this.expandedHeight:!e&&this.collapsedHeight?this.collapsedHeight:null}_keydown(e){switch(e.keyCode){case 32:case 13:Vt(e)||(e.preventDefault(),this._toggle());break;default:this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(e);return}}focus(e,i){e?this._focusMonitor.focusVia(this._element,e,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(e=>{e&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}static{this.\u0275fac=function(i){return new(i||o)(f(mt,1),f(vt),f(Bt),f(X),f(Qn,8),f(Xe,8),yt("tabindex"))}}static{this.\u0275cmp=O({type:o,selectors:[["mat-expansion-panel-header"]],hostAttrs:["role","button",1,"mat-expansion-panel-header","mat-focus-indicator"],hostVars:15,hostBindings:function(i,s){i&1&&x("click",function(){return s._toggle()})("keydown",function(u){return s._keydown(u)}),i&2&&(Ye("id",s.panel._headerId)("tabindex",s.disabled?-1:s.tabIndex)("aria-controls",s._getPanelId())("aria-expanded",s._isExpanded())("aria-disabled",s.panel.disabled),Et("height",s._getHeaderHeight()),j("mat-expanded",s._isExpanded())("mat-expansion-toggle-indicator-after",s._getTogglePosition()==="after")("mat-expansion-toggle-indicator-before",s._getTogglePosition()==="before")("_mat-animation-noopable",s._animationMode==="NoopAnimations"))},inputs:{expandedHeight:"expandedHeight",collapsedHeight:"collapsedHeight",tabIndex:[2,"tabIndex","tabIndex",e=>e==null?0:Ot(e)]},standalone:!0,features:[W,F],ngContentSelectors:Zi,decls:5,vars:3,consts:[[1,"mat-content"],[1,"mat-expansion-indicator"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960","aria-hidden","true","focusable","false"],["d","M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z"]],template:function(i,s){i&1&&(Je(Wi),a(0,"span",0),q(1),q(2,1),q(3,2),n(),p(4,Xi,3,1,"span",1)),i&2&&(j("mat-content-hide-toggle",!s._showToggle()),d(4),kt(s._showToggle()?4:-1))},styles:['.mat-expansion-panel-header{display:flex;flex-direction:row;align-items:center;padding:0 24px;border-radius:inherit;transition:height 225ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-expansion-header-collapsed-state-height);font-family:var(--mat-expansion-header-text-font, var(--mat-app-title-medium-font));font-size:var(--mat-expansion-header-text-size, var(--mat-app-title-medium-size));font-weight:var(--mat-expansion-header-text-weight, var(--mat-app-title-medium-weight));line-height:var(--mat-expansion-header-text-line-height, var(--mat-app-title-medium-line-height));letter-spacing:var(--mat-expansion-header-text-tracking, var(--mat-app-title-medium-tracking))}.mat-expansion-panel-header.mat-expanded{height:var(--mat-expansion-header-expanded-state-height)}.mat-expansion-panel-header[aria-disabled=true]{color:var(--mat-expansion-header-disabled-state-text-color)}.mat-expansion-panel-header:not([aria-disabled=true]){cursor:pointer}.mat-expansion-panel:not(.mat-expanded) .mat-expansion-panel-header:not([aria-disabled=true]):hover{background:var(--mat-expansion-header-hover-state-layer-color)}@media(hover: none){.mat-expansion-panel:not(.mat-expanded) .mat-expansion-panel-header:not([aria-disabled=true]):hover{background:var(--mat-expansion-container-background-color, var(--mat-app-surface))}}.mat-expansion-panel .mat-expansion-panel-header:not([aria-disabled=true]).cdk-keyboard-focused,.mat-expansion-panel .mat-expansion-panel-header:not([aria-disabled=true]).cdk-program-focused{background:var(--mat-expansion-header-focus-state-layer-color)}.mat-expansion-panel-header._mat-animation-noopable{transition:none}.mat-expansion-panel-header:focus,.mat-expansion-panel-header:hover{outline:none}.mat-expansion-panel-header.mat-expanded:focus,.mat-expansion-panel-header.mat-expanded:hover{background:inherit}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before{flex-direction:row-reverse}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 16px 0 0}[dir=rtl] .mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 0 0 16px}.mat-content{display:flex;flex:1;flex-direction:row;overflow:hidden}.mat-content.mat-content-hide-toggle{margin-right:8px}[dir=rtl] .mat-content.mat-content-hide-toggle{margin-right:0;margin-left:8px}.mat-expansion-toggle-indicator-before .mat-content.mat-content-hide-toggle{margin-left:24px;margin-right:0}[dir=rtl] .mat-expansion-toggle-indicator-before .mat-content.mat-content-hide-toggle{margin-right:24px;margin-left:0}.mat-expansion-panel-header-title{color:var(--mat-expansion-header-text-color, var(--mat-app-on-surface))}.mat-expansion-panel-header-title,.mat-expansion-panel-header-description{display:flex;flex-grow:1;flex-basis:0;margin-right:16px;align-items:center}[dir=rtl] .mat-expansion-panel-header-title,[dir=rtl] .mat-expansion-panel-header-description{margin-right:0;margin-left:16px}.mat-expansion-panel-header[aria-disabled=true] .mat-expansion-panel-header-title,.mat-expansion-panel-header[aria-disabled=true] .mat-expansion-panel-header-description{color:inherit}.mat-expansion-panel-header-description{flex-grow:2;color:var(--mat-expansion-header-description-color, var(--mat-app-on-surface-variant))}.mat-expansion-indicator::after{border-style:solid;border-width:0 2px 2px 0;content:"";display:inline-block;padding:3px;transform:rotate(45deg);vertical-align:middle;color:var(--mat-expansion-header-indicator-color, var(--mat-app-on-surface-variant));display:var(--mat-expansion-legacy-header-indicator-display, inline-block)}.mat-expansion-indicator svg{width:24px;height:24px;margin:0 -8px;vertical-align:middle;fill:var(--mat-expansion-header-indicator-color, var(--mat-app-on-surface-variant));display:var(--mat-expansion-header-indicator-display, none)}.cdk-high-contrast-active .mat-expansion-panel-content{border-top:1px solid;border-top-left-radius:0;border-top-right-radius:0}'],encapsulation:2,data:{animation:[Un.indicatorRotate]},changeDetection:0})}}return o})(),Zn=(()=>{class o{static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275dir=K({type:o,selectors:[["mat-panel-description"]],hostAttrs:[1,"mat-expansion-panel-header-description"],standalone:!0})}}return o})(),Xn=(()=>{class o{static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275dir=K({type:o,selectors:[["mat-panel-title"]],hostAttrs:[1,"mat-expansion-panel-header-title"],standalone:!0})}}return o})();var Yn=(()=>{class o{static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275mod=pe({type:o})}static{this.\u0275inj=me({imports:[Rt,Kn,ln]})}}return o})();function to(o,t){o&1&&(a(0,"div",7),_(1,"mat-spinner"),a(2,"p"),r(3,"Loading lesson data..."),n()())}function no(o,t){if(o&1&&(a(0,"mat-option",49),r(1),n()),o&2){let e=t.$implicit,i=g(2);c("value",e),d(),C(" ",i.displayCourseFn(e)," ")}}function io(o,t){if(o&1&&(a(0,"mat-option",49),r(1),n()),o&2){let e=t.$implicit,i=g(2);c("value",e),d(),C(" ",i.displayTopicFn(e)," ")}}function oo(o,t){o&1&&(a(0,"mat-hint",50),r(1," Please select a course first to view available topics "),n())}function ao(o,t){o&1&&(a(0,"mat-error"),r(1," Topic selection is required "),n())}function ro(o,t){o&1&&(a(0,"mat-error"),r(1," Title is required "),n())}function so(o,t){o&1&&(a(0,"mat-error"),r(1," Content type is required "),n())}function lo(o,t){o&1&&(a(0,"mat-form-field",11)(1,"mat-label"),r(2,"Order Number"),n(),_(3,"input",51),a(4,"mat-hint"),r(5,"Position of this lesson within the topic"),n()())}function co(o,t){o&1&&(a(0,"mat-chip",106)(1,"mat-icon"),r(2,"star"),n(),r(3," Important "),n())}function mo(o,t){o&1&&(a(0,"mat-error"),r(1," Title is required "),n())}function po(o,t){o&1&&(a(0,"mat-error"),r(1," Content type is required "),n())}function uo(o,t){o&1&&(a(0,"div",107),r(1," Content is required "),n())}function go(o,t){o&1&&(a(0,"mat-form-field",11)(1,"mat-label"),r(2,"Visual Aid URL"),n(),_(3,"input",108),a(4,"mat-hint"),r(5,"URL to an image, diagram, or visual aid"),n()())}function fo(o,t){if(o&1&&(a(0,"mat-option",49),r(1),n()),o&2){let e=t.$implicit;c("value",e.tagId),d(),C(" ",e.tagName," ")}}function ho(o,t){o&1&&(a(0,"mat-error"),r(1," Tag selection is required "),n())}function _o(o,t){if(o&1){let e=k();a(0,"div",109)(1,"mat-form-field",110)(2,"mat-label"),r(3,"Tag"),n(),a(4,"mat-select",111),p(5,fo,2,2,"mat-option",14),n(),p(6,ho,2,0,"mat-error",20),n(),a(7,"mat-form-field",112)(8,"mat-label"),r(9,"Relevance Score"),n(),_(10,"input",113),a(11,"mat-hint"),r(12,"1-10 scale"),n()(),a(13,"button",114),x("click",function(){let s=y(e).index,l=g().index,u=g(2);return v(u.removeKeynoteTag(l,s))}),a(14,"mat-icon"),r(15,"delete"),n()()()}if(o&2){let e,i=t.$implicit,s=t.index,l=g(3);c("formGroupName",s),d(5),c("ngForOf",l.allTags),d(),c("ngIf",(e=i.get("tagId"))==null?null:e.hasError("required"))}}function xo(o,t){o&1&&(a(0,"div",115)(1,"mat-icon"),r(2,"local_offer_outlined"),n(),a(3,"span"),r(4,"No tags added to this keynote yet."),n()())}function yo(o,t){if(o&1){let e=k();a(0,"mat-expansion-panel",52)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div",53)(4,"mat-icon",54),r(5,"note_alt"),n(),a(6,"span",55),r(7),n(),p(8,co,4,0,"mat-chip",56),a(9,"mat-chip",57),r(10),n()()(),a(11,"mat-panel-description")(12,"span",58),r(13),n()()(),a(14,"div",59)(15,"mat-form-field",11)(16,"mat-label"),r(17,"Title"),n(),_(18,"input",60),p(19,mo,2,0,"mat-error",20),n(),a(20,"mat-form-field",11)(21,"mat-label"),r(22,"Content Type"),n(),a(23,"mat-select",26)(24,"mat-option",61),r(25,"Text"),n(),a(26,"mat-option",62),r(27,"Bullet Points"),n(),a(28,"mat-option",63),r(29,"Quote"),n(),a(30,"mat-option",64),r(31,"Example"),n()(),p(32,po,2,0,"mat-error",20),n(),a(33,"div",65)(34,"label",23),r(35,"Content"),n(),a(36,"div",66),_(37,"quill-editor",67),n(),a(38,"div",68),r(39),n(),p(40,uo,2,0,"div",69),n(),a(41,"div",70)(42,"mat-checkbox",71),r(43," Mark as Important "),n(),a(44,"mat-checkbox",72),r(45," Has Visual Aid "),n()(),p(46,go,6,0,"mat-form-field",33),a(47,"div",70)(48,"mat-form-field",73)(49,"mat-label"),r(50,"Related Planet"),n(),a(51,"mat-select",74)(52,"mat-option",75),r(53,"None"),n(),a(54,"mat-option",76),r(55,"Sun"),n(),a(56,"mat-option",77),r(57,"Moon"),n(),a(58,"mat-option",78),r(59,"Mars"),n(),a(60,"mat-option",79),r(61,"Mercury"),n(),a(62,"mat-option",80),r(63,"Jupiter"),n(),a(64,"mat-option",81),r(65,"Venus"),n(),a(66,"mat-option",82),r(67,"Saturn"),n(),a(68,"mat-option",83),r(69,"Rahu"),n(),a(70,"mat-option",84),r(71,"Ketu"),n()()(),a(72,"mat-form-field",73)(73,"mat-label"),r(74,"Related Zodiac"),n(),a(75,"mat-select",85)(76,"mat-option",75),r(77,"None"),n(),a(78,"mat-option",86),r(79,"Aries"),n(),a(80,"mat-option",87),r(81,"Taurus"),n(),a(82,"mat-option",88),r(83,"Gemini"),n(),a(84,"mat-option",89),r(85,"Cancer"),n(),a(86,"mat-option",90),r(87,"Leo"),n(),a(88,"mat-option",91),r(89,"Virgo"),n(),a(90,"mat-option",92),r(91,"Libra"),n(),a(92,"mat-option",93),r(93,"Scorpio"),n(),a(94,"mat-option",94),r(95,"Sagittarius"),n(),a(96,"mat-option",95),r(97,"Capricorn"),n(),a(98,"mat-option",96),r(99,"Aquarius"),n(),a(100,"mat-option",97),r(101,"Pisces"),n()()()(),a(102,"div",98)(103,"div",36)(104,"h4",99)(105,"mat-icon"),r(106,"local_offer"),n(),r(107," Keynote Tags "),n(),a(108,"button",100),x("click",function(){let s=y(e).index,l=g(2);return v(l.addKeynoteTag(s))}),a(109,"mat-icon"),r(110,"add"),n(),r(111," Add Tag "),n()(),a(112,"div",101),p(113,_o,16,3,"div",102)(114,xo,5,0,"div",103),n()(),a(115,"div",104)(116,"button",105),x("click",function(){let s=y(e).index,l=g(2);return v(l.removeKeynote(s))}),a(117,"mat-icon"),r(118,"delete"),n(),r(119," Remove "),n()()()()}if(o&2){let e,i,s,l,u,h,b,m,T,pt,ut,gt,E=t.$implicit,Qe=t.index,V=g(2);c("formGroupName",Qe)("expanded",(e=E.get("isNew"))==null?null:e.value),d(7),C(" ",((i=E.get("title"))==null?null:i.value)||"New Keynote"," "),d(),c("ngIf",(s=E.get("isImportant"))==null?null:s.value),d(),c("ngClass","content-type-"+((l=E.get("contentType"))==null?null:l.value)),d(),C(" ",V.getContentTypeLabel((u=E.get("contentType"))==null?null:u.value)," "),d(3),C(" ",V.getKeynotePreview((h=E.get("content"))==null?null:h.value)," "),d(6),c("ngIf",(b=E.get("title"))==null?null:b.hasError("required")),d(13),c("ngIf",(m=E.get("contentType"))==null?null:m.hasError("required")),d(5),c("modules",V.quillModules)("placeholder",V.getContentPlaceholder((T=E.get("contentType"))==null?null:T.value)),d(2),w(V.getContentHint((pt=E.get("contentType"))==null?null:pt.value)),d(),c("ngIf",(ut=E.get("content"))==null?null:ut.hasError("required")),d(6),c("ngIf",(gt=E.get("hasVisualAid"))==null?null:gt.value),d(67),c("ngForOf",V.getKeynoteTags(Qe).controls),d(),c("ngIf",V.getKeynoteTags(Qe).length===0)}}function vo(o,t){o&1&&(a(0,"div",116)(1,"mat-icon"),r(2,"note_add"),n(),a(3,"p"),r(4,'No keynotes added yet. Click "Add Keynote" to get started.'),n()())}function Co(o,t){if(o&1&&(a(0,"mat-option",49),r(1),n()),o&2){let e=t.$implicit;c("value",e.tagId),d(),C(" ",e.tagName," ")}}function bo(o,t){o&1&&(a(0,"mat-error"),r(1," Tag selection is required "),n())}function To(o,t){if(o&1){let e=k();a(0,"div",117)(1,"mat-form-field",11)(2,"mat-label"),r(3,"Tag"),n(),a(4,"mat-select",111),p(5,Co,2,2,"mat-option",14),n(),p(6,bo,2,0,"mat-error",20),n(),a(7,"mat-form-field",11)(8,"mat-label"),r(9,"Relevance Score"),n(),_(10,"input",118),a(11,"mat-hint"),r(12,"Enter a score from 1-10 indicating relevance to the lesson"),n()(),a(13,"div",119)(14,"button",120),x("click",function(){let s=y(e).index,l=g(2);return v(l.saveTag(s))}),a(15,"mat-icon"),r(16,"save"),n()(),a(17,"button",121),x("click",function(){let s=y(e).index,l=g(2);return v(l.removeTag(s))}),a(18,"mat-icon"),r(19,"delete"),n(),r(20," Remove "),n()()()}if(o&2){let e,i=t.$implicit,s=t.index,l=g(2);c("formGroupName",s),d(5),c("ngForOf",l.allTags),d(),c("ngIf",(e=i.get("tagId"))==null?null:e.hasError("required"))}}function So(o,t){o&1&&(a(0,"div",122)(1,"mat-icon"),r(2,"label_off"),n(),a(3,"p"),r(4,'No tags added yet. Click "Add Tag" to get started.'),n()())}function Io(o,t){o&1&&_(0,"mat-spinner",123)}function Eo(o,t){if(o&1&&(a(0,"span"),r(1),n()),o&2){let e=g(2);d(),C(" with ",e.keynotes.length," Keynote(s)")}}function Mo(o,t){if(o&1){let e=k();a(0,"form",8),x("ngSubmit",function(){y(e);let s=g();return v(s.onSubmit())}),a(1,"div",9)(2,"h3",10)(3,"mat-icon"),r(4,"info"),n(),r(5," Lesson Information "),n(),a(6,"mat-form-field",11)(7,"mat-label"),r(8,"Search Course"),n(),_(9,"input",12),a(10,"mat-autocomplete",13,0),x("optionSelected",function(s){y(e);let l=g();return v(l.onCourseSelected(s))}),p(12,no,2,2,"mat-option",14),N(13,"async"),n(),a(14,"mat-icon",15),r(15,"school"),n(),a(16,"mat-hint"),r(17,"Select a course to filter topics"),n()(),a(18,"mat-form-field",11)(19,"mat-label"),r(20,"Course ID"),n(),_(21,"input",16),a(22,"mat-hint"),r(23,"Selected from course search above"),n()(),a(24,"mat-form-field",11)(25,"mat-label"),r(26,"Search Topic"),n(),_(27,"input",17),a(28,"mat-autocomplete",13,1),x("optionSelected",function(s){y(e);let l=g();return v(l.onTopicSelected(s))}),p(30,io,2,2,"mat-option",14),N(31,"async"),n(),a(32,"mat-icon",15),r(33,"search"),n(),p(34,oo,2,0,"mat-hint",18),n(),a(35,"mat-form-field",11)(36,"mat-label"),r(37,"Topic ID"),n(),_(38,"input",19),a(39,"mat-hint"),r(40,"Selected from topic search above"),n(),p(41,ao,2,0,"mat-error",20),n(),a(42,"mat-form-field",11)(43,"mat-label"),r(44,"Title"),n(),_(45,"input",21),p(46,ro,2,0,"mat-error",20),n(),a(47,"div",22)(48,"label",23),r(49,"Description"),n(),a(50,"div",24),_(51,"quill-editor",25),n()(),a(52,"mat-form-field",11)(53,"mat-label"),r(54,"Content Type"),n(),a(55,"mat-select",26)(56,"mat-option",27),r(57,"Video"),n(),a(58,"mat-option",28),r(59,"Article"),n(),a(60,"mat-option",29),r(61,"Quiz"),n(),a(62,"mat-option",30),r(63,"Exercise"),n()(),p(64,so,2,0,"mat-error",20),n(),a(65,"mat-form-field",11)(66,"mat-label"),r(67,"Content URL"),n(),_(68,"input",31),a(69,"mat-hint"),r(70,"URL to the lesson content (video, article, etc.)"),n()(),a(71,"mat-form-field",11)(72,"mat-label"),r(73,"Duration (minutes)"),n(),_(74,"input",32),a(75,"mat-hint"),r(76,"Estimated time to complete this lesson"),n()(),p(77,lo,6,0,"mat-form-field",33),a(78,"div",34)(79,"mat-checkbox",35)(80,"strong"),r(81,"Free lesson"),n(),r(82," (accessible without payment) "),n()()(),_(83,"mat-divider"),a(84,"div",9)(85,"div",36)(86,"h3",10)(87,"mat-icon"),r(88,"note_alt"),n(),r(89," Lesson Keynotes "),n(),a(90,"button",37),x("click",function(){y(e);let s=g();return v(s.addKeynote())}),a(91,"mat-icon"),r(92,"add"),n(),r(93," Add Keynote "),n()(),a(94,"div",38),p(95,yo,120,16,"mat-expansion-panel",39)(96,vo,5,0,"div",40),n()(),_(97,"mat-divider"),a(98,"div",9)(99,"div",36)(100,"h3",10)(101,"mat-icon"),r(102,"label"),n(),r(103," Lesson Tags "),n(),a(104,"button",41),x("click",function(){y(e);let s=g();return v(s.addTag())}),a(105,"mat-icon"),r(106,"add"),n(),r(107," Add Tag "),n()(),a(108,"div",42),p(109,To,21,3,"div",43)(110,So,5,0,"div",44),n()(),_(111,"mat-divider"),a(112,"div",45)(113,"button",46),x("click",function(){y(e);let s=g();return v(s.goBack())}),r(114," Cancel "),n(),a(115,"button",47),p(116,Io,1,0,"mat-spinner",48),r(117),p(118,Eo,2,1,"span",20),n()()()}if(o&2){let e,i,s,l,u,h=Z(11),b=Z(29),m=g();c("formGroup",m.lessonForm),d(9),c("matAutocomplete",h),d(),c("displayWith",m.displayCourseFn),d(2),c("ngForOf",z(13,22,m.filteredCourses)),d(15),c("matAutocomplete",b)("disabled",!((e=m.lessonForm.get("courseId"))!=null&&e.value)),d(),c("displayWith",m.displayTopicFn),d(2),c("ngForOf",z(31,24,m.filteredTopics)),d(4),c("ngIf",!((i=m.lessonForm.get("courseId"))!=null&&i.value)),d(7),c("ngIf",(s=m.lessonForm.get("topicId"))==null?null:s.hasError("required")),d(5),c("ngIf",(l=m.lessonForm.get("title"))==null?null:l.hasError("required")),d(5),c("modules",m.quillModules),d(13),c("ngIf",(u=m.lessonForm.get("contentType"))==null?null:u.hasError("required")),d(13),c("ngIf",m.isEditMode),d(18),c("ngForOf",m.keynotes.controls),d(),c("ngIf",m.keynotes.length===0),d(13),c("ngForOf",m.tags.controls),d(),c("ngIf",m.tags.length===0),d(5),c("disabled",m.lessonForm.invalid||m.submitting),d(),c("ngIf",m.submitting),d(),C(" ",m.submitting?m.isEditMode?"Updating...":"Creating...":m.isEditMode?"Update":"Create"," Lesson "),d(),c("ngIf",m.keynotes.length>0&&!m.submitting)}}var le=class o{lessonForm;filteredTopics=S([]);filteredCourses=S([]);isEditMode=!1;lessonId=null;allTags=[];allCourses=[];loading=!1;submitting=!1;quillModules={toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link"]]};fb=M(Jt);lessonService=M(Ue);topicService=M($e);courseService=M(ze);keynoteService=M(Nn);router=M(_e);route=M(Nt);snackBar=M(De);lessonTagService=M(Vn);keynoteTagService=M(Bn);tagService=M(Rn);constructor(){this.lessonForm=this.fb.group({title:["",I.required],description:[""],courseId:[""],courseSearch:[""],topicId:["",I.required],topicSearch:[""],contentType:["",I.required],contentUrl:[""],durationMinutes:[""],orderNumber:[1],isFree:[!1],tags:this.fb.array([]),keynotes:this.fb.array([])})}get tags(){return this.lessonForm.get("tags")}get keynotes(){return this.lessonForm.get("keynotes")}ngOnInit(){this.setupCourseAutocomplete(),this.setupTopicAutocomplete(),this.checkEditMode(),this.loadAllTags(),this.loadAllCourses(),this.handleNavigationState()}handleNavigationState(){let e=this.router.getCurrentNavigation()?.extras?.state||window.history.state;if(e&&e.selectedTopic&&!this.isEditMode){let i=e.selectedTopic;this.courseService.getCourseById(i.courseId).subscribe({next:s=>{this.lessonForm.patchValue({courseId:i.courseId,courseSearch:s,topicId:i.topicId,topicSearch:i})},error:()=>{console.error("Error loading course for selected topic")}})}}setupCourseAutocomplete(){this.filteredCourses=this.lessonForm.get("courseSearch").valueChanges.pipe(B(""),G(300),Q(),R(t=>this._filterCourses(t)))}setupTopicAutocomplete(){this.filteredTopics=this.lessonForm.get("topicSearch").valueChanges.pipe(B(""),G(300),Q(),R(t=>this._filterTopics(t)))}_filterCourses(t){if(typeof t!="string")return S([]);if(!t||t.trim()==="")return this.courseService.getAllCourses();let e=t.toLowerCase();return this.courseService.getAllCourses().pipe(R(i=>S(i.filter(s=>s.title.toLowerCase().includes(e)))))}_filterTopics(t){if(typeof t!="string")return S([]);let e=this.lessonForm.get("courseId")?.value;return e?this.topicService.getTopicsByCourseId(e).pipe(R(i=>{if(!t||t.trim()==="")return S(i);let s=t.toLowerCase();return S(i.filter(l=>l.title.toLowerCase().includes(s)))})):S([])}displayCourseFn=t=>t?`${t.title} (ID: ${t.courseId})`:"";displayTopicFn=t=>t?`${t.title} (ID: ${t.topicId})`:"";onCourseSelected(t){let e=t.option.value;this.lessonForm.patchValue({courseId:e.courseId,topicId:"",topicSearch:""}),this.lessonForm.get("topicSearch")?.updateValueAndValidity()}onTopicSelected(t){let e=t.option.value;this.lessonForm.patchValue({topicId:e.topicId})}loadAllCourses(){this.courseService.getAllCourses().subscribe({next:t=>{this.allCourses=t},error:t=>{console.error("Error loading courses:",t),this.snackBar.open("Error loading courses","Close",{duration:3e3})}})}addKeynote(){let t=this.fb.group({title:["",I.required],content:["",I.required],contentType:["text",I.required],isImportant:[!1],hasVisualAid:[!1],visualAidUrl:[""],relatedPlanet:[""],relatedZodiac:[""],keynoteTags:this.fb.array([]),isNew:[!0]});this.keynotes.push(t)}removeKeynote(t){this.keynotes.removeAt(t)}addTag(){let t=this.fb.group({lessonTagId:[null],tagId:[null,I.required],tagName:[""],relevanceScore:[1]});this.tags.push(t)}removeTag(t){return L(this,null,function*(){let i=this.tags.at(t).value;if(i.lessonTagId)try{yield this.lessonTagService.deleteLessonTag(i.lessonTagId).toPromise(),this.snackBar.open("Tag deleted successfully.","Close",{duration:2e3}),this.loadTags()}catch(s){let l="Failed to delete tag. Please try again.";s&&s.error&&s.error.message?l=s.error.message:s&&s.message&&(l=s.message),this.snackBar.open(l,"Close",{duration:5e3}),console.error("Error deleting tag:",s)}else this.tags.removeAt(t)})}getKeynoteTags(t){return this.keynotes.at(t).get("keynoteTags")}addKeynoteTag(t){let e=this.fb.group({keynoteTagId:[null],tagId:[null,I.required],relevanceScore:[5]});this.getKeynoteTags(t).push(e)}removeKeynoteTag(t,e){this.getKeynoteTags(t).removeAt(e)}getContentTypeLabel(t){switch(t){case"text":return"Text";case"bullet_points":return"Bullet Points";case"quote":return"Quote";case"example":return"Example";default:return t||"Text"}}getKeynotePreview(t){if(!t)return"No content";let e=t.replace(/<[^>]*>/g,"");return e.length>50?e.substring(0,50)+"...":e}getContentPlaceholder(t){switch(t){case"bullet_points":return`Enter bullet points, one per line:
\u2022 Point 1
\u2022 Point 2
\u2022 Point 3`;case"quote":return"Enter the quote text...";case"example":return"Provide a detailed example...";default:return"Enter the keynote content..."}}getContentHint(t){switch(t){case"bullet_points":return"Use bullet points (\u2022), dashes (-), or asterisks (*) to separate points";case"quote":return"Inspirational or educational quotes related to the lesson";case"example":return"Practical examples that illustrate the lesson concepts";default:return"General text content for the keynote"}}checkEditMode(){let t=this.route.snapshot.paramMap.get("id");if(t){let e=parseInt(t,10);!isNaN(e)&&e>0?(this.isEditMode=!0,this.lessonId=e,console.log("Edit mode enabled for lessonId:",this.lessonId),this.loadLesson()):(console.error("Invalid lesson ID in route:",t),this.snackBar.open("Invalid lesson ID provided","Close",{duration:3e3}),this.router.navigate(["/lessons"]))}}loadLesson(){this.lessonId&&(this.loading=!0,this.lessonService.getLessonById(this.lessonId).subscribe({next:t=>{this.lessonForm.patchValue({title:t.title,description:t.description,topicId:t.topicId,contentType:t.contentType,contentUrl:t.contentUrl,durationMinutes:t.durationMinutes,orderNumber:t.orderNumber,isFree:t.isFree}),this.topicService.getTopicById(t.topicId).subscribe({next:e=>{this.lessonForm.patchValue({topicSearch:e,courseId:e.courseId}),this.courseService.getCourseById(e.courseId).subscribe({next:i=>{this.lessonForm.patchValue({courseSearch:i})},error:()=>{console.error("Error loading course details")}})}}),this.loadKeynotes(),this.loadTags(),this.loading=!1},error:()=>{this.snackBar.open("Error loading lesson","Close",{duration:3e3}),this.loading=!1}}))}loadKeynotes(){this.lessonId&&this.keynoteService.getKeynotesByLessonId(this.lessonId).subscribe({next:t=>{for(;this.keynotes.length!==0;)this.keynotes.removeAt(0);t.forEach(e=>{let i=this.fb.group({keynoteId:[e.keynoteId],title:[e.title,I.required],content:[e.content,I.required],contentType:[e.contentType,I.required],isImportant:[e.isImportant||!1],hasVisualAid:[e.hasVisualAid||!1],visualAidUrl:[e.visualAidUrl||""],relatedPlanet:[e.relatedPlanet||""],relatedZodiac:[e.relatedZodiac||""],keynoteTags:this.fb.array([]),isNew:[!1]});this.keynotes.push(i),e.keynoteId&&this.loadKeynoteTags(e.keynoteId,this.keynotes.length-1)})},error:()=>{this.snackBar.open("Error loading keynotes","Close",{duration:3e3})}})}loadTags(){this.lessonId&&typeof this.lessonId=="number"&&this.lessonId>0?(console.log("Loading tags for lessonId:",this.lessonId),this.lessonTagService.getTagsByLessonId(this.lessonId).subscribe({next:t=>{for(console.log("Tags loaded successfully:",t);this.tags.length!==0;)this.tags.removeAt(0);t.forEach(e=>{let i=this.fb.group({lessonTagId:[e.lessonTagId],tagId:[e.tagId,I.required],tagName:[e.tagName||""],relevanceScore:[e.relevanceScore||1]});this.tags.push(i)}),console.log("Tags form array updated, length:",this.tags.length)},error:t=>{console.error("Error loading tags:",t);let e="Error loading tags";t.status&&(e+=` (${t.status})`),t.error&&t.error.message&&(e+=`: ${t.error.message}`),this.snackBar.open(e,"Close",{duration:5e3})}})):console.log("lessonId is not valid for loadTags:",this.lessonId,typeof this.lessonId)}loadAllTags(){this.tagService.getTags().subscribe({next:t=>{this.allTags=t},error:()=>{this.snackBar.open("Error loading tags","Close",{duration:3e3})}})}loadKeynoteTags(t,e){this.keynoteTagService.getTagsByKeynoteId(t).subscribe({next:i=>{let s=this.getKeynoteTags(e);for(;s.length!==0;)s.removeAt(0);i.forEach(l=>{let u=this.fb.group({keynoteTagId:[l.keynoteTagId],tagId:[l.tagId,I.required],relevanceScore:[l.relevanceScore||5]});s.push(u)})},error:()=>{this.snackBar.open("Error loading keynote tags","Close",{duration:3e3})}})}onSubmit(){if(this.lessonForm.valid){this.submitting=!0;let t=this.lessonForm.value,e=$({title:t.title,description:t.description,topicId:t.topicId,contentType:t.contentType,contentUrl:t.contentUrl,durationMinutes:t.durationMinutes,isFree:t.isFree},this.isEditMode&&{orderNumber:t.orderNumber});this.isEditMode&&this.lessonId?this.lessonService.updateLesson(this.lessonId,e).subscribe({next:()=>L(this,null,function*(){try{yield this.handleKeynotes(this.lessonId),yield this.handleTags(this.lessonId),this.snackBar.open(`Lesson updated successfully with ${this.keynotes.length} keynote(s) and ${this.tags.length} tag(s)!`,"Close",{duration:3e3}),this.submitting=!1,this.goBack()}catch(i){console.error("Error updating keynotes/tags:",i),this.snackBar.open("Lesson updated but some keynotes or tags failed to save","Close",{duration:5e3}),this.submitting=!1,this.goBack()}}),error:i=>{console.error("Error updating lesson:",i),this.snackBar.open("Error updating lesson. Please try again.","Close",{duration:5e3}),this.submitting=!1}}):this.lessonService.createLesson(e).subscribe({next:i=>L(this,null,function*(){try{yield this.handleKeynotes(i.lessonId),yield this.handleTags(i.lessonId),this.snackBar.open(`Lesson created successfully with ${this.keynotes.length} keynote(s) and ${this.tags.length} tag(s)!`,"Close",{duration:3e3}),this.submitting=!1,this.goBack()}catch(s){console.error("Error creating keynotes/tags:",s),this.snackBar.open("Lesson created but some keynotes or tags failed to save","Close",{duration:5e3}),this.submitting=!1,this.goBack()}}),error:i=>{console.error("Error creating lesson:",i),this.snackBar.open("Error creating lesson. Please try again.","Close",{duration:5e3}),this.submitting=!1}})}else this.snackBar.open("Please fill in all required fields correctly.","Close",{duration:3e3})}handleKeynotes(t){return L(this,null,function*(){let e=[],i=this.lessonForm.get("keynotes")?.value||[];for(let s=0;s<i.length;s++){let l=i[s],u={lessonId:t,title:l.title,content:l.content,contentType:l.contentType,isImportant:l.isImportant||!1,hasVisualAid:l.hasVisualAid||!1,visualAidUrl:l.visualAidUrl||null,relatedPlanet:l.relatedPlanet||null,relatedZodiac:l.relatedZodiac||null};try{let h;l.keynoteId?h=yield this.keynoteService.updateKeynote(l.keynoteId,u).toPromise():h=yield this.keynoteService.createKeynote(u).toPromise(),h&&h.keynoteId&&l.keynoteTags&&(yield this.handleKeynoteTags(h.keynoteId,l.keynoteTags))}catch(h){throw console.error("Error handling keynote:",h),h}}})}handleKeynoteTags(t,e){return L(this,null,function*(){if(this.isEditMode)try{let s=(yield this.keynoteTagService.getTagsByKeynoteId(t).toPromise())||[],l=e.map(m=>m.keynoteTagId).filter(m=>m),h=s.filter(m=>m.keynoteTagId&&!l.includes(m.keynoteTagId)).filter(m=>m.keynoteTagId).map(m=>this.keynoteTagService.deleteKeynoteTag(m.keynoteTagId).toPromise());h.length>0&&(yield Promise.all(h));let b=[];e.forEach(m=>{let T={keynoteId:t,tagId:m.tagId,relevanceScore:m.relevanceScore||5};m.keynoteTagId?b.push(this.keynoteTagService.updateKeynoteTag(m.keynoteTagId,T).toPromise()):b.push(this.keynoteTagService.createKeynoteTag(T).toPromise())}),b.length>0&&(yield Promise.all(b))}catch(i){throw console.error("Error handling keynote tags:",i),i}else{let i=[];e.forEach(s=>{let l={keynoteId:t,tagId:s.tagId,relevanceScore:s.relevanceScore||5};i.push(this.keynoteTagService.createKeynoteTag(l).toPromise())}),i.length>0&&(yield Promise.all(i))}})}handleTags(t){return L(this,null,function*(){let e=this.lessonForm.get("tags")?.value||[];if(this.isEditMode)try{let s=(yield this.lessonTagService.getTagsByLessonId(t).toPromise())||[],l=e.map(m=>m.lessonTagId).filter(m=>m),h=s.filter(m=>m.lessonTagId&&!l.includes(m.lessonTagId)).filter(m=>m.lessonTagId).map(m=>this.lessonTagService.deleteLessonTag(m.lessonTagId).toPromise());h.length>0&&(yield Promise.all(h));let b=[];e.forEach(m=>{let T={lessonId:t,tagId:m.tagId,relevanceScore:m.relevanceScore||1};m.lessonTagId?b.push(this.lessonTagService.updateLessonTag(m.lessonTagId,T).toPromise()):b.push(this.lessonTagService.addLessonTag(T).toPromise())}),b.length>0&&(yield Promise.all(b))}catch(i){throw console.error("Error handling tags:",i),i}else{let i=[];e.forEach(s=>{let l={lessonId:t,tagId:s.tagId,relevanceScore:s.relevanceScore||1};i.push(this.lessonTagService.addLessonTag(l).toPromise())}),i.length>0&&(yield Promise.all(i))}})}goBack(){let e=this.router.getCurrentNavigation()?.extras?.state||window.history.state;this.router.navigate(["/lessons"],{state:{selectedTopic:e?.selectedTopic,selectedCourse:e?.selectedCourse,selectedCategory:e?.selectedCategory}})}saveTag(t){return L(this,null,function*(){let e=this.tags.at(t);if(!e.valid){this.snackBar.open("Please select a tag and enter a valid relevance score.","Close",{duration:3e3});return}if(!this.lessonId||typeof this.lessonId!="number"){this.snackBar.open("Lesson ID is missing. Cannot save tag.","Close",{duration:3e3});return}let i=e.value,s={lessonId:this.lessonId,tagId:Number(i.tagId),relevanceScore:Number(i.relevanceScore)};try{if(i.lessonTagId)yield this.lessonTagService.updateLessonTag(i.lessonTagId,de($({},s),{lessonTagId:i.lessonTagId})).toPromise(),this.snackBar.open("Tag updated successfully.","Close",{duration:2e3});else{let l=yield this.lessonTagService.addLessonTag(s).toPromise();l&&l.lessonTagId&&e.patchValue({lessonTagId:l.lessonTagId}),this.snackBar.open("Tag added successfully.","Close",{duration:2e3})}this.loadTags()}catch(l){let u="Failed to save tag. Please try again.";l&&l.error&&l.error.message?u=l.error.message:l&&l.message&&(u=l.message),this.snackBar.open(u,"Close",{duration:5e3}),console.error("Error saving tag:",l)}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["app-add-lesson"]],standalone:!0,features:[F],decls:15,vars:3,consts:[["courseAuto","matAutocomplete"],["auto","matAutocomplete"],[1,"container"],[1,"header"],["mat-button","",3,"click"],["class","loading-container",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading-container"],[3,"ngSubmit","formGroup"],[1,"section"],[1,"section-title"],["appearance","outline",1,"full-width"],["type","text","matInput","","formControlName","courseSearch","placeholder","Type to search courses...",3,"matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["matSuffix",""],["matInput","","formControlName","courseId","readonly",""],["type","text","matInput","","formControlName","topicSearch","placeholder","Type to search topics...",3,"matAutocomplete","disabled"],["class","course-warning",4,"ngIf"],["matInput","","formControlName","topicId","required","","readonly",""],[4,"ngIf"],["matInput","","formControlName","title","required","","placeholder","Enter lesson title..."],[1,"rich-text-field"],[1,"rich-text-label"],[1,"rich-text-container"],["formControlName","description","placeholder","Enter lesson description...","theme","snow",3,"modules"],["formControlName","contentType","required",""],["value","video"],["value","article"],["value","quiz"],["value","exercise"],["matInput","","formControlName","contentUrl","type","url","placeholder","https://example.com/content"],["matInput","","type","number","formControlName","durationMinutes","min","0","placeholder","0"],["appearance","outline","class","full-width",4,"ngIf"],[1,"checkbox-container"],["formControlName","isFree",1,"full-width"],[1,"section-header"],["mat-raised-button","","color","accent","type","button",1,"add-keynote-btn",3,"click"],["formArrayName","keynotes",1,"keynotes-container"],["class","keynote-panel",3,"formGroupName","expanded",4,"ngFor","ngForOf"],["class","no-keynotes",4,"ngIf"],["mat-raised-button","","color","accent","type","button",1,"add-tag-btn",3,"click"],["formArrayName","tags",1,"tags-container"],["class","tag-item",3,"formGroupName",4,"ngFor","ngForOf"],["class","no-tags",4,"ngIf"],[1,"button-container"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",4,"ngIf"],[3,"value"],[1,"course-warning"],["matInput","","type","number","formControlName","orderNumber","min","1"],[1,"keynote-panel",3,"formGroupName","expanded"],[1,"keynote-title-container"],[1,"keynote-icon"],[1,"keynote-title"],["class","important-chip",4,"ngIf"],[1,"content-type-chip",3,"ngClass"],[1,"keynote-preview"],[1,"keynote-form"],["matInput","","formControlName","title","required",""],["value","text"],["value","bullet_points"],["value","quote"],["value","example"],[1,"rich-text-field","keynote-field"],[1,"rich-text-container","keynote-editor"],["formControlName","content","theme","snow",3,"modules","placeholder"],[1,"rich-text-hint"],["class","rich-text-error",4,"ngIf"],[1,"form-row"],["formControlName","isImportant",1,"checkbox-field"],["formControlName","hasVisualAid",1,"checkbox-field"],["appearance","outline",1,"half-width"],["formControlName","relatedPlanet"],["value",""],["value","Sun"],["value","Moon"],["value","Mars"],["value","Mercury"],["value","Jupiter"],["value","Venus"],["value","Saturn"],["value","Rahu"],["value","Ketu"],["formControlName","relatedZodiac"],["value","Aries"],["value","Taurus"],["value","Gemini"],["value","Cancer"],["value","Leo"],["value","Virgo"],["value","Libra"],["value","Scorpio"],["value","Sagittarius"],["value","Capricorn"],["value","Aquarius"],["value","Pisces"],[1,"keynote-tags-section"],[1,"section-subtitle"],["mat-button","","color","accent","type","button",1,"add-keynote-tag-btn",3,"click"],["formArrayName","keynoteTags",1,"keynote-tags-container"],["class","keynote-tag-item",3,"formGroupName",4,"ngFor","ngForOf"],["class","no-keynote-tags",4,"ngIf"],[1,"keynote-actions"],["mat-button","","color","warn","type","button","matTooltip","Remove this keynote",3,"click"],[1,"important-chip"],[1,"rich-text-error"],["matInput","","formControlName","visualAidUrl","type","url"],[1,"keynote-tag-item",3,"formGroupName"],["appearance","outline",1,"tag-select"],["formControlName","tagId","required",""],["appearance","outline",1,"relevance-score"],["matInput","","formControlName","relevanceScore","type","number","min","1","max","10"],["mat-icon-button","","color","warn","type","button","matTooltip","Remove this tag",1,"remove-tag-btn",3,"click"],[1,"no-keynote-tags"],[1,"no-keynotes"],[1,"tag-item",3,"formGroupName"],["matInput","","formControlName","relevanceScore","type","number","min","1"],[1,"tag-actions"],["mat-icon-button","","color","primary","type","button","matTooltip","Save this tag",1,"save-tag-btn",3,"click"],["mat-button","","color","warn","type","button","matTooltip","Remove this tag",3,"click"],[1,"no-tags"],["diameter","20"]],template:function(e,i){e&1&&(a(0,"div",2)(1,"div",3)(2,"h1"),r(3),n(),a(4,"button",4),x("click",function(){return i.goBack()}),a(5,"mat-icon"),r(6,"arrow_back"),n(),r(7," Back to Lessons "),n()(),a(8,"mat-card")(9,"mat-card-header")(10,"mat-card-title"),r(11,"Lesson Information"),n()(),a(12,"mat-card-content"),p(13,to,4,0,"div",5)(14,Mo,119,26,"form",6),n()()()),e&2&&(d(3),w(i.isEditMode?"Edit Lesson"+(i.lessonId?" (ID: "+i.lessonId+")":""):"Add New Lesson"),d(10),c("ngIf",i.loading),d(),c("ngIf",!i.loading))},dependencies:[ee,ge,fe,J,he,Se,jt,Ce,zt,be,Kt,Yt,Xt,Zt,Ut,Wt,Gt,Qt,Ae,Pe,we,tn,en,nn,Oe,Le,oe,ie,ye,se,Ie,Me,ke,Ee,je,He,xe,Ke,Ve,Ne,On,Ln,Fe,Yn,mt,Wn,Xn,Zn,re,ae,Be,dn,Ht,qt,qe,Re,an,on,Fn,Dn],styles:[".container[_ngcontent-%COMP%]{padding:20px;max-width:1000px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid #e0e0e0}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;color:#1976d2;font-weight:500}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:60px 20px;color:#666}.loading-container[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-bottom:16px}.section[_ngcontent-%COMP%]{margin-bottom:30px}.section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:18px;font-weight:500;margin-bottom:20px;color:#333}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.add-keynote-btn[_ngcontent-%COMP%], .add-tag-btn[_ngcontent-%COMP%]{min-width:140px}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}.course-warning[_ngcontent-%COMP%]{color:#ff6b6b!important;font-weight:500}.rich-text-field[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.rich-text-label[_ngcontent-%COMP%]{display:block;font-size:12px;font-weight:500;color:#0009;margin-bottom:8px;font-family:Roboto,Helvetica Neue,sans-serif}.rich-text-container[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.12);border-radius:4px;min-height:120px;background-color:#fff;transition:border-color .15s ease}.rich-text-container[_ngcontent-%COMP%]   .ql-editor[_ngcontent-%COMP%]{min-height:100px;font-family:Roboto,Helvetica Neue,sans-serif;font-size:14px;line-height:1.5}.rich-text-container[_ngcontent-%COMP%]   .ql-toolbar[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.12);font-family:Roboto,Helvetica Neue,sans-serif}.rich-text-container[_ngcontent-%COMP%]:focus-within{border-color:#1976d2;box-shadow:0 0 0 1px #1976d2}.rich-text-hint[_ngcontent-%COMP%]{font-size:12px;color:#0009;margin-top:4px;font-family:Roboto,Helvetica Neue,sans-serif}.rich-text-error[_ngcontent-%COMP%]{font-size:12px;color:#f44336;margin-top:4px;font-family:Roboto,Helvetica Neue,sans-serif}.keynote-field[_ngcontent-%COMP%]{margin-bottom:20px}.keynote-editor[_ngcontent-%COMP%]{min-height:100px}.keynote-editor[_ngcontent-%COMP%]   .ql-editor[_ngcontent-%COMP%]{min-height:80px}.half-width[_ngcontent-%COMP%]{width:48%;margin-bottom:15px}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center;margin-bottom:15px}.checkbox-field[_ngcontent-%COMP%]{margin-right:20px}.keynotes-container[_ngcontent-%COMP%], .tags-container[_ngcontent-%COMP%]{max-height:600px;overflow-y:auto;border:1px solid #e0e0e0;border-radius:8px;padding:12px;background-color:#fafafa}.tag-item[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:16px;margin-bottom:12px;position:relative}.tag-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}.tag-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:12px;padding-top:12px;border-top:1px solid #f0f0f0}.keynote-tags-section[_ngcontent-%COMP%]{margin-top:20px;padding:16px;background-color:#f8f9fa;border-radius:8px;border:1px solid #e9ecef}.section-subtitle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:16px;font-weight:500;margin:0;color:#495057}.keynote-tag-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;background-color:#fff;border:1px solid #dee2e6;border-radius:6px;padding:12px;margin-bottom:8px}.tag-select[_ngcontent-%COMP%]{flex:2;margin-bottom:0}.relevance-score[_ngcontent-%COMP%]{flex:1;margin-bottom:0}.remove-tag-btn[_ngcontent-%COMP%]{flex-shrink:0;width:40px;height:40px}.add-keynote-tag-btn[_ngcontent-%COMP%]{font-size:12px;height:32px}.no-keynote-tags[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#6c757d;font-style:italic;padding:12px;justify-content:center}.keynote-panel[_ngcontent-%COMP%]{margin-bottom:12px;border:1px solid #e0e0e0;border-radius:8px;overflow:hidden}.keynote-panel[_ngcontent-%COMP%]:last-child{margin-bottom:0}.keynote-title-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex:1}.keynote-icon[_ngcontent-%COMP%]{color:#666;font-size:20px}.keynote-title[_ngcontent-%COMP%]{font-weight:500;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.important-chip[_ngcontent-%COMP%]{background-color:#ff6b6b;color:#fff;font-size:11px;height:24px;min-height:24px}.content-type-chip[_ngcontent-%COMP%]{font-size:11px;height:24px;min-height:24px;color:#fff}.content-type-text[_ngcontent-%COMP%]{background-color:#4caf50}.content-type-bullet_points[_ngcontent-%COMP%]{background-color:#ff9800}.content-type-quote[_ngcontent-%COMP%]{background-color:#9c27b0}.content-type-example[_ngcontent-%COMP%]{background-color:#2196f3}.keynote-preview[_ngcontent-%COMP%]{color:#666;font-size:12px;max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.keynote-form[_ngcontent-%COMP%]{padding:20px;background-color:#fff;border-radius:8px;margin:8px 0}.keynote-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:20px;padding-top:16px;border-top:1px solid #f0f0f0}.no-keynotes[_ngcontent-%COMP%], .no-tags[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#666}.no-keynotes[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .no-tags[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px;opacity:.5}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:30px;padding-top:20px;border-top:1px solid #e0e0e0}.button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:120px}.button-container[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-right:8px}.checkbox-container[_ngcontent-%COMP%]{margin:20px 0;padding:16px;background-color:#f8f9fa;border-radius:8px;border:1px solid #e9ecef}mat-checkbox[_ngcontent-%COMP%]{margin-bottom:15px}mat-divider[_ngcontent-%COMP%]{margin:30px 0}@media (max-width: 768px){.section-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.form-row[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.half-width[_ngcontent-%COMP%]{width:100%}.keynote-title-container[_ngcontent-%COMP%]{flex-wrap:wrap}.keynote-title[_ngcontent-%COMP%]{max-width:150px}}"]})};var qr=[{path:"",component:Ge},{path:"add",component:le},{path:"update/:id",component:le}];export{qr as LESSONS_ROUTES};

import{a as Pt,b as kt,c as wt,d as Bt}from"./chunk-32VHNBSO.js";import{a as Yt,b as Jt,c as Kt,d as Qt,e as Wt,f as Xt,h as F}from"./chunk-N242QITP.js";import{a as ee,b as ie}from"./chunk-AUNNH457.js";import{a as Et,b as Tt}from"./chunk-OZIBLGHY.js";import{a as pt,b as ft,c as ut,e as gt,g as _t}from"./chunk-ZNL3IKF2.js";import{a as Rt,b as Lt,c as Vt,d as $t,e as jt,f as qt,g as At,h as Ut,i as Ht,j as Gt,k as zt,l as Zt,m as te}from"./chunk-LZWXBBKL.js";import{b as bt,c as St,d as w,e as B}from"./chunk-PNTWHU5I.js";import{l as Ft,m as Ot}from"./chunk-BYQJPZHC.js";import"./chunk-EFSOZXE7.js";import{a as Ct,b as xt,c as ht,e as vt,h as Nt,i as Mt}from"./chunk-TGCRKVSN.js";import{$a as S,$c as nt,Ab as L,Bb as a,Cb as Y,Db as _,Ea as r,Eb as J,Fa as f,Jb as D,Mb as I,Ob as V,Pb as K,Qc as Z,Sc as tt,Ua as l,Uc as x,V as G,Wc as et,Xc as it,Yd as st,Za as m,_ as z,ad as ot,ca as b,cd as at,fd as rt,gb as o,hb as n,hc as E,he as dt,ib as p,id as ct,jb as u,jd as mt,ka as v,kb as g,la as N,lc as Q,ld as lt,mb as y,ne as P,oc as W,pb as C,pc as T,pe as yt,qe as k,rb as h,re as Dt,sc as X,se as It}from"./chunk-7VMAUSLR.js";import{a as U,b as H}from"./chunk-GAL4ENT6.js";var M=class i{constructor(t){this.http=t}apiUrl=`${Z.apiUrl}/notifications`;getNotifications(){return this.http.get(this.apiUrl)}getNotificationById(t){return this.http.get(`${this.apiUrl}/${t}`)}getNotificationsByLoginId(t){return this.http.get(`${this.apiUrl}/user/${t}`)}createNotification(t){return this.http.post(this.apiUrl,t)}updateNotification(t,e){return this.http.put(`${this.apiUrl}/${t}`,e)}deleteNotification(t){return this.http.delete(`${this.apiUrl}/${t}`)}static \u0275fac=function(e){return new(e||i)(z(X))};static \u0275prov=G({token:i,factory:i.\u0275fac,providedIn:"root"})};function se(i,t){i&1&&(o(0,"mat-error"),a(1," Login ID is required for specific user notifications "),n())}function de(i,t){if(i&1&&(o(0,"mat-form-field",7)(1,"mat-label"),a(2,"Login ID"),n(),p(3,"input",22),l(4,se,2,0,"mat-error",9),o(5,"mat-hint"),a(6,"Leave empty and check broadcast above to send to all users"),n()()),i&2){let e,c=h();r(4),m("ngIf",(e=c.notificationForm.get("loginId"))==null?null:e.hasError("required"))}}function pe(i,t){i&1&&(o(0,"mat-error"),a(1," Title is required "),n())}function fe(i,t){i&1&&(o(0,"mat-error"),a(1," Message is required "),n())}function ue(i,t){i&1&&(o(0,"mat-error"),a(1," Notification type is required "),n())}var O=class i{constructor(t,e,c,s,d){this.fb=t;this.notificationService=e;this.snackBar=c;this.dialogRef=s;this.data=d;this.editMode=!!d?.notification,this.notificationForm=this.createForm(),this.editMode&&d.notification&&this.populateForm(d.notification)}notificationForm;editMode=!1;isLoading=!1;createForm(){return this.fb.group({isBroadcast:[!1],loginId:[""],title:["",[x.required,x.minLength(3)]],message:["",[x.required,x.minLength(10)]],notificationType:["push",x.required],startDate:[""],expiryDate:[""],isRead:[!1]})}onBroadcastChange(){let t=this.notificationForm.get("isBroadcast")?.value,e=this.notificationForm.get("loginId");t?(e?.setValue(""),e?.clearValidators()):e?.setValidators([x.required,x.min(1)]),e?.updateValueAndValidity()}populateForm(t){this.notificationForm.patchValue({isBroadcast:t.isBroadcast||!1,loginId:t.loginId,title:t.title,message:t.message,notificationType:t.notificationType||"push",startDate:t.startDate?new Date(t.startDate):"",expiryDate:t.expiryDate?new Date(t.expiryDate):"",isRead:t.isRead||!1}),this.onBroadcastChange()}onSubmit(){if(this.notificationForm.valid&&!this.isLoading){this.isLoading=!0;let t=this.notificationForm.value,e={isBroadcast:t.isBroadcast,loginId:t.isBroadcast?void 0:t.loginId,title:t.title,message:t.message,notificationType:t.notificationType,startDate:t.startDate?t.startDate.toISOString().split("T")[0]:void 0,expiryDate:t.expiryDate?t.expiryDate.toISOString().split("T")[0]:void 0,isRead:t.isRead};this.editMode&&this.data.notification?(e.notificationId=this.data.notification.notificationId,this.updateNotification(e)):this.createNotification(e)}}createNotification(t){this.notificationService.createNotification(t).subscribe({next:e=>{this.snackBar.open("Notification created successfully","Close",{duration:3e3}),this.dialogRef.close(e)},error:e=>{console.error("Error creating notification:",e),this.snackBar.open("Error creating notification","Close",{duration:3e3}),this.isLoading=!1}})}updateNotification(t){this.notificationService.updateNotification(t.notificationId,t).subscribe({next:e=>{this.snackBar.open("Notification updated successfully","Close",{duration:3e3}),this.dialogRef.close(e)},error:e=>{console.error("Error updating notification:",e),this.snackBar.open("Error updating notification","Close",{duration:3e3}),this.isLoading=!1}})}static \u0275fac=function(e){return new(e||i)(f(mt),f(M),f(w),f(Yt),f(Jt))};static \u0275cmp=b({type:i,selectors:[["app-notification-form"]],standalone:!0,features:[D],decls:53,vars:12,consts:[["startPicker",""],["expiryPicker",""],["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"broadcast-toggle"],["formControlName","isBroadcast",3,"change"],["appearance","fill","class","full-width",4,"ngIf"],["appearance","fill",1,"full-width"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["matInput","","formControlName","message","rows","4","required",""],["formControlName","notificationType","required",""],["value","push"],["value","email"],["matInput","","formControlName","startDate",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","expiryDate",3,"matDatepicker"],[1,"checkbox-container"],["formControlName","isRead"],[1,"button-container"],["mat-button","","type","button","mat-dialog-close",""],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["matInput","","formControlName","loginId","type","number"]],template:function(e,c){if(e&1){let s=y();o(0,"h2",2),a(1),n(),o(2,"mat-dialog-content")(3,"form",3),C("ngSubmit",function(){return v(s),N(c.onSubmit())}),o(4,"div",4)(5,"mat-checkbox",5),C("change",function(){return v(s),N(c.onBroadcastChange())}),a(6," Send to All Users (Broadcast) "),n()(),l(7,de,7,1,"mat-form-field",6),o(8,"mat-form-field",7)(9,"mat-label"),a(10,"Title"),n(),p(11,"input",8),l(12,pe,2,0,"mat-error",9),n(),o(13,"mat-form-field",7)(14,"mat-label"),a(15,"Message"),n(),p(16,"textarea",10),l(17,fe,2,0,"mat-error",9),n(),o(18,"mat-form-field",7)(19,"mat-label"),a(20,"Notification Type"),n(),o(21,"mat-select",11)(22,"mat-option",12),a(23,"Push Notification"),n(),o(24,"mat-option",13),a(25,"Email"),n()(),l(26,ue,2,0,"mat-error",9),n(),o(27,"mat-form-field",7)(28,"mat-label"),a(29,"Start Date"),n(),p(30,"input",14),o(31,"mat-hint"),a(32,"Leave empty for immediate delivery"),n(),p(33,"mat-datepicker-toggle",15)(34,"mat-datepicker",null,0),n(),o(36,"mat-form-field",7)(37,"mat-label"),a(38,"Expiry Date"),n(),p(39,"input",16),o(40,"mat-hint"),a(41,"Leave empty for no expiry"),n(),p(42,"mat-datepicker-toggle",15)(43,"mat-datepicker",null,1),n(),o(45,"div",17)(46,"mat-checkbox",18),a(47,"Mark as Read"),n()(),o(48,"div",19)(49,"button",20),a(50,"Cancel"),n(),o(51,"button",21),a(52),n()()()()}if(e&2){let s,d,$,j,q=L(35),A=L(44);r(),_("",c.editMode?"Edit":"Create"," Notification"),r(2),m("formGroup",c.notificationForm),r(4),m("ngIf",!((s=c.notificationForm.get("isBroadcast"))!=null&&s.value)),r(5),m("ngIf",(d=c.notificationForm.get("title"))==null?null:d.hasError("required")),r(5),m("ngIf",($=c.notificationForm.get("message"))==null?null:$.hasError("required")),r(9),m("ngIf",(j=c.notificationForm.get("notificationType"))==null?null:j.hasError("required")),r(4),m("matDatepicker",q),r(3),m("for",q),r(6),m("matDatepicker",A),r(3),m("for",A),r(9),m("disabled",c.notificationForm.invalid||c.isLoading),r(),_(" ",c.isLoading?"Saving...":c.editMode?"Update":"Create"," ")}},dependencies:[T,E,lt,nt,tt,ot,et,it,ct,at,rt,Mt,Nt,Ct,ht,xt,vt,St,bt,Ot,Ft,dt,k,P,F,Qt,Wt,Xt,B,Bt,Pt,kt,wt,st,ie,ee],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}.checkbox-container[_ngcontent-%COMP%]{margin:16px 0}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px;margin-top:16px}.broadcast-toggle[_ngcontent-%COMP%]{margin:16px 0;padding:12px;background-color:#f5f5f5;border-radius:4px}mat-dialog-content[_ngcontent-%COMP%]{min-width:500px;max-width:600px}"]})};function ge(i,t){i&1&&(o(0,"th",23),a(1," Login ID "),n())}function _e(i,t){if(i&1&&(o(0,"span"),a(1),n()),i&2){let e=h().$implicit;r(),Y(e.loginId)}}function Ce(i,t){i&1&&(o(0,"span",27),a(1,"All Users"),n())}function xe(i,t){if(i&1&&(o(0,"td",24),l(1,_e,2,1,"span",25)(2,Ce,2,0,"span",26),n()),i&2){let e=t.$implicit;r(),m("ngIf",!e.isBroadcast),r(),m("ngIf",e.isBroadcast)}}function he(i,t){i&1&&(o(0,"th",23),a(1," Broadcast "),n())}function ve(i,t){if(i&1&&(o(0,"td",24)(1,"span",28),a(2),n()()),i&2){let e=t.$implicit;r(),S("is-broadcast",e.isBroadcast)("not-broadcast",!e.isBroadcast),r(),_(" ",e.isBroadcast?"Yes":"No"," ")}}function Ne(i,t){i&1&&(o(0,"th",23),a(1," Title "),n())}function Me(i,t){if(i&1&&(o(0,"td",24),a(1),n()),i&2){let e=t.$implicit;r(),_(" ",e.title," ")}}function be(i,t){i&1&&(o(0,"th",23),a(1," Message "),n())}function Se(i,t){if(i&1&&(o(0,"td",24)(1,"span",29),a(2),I(3,"slice"),n()()),i&2){let e=t.$implicit;r(),m("matTooltip",e.message),r(),J(" ",K(3,3,e.message,0,50),"",e.message.length>50?"...":""," ")}}function ye(i,t){i&1&&(o(0,"th",23),a(1," Type "),n())}function De(i,t){if(i&1&&(o(0,"td",24)(1,"span",30),a(2),n()()),i&2){let e=t.$implicit;r(),S("type-push",e.notificationType==="push")("type-email",e.notificationType==="email"),r(),_(" ",e.notificationType||"push"," ")}}function Ie(i,t){i&1&&(o(0,"th",23),a(1," Start Date "),n())}function Ee(i,t){if(i&1&&(o(0,"td",24),a(1),I(2,"date"),n()),i&2){let e=t.$implicit;r(),_(" ",e.startDate?V(2,1,e.startDate,"short"):"Immediate"," ")}}function Te(i,t){i&1&&(o(0,"th",23),a(1," Expiry Date "),n())}function Pe(i,t){if(i&1&&(o(0,"td",24),a(1),I(2,"date"),n()),i&2){let e=t.$implicit;r(),_(" ",e.expiryDate?V(2,1,e.expiryDate,"short"):"No expiry"," ")}}function ke(i,t){i&1&&(o(0,"th",23),a(1," Status "),n())}function we(i,t){if(i&1&&(o(0,"td",24)(1,"span",31),a(2),n()()),i&2){let e=t.$implicit;r(),S("read",e.isRead)("unread",!e.isRead),r(),_(" ",e.isRead?"Read":"Unread"," ")}}function Be(i,t){i&1&&(o(0,"th",23),a(1," Actions "),n())}function Fe(i,t){if(i&1){let e=y();o(0,"td",24)(1,"button",32),C("click",function(){let s=v(e).$implicit,d=h(2);return N(d.openNotificationForm(s))}),o(2,"mat-icon"),a(3,"edit"),n()(),o(4,"button",33),C("click",function(){let s=v(e).$implicit,d=h(2);return N(d.deleteNotification(s))}),o(5,"mat-icon"),a(6,"delete"),n()()()}}function Oe(i,t){i&1&&p(0,"tr",34)}function Re(i,t){i&1&&p(0,"tr",35)}function Le(i,t){i&1&&(o(0,"div",36)(1,"mat-icon"),a(2,"notifications_off"),n(),o(3,"p"),a(4,"No notifications found."),n()())}function Ve(i,t){if(i&1&&(o(0,"div",7)(1,"table",8),u(2,9),l(3,ge,2,0,"th",10)(4,xe,3,2,"td",11),g(),u(5,12),l(6,he,2,0,"th",10)(7,ve,3,5,"td",11),g(),u(8,13),l(9,Ne,2,0,"th",10)(10,Me,2,1,"td",11),g(),u(11,14),l(12,be,2,0,"th",10)(13,Se,4,7,"td",11),g(),u(14,15),l(15,ye,2,0,"th",10)(16,De,3,5,"td",11),g(),u(17,16),l(18,Ie,2,0,"th",10)(19,Ee,3,4,"td",11),g(),u(20,17),l(21,Te,2,0,"th",10)(22,Pe,3,4,"td",11),g(),u(23,18),l(24,ke,2,0,"th",10)(25,we,3,5,"td",11),g(),u(26,19),l(27,Be,2,0,"th",10)(28,Fe,7,0,"td",11),g(),l(29,Oe,1,0,"tr",20)(30,Re,1,0,"tr",21),n(),l(31,Le,5,0,"div",22),n()),i&2){let e=h();r(),m("dataSource",e.notifications),r(28),m("matHeaderRowDef",e.displayedColumns),r(),m("matRowDefColumns",e.displayedColumns),r(),m("ngIf",e.notifications.length===0)}}function $e(i,t){i&1&&(o(0,"div",37),p(1,"mat-spinner",38),o(2,"p"),a(3,"Loading notifications..."),n()())}var R=class i{constructor(t,e,c){this.notificationService=t;this.dialog=e;this.snackBar=c}notifications=[];displayedColumns=["loginId","isBroadcast","title","message","notificationType","startDate","expiryDate","isRead","actions"];isLoading=!1;ngOnInit(){this.loadNotifications()}parseCustomDateToString(t){if(t){if(typeof t=="string"){let e=t.split(",").map(Number);if(e.length===6){let s=new Date(e[0],e[1]-1,e[2],e[3],e[4],e[5]);return isNaN(s.getTime())?void 0:s.toISOString()}let c=new Date(t);return isNaN(c.getTime())?void 0:c.toISOString()}if(t instanceof Date)return isNaN(t.getTime())?void 0:t.toISOString()}}loadNotifications(){this.isLoading=!0,this.notificationService.getNotifications().subscribe({next:t=>{this.notifications=t.map(e=>H(U({},e),{startDate:this.parseCustomDateToString(e.startDate),expiryDate:this.parseCustomDateToString(e.expiryDate)})),this.isLoading=!1},error:t=>{console.error("Error loading notifications:",t),this.snackBar.open("Error loading notifications","Close",{duration:3e3}),this.isLoading=!1}})}openNotificationForm(t){this.dialog.open(O,{width:"600px",data:{notification:t}}).afterClosed().subscribe(c=>{c&&this.loadNotifications()})}deleteNotification(t){confirm(`Are you sure you want to delete the notification "${t.title}"?`)&&this.notificationService.deleteNotification(t.notificationId).subscribe({next:()=>{this.snackBar.open("Notification deleted successfully","Close",{duration:3e3}),this.loadNotifications()},error:e=>{console.error("Error deleting notification:",e),this.snackBar.open("Error deleting notification","Close",{duration:3e3})}})}static \u0275fac=function(e){return new(e||i)(f(M),f(Kt),f(w))};static \u0275cmp=b({type:i,selectors:[["app-notifications-page"]],standalone:!0,features:[D],decls:18,vars:2,consts:[[1,"container"],[1,"header-content"],[1,"header-actions"],["mat-icon-button","","color","primary","matTooltip","Refresh notifications",3,"click"],["mat-raised-button","","color","primary",3,"click"],["class","table-container",4,"ngIf"],["class","loading-container",4,"ngIf"],[1,"table-container"],["mat-table","",1,"mat-elevation-z2",3,"dataSource"],["matColumnDef","loginId"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","isBroadcast"],["matColumnDef","title"],["matColumnDef","message"],["matColumnDef","notificationType"],["matColumnDef","startDate"],["matColumnDef","expiryDate"],["matColumnDef","isRead"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","no-data",4,"ngIf"],["mat-header-cell",""],["mat-cell",""],[4,"ngIf"],["class","broadcast-indicator",4,"ngIf"],[1,"broadcast-indicator"],[1,"broadcast-badge"],[1,"message-preview",3,"matTooltip"],[1,"type-badge"],[1,"status-badge"],["mat-icon-button","","color","primary","matTooltip","Edit notification",3,"click"],["mat-icon-button","","color","warn","matTooltip","Delete notification",3,"click"],["mat-header-row",""],["mat-row",""],[1,"no-data"],[1,"loading-container"],["diameter","50"]],template:function(e,c){e&1&&(o(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title")(4,"div",1)(5,"h2"),a(6,"Manage Notifications"),n(),o(7,"div",2)(8,"button",3),C("click",function(){return c.loadNotifications()}),o(9,"mat-icon"),a(10,"refresh"),n()(),o(11,"button",4),C("click",function(){return c.openNotificationForm()}),o(12,"mat-icon"),a(13,"add"),n(),a(14," Add New Notification "),n()()()()(),o(15,"mat-card-content"),l(16,Ve,32,4,"div",5)(17,$e,4,0,"div",6),n()()()),e&2&&(r(16),m("ngIf",!c.isLoading),r(),m("ngIf",c.isLoading))},dependencies:[T,E,W,Q,zt,Rt,Vt,At,$t,Lt,Ut,jt,qt,Ht,Gt,k,P,yt,It,Dt,B,F,_t,pt,ut,gt,ft,te,Zt,Tt,Et],styles:[".container[_ngcontent-%COMP%]{padding:20px;max-width:1400px;margin:0 auto}.header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.header-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#333}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.table-container[_ngcontent-%COMP%]{overflow-x:auto;margin-top:20px}.mat-mdc-table[_ngcontent-%COMP%]{width:100%;background:#fff}.message-preview[_ngcontent-%COMP%]{display:inline-block;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:help}.type-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500;text-transform:uppercase}.type-push[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.type-email[_ngcontent-%COMP%]{background-color:#f3e5f5;color:#7b1fa2}.status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500;text-transform:uppercase}.read[_ngcontent-%COMP%]{background-color:#e8f5e8;color:#2e7d32}.unread[_ngcontent-%COMP%]{background-color:#fff3e0;color:#f57c00}.broadcast-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500;text-transform:uppercase}.is-broadcast[_ngcontent-%COMP%]{background-color:#e8f5e8;color:#2e7d32}.not-broadcast[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#666}.broadcast-indicator[_ngcontent-%COMP%]{font-weight:500;color:#2e7d32;font-style:italic}.mat-mdc-cell[_ngcontent-%COMP%]{padding:8px}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#333}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;color:#666}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;font-size:14px}.no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;color:#666}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:16px}"]})};var ki=[{path:"",component:R,title:"Notifications"}];export{ki as NOTIFICATIONS_ROUTES};

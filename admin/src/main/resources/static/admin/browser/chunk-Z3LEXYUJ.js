import{a as ke,b as U,c as vt}from"./chunk-WLK3FPFS.js";import{a as Ct}from"./chunk-N3SMB2Y6.js";import{a as it,b as _e}from"./chunk-YR5ZPQ4U.js";import{a as ft,b as yt}from"./chunk-RSYMD6GZ.js";import{a as ve,b as Ce}from"./chunk-NF6UG53P.js";import{a as $,b as z}from"./chunk-WP5J22AO.js";import{a as he,c as xe}from"./chunk-YCF43NY4.js";import{a as _t,b as ht,c as xt}from"./chunk-UOK5FKWI.js";import{a as A,b as F,c as D,e as B,g as V}from"./chunk-AKNTJFRO.js";import{a as oe,c as L,d as ae}from"./chunk-FOO45AA2.js";import{a as ot,b as at,c as rt,d as lt,e as st,f as ct,g as dt,h as mt,i as pt,j as gt,k as ut}from"./chunk-VJ2U5WQN.js";import{a as fe,b as ye}from"./chunk-SUVRSA5F.js";import{b as pe,c as ge,q as E,r as H}from"./chunk-FORQPI5O.js";import"./chunk-2GDKZSYE.js";import{a as ce,b as et,c as tt,e as nt,h as de,i as me}from"./chunk-FLUPKQIH.js";import{$a as X,$c as He,Aa as Ie,Ab as _,Ca as l,Cb as ee,Da as f,Db as te,Eb as ne,Gb as P,Hb as ie,Ib as Q,Jb as De,Kb as Te,N as we,Oc as re,Qc as I,Sa as m,Sc as le,Tc as Re,U as Le,Wc as qe,Xa as s,Xc as je,Yc as $e,_ as Ae,_c as ze,ad as Ue,ba as T,bc as Be,bd as We,cc as K,cd as Ge,db as o,dc as O,dd as Qe,eb as n,ed as Ze,ee as se,fb as h,fc as Ve,gb as M,gd as Ye,hb as S,hc as Ne,hd as Je,id as Xe,ja as x,jb as b,ka as v,ke as N,lc as w,mb as y,me as ue,ne as R,o as Oe,ob as p,oe as q,pe as j,xb as Fe,yb as a,zb as u}from"./chunk-BX6X7MJZ.js";import{a as Y,b as J,g as G}from"./chunk-GAL4ENT6.js";var Nt=i=>["/keynotes",i];function Rt(i,e){if(i&1&&(o(0,"mat-option",17),a(1),n()),i&2){let t=e.$implicit;s("value",t.lessonId),l(),_(" ",t.title," ")}}function qt(i,e){i&1&&(o(0,"div",18),h(1,"mat-spinner"),n())}function jt(i,e){i&1&&(o(0,"th",32),a(1,"Order"),n())}function $t(i,e){if(i&1&&(o(0,"td",33)(1,"span",34),a(2),n()()),i&2){let t=e.$implicit;l(2),u(t.orderSequence)}}function zt(i,e){i&1&&(o(0,"th",32),a(1,"Title"),n())}function Ht(i,e){i&1&&(o(0,"mat-icon",38),a(1,"star"),n())}function Ut(i,e){if(i&1&&(o(0,"td",33)(1,"div",35)(2,"span",36),a(3),n(),m(4,Ht,2,0,"mat-icon",37),n()()),i&2){let t=e.$implicit;l(3),u(t.title),l(),s("ngIf",t.isImportant)}}function Wt(i,e){i&1&&(o(0,"th",32),a(1,"Lesson"),n())}function Gt(i,e){if(i&1&&(o(0,"span",42),a(1),n()),i&2){let t=p().$implicit;l(),u(t.topicTitle)}}function Qt(i,e){if(i&1&&(o(0,"td",33)(1,"div",39)(2,"span",40),a(3),n(),m(4,Gt,2,1,"span",41),n()()),i&2){let t=e.$implicit;l(3),u(t.lessonTitle),l(),s("ngIf",t.topicTitle)}}function Zt(i,e){i&1&&(o(0,"th",32),a(1,"Type"),n())}function Yt(i,e){if(i&1&&(o(0,"td",33)(1,"mat-chip"),a(2),n()()),i&2){let t=e.$implicit,r=p(2);l(),X("content-type-chip content-type-",t.contentType,""),l(),_(" ",r.getContentTypeLabel(t.contentType)," ")}}function Jt(i,e){i&1&&(o(0,"th",32),a(1,"Content Preview"),n())}function Xt(i,e){if(i&1&&(o(0,"td",33)(1,"div",43),a(2),n()()),i&2){let t=e.$implicit;l(),s("matTooltip",t.content),l(),_(" ",t.content.length>100?t.content.substring(0,100)+"...":t.content," ")}}function en(i,e){i&1&&(o(0,"th",32),a(1,"Features"),n())}function tn(i,e){i&1&&(o(0,"mat-chip",48)(1,"mat-icon"),a(2,"image"),n(),a(3," Visual Aid "),n())}function nn(i,e){if(i&1&&(o(0,"mat-chip",49),a(1),n()),i&2){let t=p().$implicit;l(),_(" ",t.relatedPlanet," ")}}function on(i,e){if(i&1&&(o(0,"mat-chip",50),a(1),n()),i&2){let t=p().$implicit;l(),_(" ",t.relatedZodiac," ")}}function an(i,e){if(i&1&&(o(0,"td",33)(1,"div",44),m(2,tn,4,0,"mat-chip",45)(3,nn,2,1,"mat-chip",46)(4,on,2,1,"mat-chip",47),n()()),i&2){let t=e.$implicit;l(2),s("ngIf",t.hasVisualAid),l(),s("ngIf",t.relatedPlanet),l(),s("ngIf",t.relatedZodiac)}}function rn(i,e){i&1&&(o(0,"th",32),a(1,"Actions"),n())}function ln(i,e){if(i&1){let t=b();o(0,"td",33)(1,"button",51)(2,"mat-icon"),a(3,"visibility"),n()(),o(4,"button",52),y("click",function(){let c=x(t).$implicit,d=p(2);return v(d.editKeynote(c.keynoteId))}),o(5,"mat-icon"),a(6,"edit"),n()(),o(7,"button",53),y("click",function(){let c=x(t).$implicit,d=p(2);return v(d.deleteKeynote(c))}),o(8,"mat-icon"),a(9,"delete"),n()()()}if(i&2){let t=e.$implicit;l(),s("routerLink",ie(1,Nt,t.keynoteId))}}function sn(i,e){i&1&&h(0,"tr",54)}function cn(i,e){i&1&&h(0,"tr",55)}function dn(i,e){i&1&&(o(0,"div",56)(1,"mat-icon"),a(2,"note_alt"),n(),o(3,"p"),a(4,"No keynotes found"),n(),o(5,"button",2),a(6," Add First Keynote "),n()())}function mn(i,e){if(i&1&&(o(0,"div")(1,"table",19),M(2,20),m(3,jt,2,0,"th",21)(4,$t,3,1,"td",22),S(),M(5,23),m(6,zt,2,0,"th",21)(7,Ut,5,2,"td",22),S(),M(8,24),m(9,Wt,2,0,"th",21)(10,Qt,5,2,"td",22),S(),M(11,25),m(12,Zt,2,0,"th",21)(13,Yt,3,4,"td",22),S(),M(14,26),m(15,Jt,2,0,"th",21)(16,Xt,3,2,"td",22),S(),M(17,27),m(18,en,2,0,"th",21)(19,an,5,3,"td",22),S(),M(20,28),m(21,rn,2,0,"th",21)(22,ln,10,3,"td",22),S(),m(23,sn,1,0,"tr",29)(24,cn,1,0,"tr",30),n(),m(25,dn,7,0,"div",31),n()),i&2){let t=p();l(),s("dataSource",t.keynotes),l(22),s("matHeaderRowDef",t.displayedColumns),l(),s("matRowDefColumns",t.displayedColumns),l(),s("ngIf",t.keynotes.length===0)}}var Me=class i{constructor(e,t,r,c){this.keynoteService=e;this.lessonService=t;this.router=r;this.snackBar=c}keynotes=[];lessons=[];displayedColumns=["order","title","lesson","contentType","content","features","actions"];loading=!1;searchQuery="";selectedLessonId="";selectedContentType="";showImportantOnly=!1;ngOnInit(){this.loadLessons(),this.loadKeynotes()}loadLessons(){this.lessonService.getAllLessons().subscribe({next:e=>{this.lessons=e},error:e=>{console.error("Error loading lessons:",e)}})}loadKeynotes(){this.loading=!0,this.selectedLessonId&&this.showImportantOnly?this.keynoteService.getImportantKeynotesByLessonId(+this.selectedLessonId).subscribe({next:e=>this.handleKeynotesResponse(e),error:e=>this.handleError(e)}):this.selectedLessonId?this.keynoteService.getKeynotesByLessonId(+this.selectedLessonId).subscribe({next:e=>this.handleKeynotesResponse(e),error:e=>this.handleError(e)}):this.searchQuery.trim()?this.keynoteService.searchKeynotes(this.searchQuery).subscribe({next:e=>this.handleKeynotesResponse(e),error:e=>this.handleError(e)}):this.keynoteService.getAllKeynotes().subscribe({next:e=>this.handleKeynotesResponse(e),error:e=>this.handleError(e)})}handleKeynotesResponse(e){let t=e;this.showImportantOnly&&!this.selectedLessonId&&(t=e.filter(r=>r.isImportant)),this.selectedContentType&&(t=t.filter(r=>r.contentType===this.selectedContentType)),this.keynotes=t,this.loading=!1}handleError(e){console.error("Error loading keynotes:",e),this.snackBar.open("Error loading keynotes","Close",{duration:3e3}),this.loading=!1}onSearchChange(){this.searchQuery.trim()?(this.selectedLessonId="",this.loadKeynotes()):this.loadKeynotes()}onLessonFilterChange(){this.searchQuery="",this.loadKeynotes()}onContentTypeFilterChange(){this.loadKeynotes()}getContentTypeLabel(e){switch(e){case"text":return"Text";case"bullet_points":return"Bullet Points";case"quote":return"Quote";case"example":return"Example";default:return e}}editKeynote(e){this.router.navigate(["/keynotes/edit",e])}deleteKeynote(e){confirm(`Are you sure you want to delete the keynote "${e.title}"?`)&&this.keynoteService.deleteKeynote(e.keynoteId).subscribe({next:()=>{this.snackBar.open("Keynote deleted successfully","Close",{duration:3e3}),this.loadKeynotes()},error:t=>{console.error("Error deleting keynote:",t),this.snackBar.open("Error deleting keynote","Close",{duration:3e3})}})}static \u0275fac=function(t){return new(t||i)(f(U),f(ke),f(L),f(E))};static \u0275cmp=T({type:i,selectors:[["app-keynote-list"]],standalone:!0,features:[P],decls:47,vars:8,consts:[[1,"container"],[1,"header"],["mat-raised-button","","color","primary","routerLink","/keynotes/add"],[1,"filters-container"],["appearance","outline",1,"filter-field"],["matInput","","placeholder","Search by title or content...",3,"ngModelChange","input","ngModel"],["matSuffix",""],[3,"ngModelChange","selectionChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["value","text"],["value","bullet_points"],["value","quote"],["value","example"],["mat-stroked-button","",3,"click","color"],["class","loading-container",4,"ngIf"],[4,"ngIf"],[3,"value"],[1,"loading-container"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","order"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","title"],["matColumnDef","lesson"],["matColumnDef","contentType"],["matColumnDef","content"],["matColumnDef","features"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","no-data",4,"ngIf"],["mat-header-cell",""],["mat-cell",""],[1,"order-badge"],[1,"title-cell"],[1,"keynote-title"],["class","important-icon","color","warn",4,"ngIf"],["color","warn",1,"important-icon"],[1,"lesson-info"],[1,"lesson-title"],["class","topic-title",4,"ngIf"],[1,"topic-title"],[1,"content-preview",3,"matTooltip"],[1,"feature-chips"],["class","feature-chip visual-aid-chip",4,"ngIf"],["class","feature-chip planet-chip",4,"ngIf"],["class","feature-chip zodiac-chip",4,"ngIf"],[1,"feature-chip","visual-aid-chip"],[1,"feature-chip","planet-chip"],[1,"feature-chip","zodiac-chip"],["mat-icon-button","","color","primary","matTooltip","View Details",3,"routerLink"],["mat-icon-button","","color","accent","matTooltip","Edit Keynote",3,"click"],["mat-icon-button","","color","warn","matTooltip","Delete Keynote",3,"click"],["mat-header-row",""],["mat-row",""],[1,"no-data"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"div",1)(2,"h1"),a(3,"Lesson Keynotes Management"),n(),o(4,"button",2)(5,"mat-icon"),a(6,"add"),n(),a(7," Add Keynote "),n()(),o(8,"mat-card")(9,"mat-card-header")(10,"mat-card-title"),a(11,"Keynotes"),n()(),o(12,"mat-card-content")(13,"div",3)(14,"mat-form-field",4)(15,"mat-label"),a(16,"Search keynotes"),n(),o(17,"input",5),ne("ngModelChange",function(d){return te(r.searchQuery,d)||(r.searchQuery=d),d}),y("input",function(){return r.onSearchChange()}),n(),o(18,"mat-icon",6),a(19,"search"),n()(),o(20,"mat-form-field",4)(21,"mat-label"),a(22,"Filter by Lesson"),n(),o(23,"mat-select",7),ne("ngModelChange",function(d){return te(r.selectedLessonId,d)||(r.selectedLessonId=d),d}),y("selectionChange",function(){return r.onLessonFilterChange()}),o(24,"mat-option",8),a(25,"All Lessons"),n(),m(26,Rt,2,2,"mat-option",9),n()(),o(27,"mat-form-field",4)(28,"mat-label"),a(29,"Content Type"),n(),o(30,"mat-select",7),ne("ngModelChange",function(d){return te(r.selectedContentType,d)||(r.selectedContentType=d),d}),y("selectionChange",function(){return r.onContentTypeFilterChange()}),o(31,"mat-option",8),a(32,"All Types"),n(),o(33,"mat-option",10),a(34,"Text"),n(),o(35,"mat-option",11),a(36,"Bullet Points"),n(),o(37,"mat-option",12),a(38,"Quote"),n(),o(39,"mat-option",13),a(40,"Example"),n()()(),o(41,"button",14),y("click",function(){return r.showImportantOnly=!r.showImportantOnly,r.loadKeynotes()}),o(42,"mat-icon"),a(43),n(),a(44," Important Only "),n()(),m(45,qt,2,0,"div",15)(46,mn,26,4,"div",16),n()()()),t&2&&(l(17),ee("ngModel",r.searchQuery),l(6),ee("ngModel",r.selectedLessonId),l(3),s("ngForOf",r.lessons),l(4),ee("ngModel",r.selectedContentType),l(11),s("color",r.showImportantOnly?"primary":""),l(2),u(r.showImportantOnly?"star":"star_border"),l(2),s("ngIf",r.loading),l(),s("ngIf",!r.loading))},dependencies:[w,K,O,ae,Je,re,le,qe,ut,ot,rt,dt,lt,at,mt,st,ct,pt,gt,V,A,D,B,F,R,N,ue,j,q,me,de,ce,nt,ge,pe,ye,fe,se,xe,he,H,z,$,Ce,ve],styles:[".container[_ngcontent-%COMP%]{padding:20px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.filters-container[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:20px;align-items:center;flex-wrap:wrap}.filter-field[_ngcontent-%COMP%]{min-width:200px}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px}.full-width[_ngcontent-%COMP%]{width:100%}.order-badge[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1565c0;padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500}.title-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.keynote-title[_ngcontent-%COMP%]{font-weight:500}.important-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.lesson-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.lesson-title[_ngcontent-%COMP%]{font-weight:500;color:#333}.topic-title[_ngcontent-%COMP%]{font-size:12px;color:#666}.content-type-chip[_ngcontent-%COMP%]{font-size:11px;font-weight:500}.content-type-text[_ngcontent-%COMP%]{background-color:#e8f5e8;color:#2e7d32}.content-type-bullet_points[_ngcontent-%COMP%]{background-color:#fff3e0;color:#e65100}.content-type-quote[_ngcontent-%COMP%]{background-color:#f3e5f5;color:#7b1fa2}.content-type-example[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1565c0}.content-preview[_ngcontent-%COMP%]{max-width:300px;line-height:1.4;color:#666}.feature-chips[_ngcontent-%COMP%]{display:flex;gap:4px;flex-wrap:wrap}.feature-chip[_ngcontent-%COMP%]{font-size:10px;height:24px;display:flex;align-items:center;gap:4px}.visual-aid-chip[_ngcontent-%COMP%]{background-color:#fff9c4;color:#f57f17}.planet-chip[_ngcontent-%COMP%]{background-color:#fce4ec;color:#c2185b}.zodiac-chip[_ngcontent-%COMP%]{background-color:#e1f5fe;color:#0277bd}.feature-chip[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:12px;width:12px;height:12px}.no-data[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:16px}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:16px 0 24px;font-size:16px}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:12px 8px}.mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#0000000a}@media (max-width: 768px){.header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.filters-container[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.filter-field[_ngcontent-%COMP%]{min-width:auto;width:100%}}"]})};var pn=i=>["/keynotes/edit",i];function gn(i,e){if(i&1&&(o(0,"button",8)(1,"mat-icon"),a(2,"edit"),n(),a(3," Edit Keynote "),n()),i&2){let t=p();s("routerLink",ie(1,pn,t.keynote.keynoteId))}}function un(i,e){i&1&&(o(0,"div",9),h(1,"mat-spinner"),n())}function fn(i,e){i&1&&(o(0,"mat-chip",31)(1,"mat-icon"),a(2,"star"),n(),a(3," Important "),n())}function yn(i,e){if(i&1&&(o(0,"div",20)(1,"span",21),a(2,"Topic:"),n(),o(3,"span",24),a(4),n()()),i&2){let t=p(2);l(4),u(t.keynote.topicTitle)}}function _n(i,e){if(i&1&&(o(0,"li"),a(1),n()),i&2){let t=e.$implicit;l(),u(t)}}function hn(i,e){if(i&1&&(o(0,"div",32)(1,"ul"),m(2,_n,2,1,"li",33),n()()),i&2){let t=p(2);l(2),s("ngForOf",t.getBulletPoints(t.keynote.content))}}function xn(i,e){if(i&1&&(o(0,"div",34)(1,"blockquote")(2,"mat-icon"),a(3,"format_quote"),n(),a(4),n()()),i&2){let t=p(2);l(4),_(" ",t.keynote.content," ")}}function vn(i,e){if(i&1&&(o(0,"div",35)(1,"p"),a(2),n()()),i&2){let t=p(2);l(2),u(t.keynote.content)}}function Cn(i,e){if(i&1){let t=b();o(0,"mat-card",18)(1,"mat-card-header")(2,"mat-card-title"),a(3,"Visual Aid"),n()(),o(4,"mat-card-content")(5,"div",36)(6,"img",37),y("error",function(c){x(t);let d=p(2);return v(d.onImageError(c))}),n(),o(7,"div",38)(8,"span",21),a(9,"URL:"),n(),o(10,"a",39),a(11),o(12,"mat-icon"),a(13,"open_in_new"),n()()()()()()}if(i&2){let t=p(2);l(6),s("src",t.keynote.visualAidUrl,Ie)("alt",t.keynote.title),l(4),s("href",t.keynote.visualAidUrl,Ie),l(),_(" ",t.keynote.visualAidUrl," ")}}function kn(i,e){if(i&1&&(o(0,"mat-chip",43)(1,"mat-icon"),a(2,"brightness_1"),n(),a(3),n()),i&2){let t=p(3);l(3),_(" ",t.keynote.relatedPlanet," ")}}function Mn(i,e){if(i&1&&(o(0,"mat-chip",44)(1,"mat-icon"),a(2,"stars"),n(),a(3),n()),i&2){let t=p(3);l(3),_(" ",t.keynote.relatedZodiac," ")}}function Sn(i,e){if(i&1&&(o(0,"mat-card",18)(1,"mat-card-header")(2,"mat-card-title"),a(3,"Astrological Relations"),n()(),o(4,"mat-card-content")(5,"div",40),m(6,kn,4,1,"mat-chip",41)(7,Mn,4,1,"mat-chip",42),n()()()),i&2){let t=p(2);l(6),s("ngIf",t.keynote.relatedPlanet),l(),s("ngIf",t.keynote.relatedZodiac)}}function bn(i,e){if(i&1&&(o(0,"div",20)(1,"span",21),a(2,"Created:"),n(),o(3,"span",24),a(4),Q(5,"date"),n()()),i&2){let t=p(2);l(4),u(Te(5,1,t.keynote.createdAt,"medium"))}}function En(i,e){if(i&1&&(o(0,"div",20)(1,"span",21),a(2,"Last Updated:"),n(),o(3,"span",24),a(4),Q(5,"date"),n()()),i&2){let t=p(2);l(4),u(Te(5,1,t.keynote.updatedAt,"medium"))}}function In(i,e){if(i&1&&(o(0,"div",10)(1,"mat-card",11)(2,"mat-card-content")(3,"div",12)(4,"div",13)(5,"h2",14),a(6),n(),o(7,"div",15)(8,"mat-chip",16),a(9),n(),m(10,fn,4,0,"mat-chip",17),o(11,"mat-chip"),a(12),n()()()()()(),o(13,"mat-card",18)(14,"mat-card-header")(15,"mat-card-title"),a(16,"Lesson Information"),n()(),o(17,"mat-card-content")(18,"div",19)(19,"div",20)(20,"span",21),a(21,"Lesson:"),n(),o(22,"span",22),a(23),n()(),m(24,yn,5,1,"div",23),o(25,"div",20)(26,"span",21),a(27,"Lesson ID:"),n(),o(28,"span",24),a(29),n()()()()(),o(30,"mat-card",25)(31,"mat-card-header")(32,"mat-card-title"),a(33,"Content"),n()(),o(34,"mat-card-content")(35,"div",26),m(36,hn,3,1,"div",27)(37,xn,5,1,"div",28)(38,vn,3,1,"div",29),n()()(),m(39,Cn,14,4,"mat-card",30)(40,Sn,8,2,"mat-card",30),o(41,"mat-card",18)(42,"mat-card-header")(43,"mat-card-title"),a(44,"System Information"),n()(),o(45,"mat-card-content")(46,"div",19)(47,"div",20)(48,"span",21),a(49,"Keynote ID:"),n(),o(50,"span",24),a(51),n()(),m(52,bn,6,4,"div",23)(53,En,6,4,"div",23),n()()()()),i&2){let t=p();l(6),u(t.keynote.title),l(3),_("Order: ",t.keynote.orderSequence,""),l(),s("ngIf",t.keynote.isImportant),l(),X("content-type-badge content-type-",t.keynote.contentType,""),l(),_(" ",t.getContentTypeLabel(t.keynote.contentType)," "),l(11),u(t.keynote.lessonTitle),l(),s("ngIf",t.keynote.topicTitle),l(5),u(t.keynote.lessonId),l(6),s("ngClass","content-type-"+t.keynote.contentType),l(),s("ngIf",t.keynote.contentType==="bullet_points"),l(),s("ngIf",t.keynote.contentType==="quote"),l(),s("ngIf",t.keynote.contentType==="text"||t.keynote.contentType==="example"),l(),s("ngIf",t.keynote.hasVisualAid&&t.keynote.visualAidUrl),l(),s("ngIf",t.keynote.relatedPlanet||t.keynote.relatedZodiac),l(11),u(t.keynote.keynoteId),l(),s("ngIf",t.keynote.createdAt),l(),s("ngIf",t.keynote.updatedAt)}}function Tn(i,e){if(i&1){let t=b();o(0,"div",45)(1,"mat-icon"),a(2,"note_alt"),n(),o(3,"h2"),a(4,"Keynote Not Found"),n(),o(5,"p"),a(6,"The keynote you're looking for doesn't exist or has been deleted."),n(),o(7,"button",46),y("click",function(){x(t);let c=p();return v(c.goBack())}),a(8," Go Back to Keynotes "),n()()}}var Se=class i{constructor(e,t,r,c){this.route=e;this.router=t;this.keynoteService=r;this.snackBar=c}keynoteId=null;keynote=null;loading=!1;ngOnInit(){this.route.params.subscribe(e=>{e.id&&(this.keynoteId=+e.id,this.loadKeynote())})}loadKeynote(){this.keynoteId&&(this.loading=!0,this.keynoteService.getKeynoteById(this.keynoteId).subscribe({next:e=>{this.keynote=e,this.loading=!1},error:e=>{console.error("Error loading keynote:",e),this.snackBar.open("Error loading keynote details","Close",{duration:3e3}),this.loading=!1}}))}getContentTypeLabel(e){switch(e){case"text":return"Text";case"bullet_points":return"Bullet Points";case"quote":return"Quote";case"example":return"Example";default:return e}}getBulletPoints(e){return e.split(`
`).map(t=>t.trim()).filter(t=>t.length>0).map(t=>t.replace(/^[â€¢\-\*]\s*/,""))}onImageError(e){e.target.style.display="none"}goBack(){this.router.navigate(["/keynotes"])}static \u0275fac=function(t){return new(t||i)(f(oe),f(L),f(U),f(E))};static \u0275cmp=T({type:i,selectors:[["app-keynote-details"]],standalone:!0,features:[P],decls:13,vars:4,consts:[[1,"container"],[1,"header"],[1,"actions"],["mat-button","",3,"click"],["mat-raised-button","","color","accent",3,"routerLink",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","keynote-details",4,"ngIf"],["class","no-keynote",4,"ngIf"],["mat-raised-button","","color","accent",3,"routerLink"],[1,"loading-container"],[1,"keynote-details"],[1,"info-card","header-card"],[1,"keynote-header"],[1,"title-section"],[1,"keynote-title"],[1,"badges"],[1,"order-badge"],["class","important-badge",4,"ngIf"],[1,"info-card"],[1,"info-grid"],[1,"info-item"],[1,"label"],[1,"value","lesson-link"],["class","info-item",4,"ngIf"],[1,"value"],[1,"info-card","content-card"],[1,"content-display",3,"ngClass"],["class","bullet-content",4,"ngIf"],["class","quote-content",4,"ngIf"],["class","text-content",4,"ngIf"],["class","info-card",4,"ngIf"],[1,"important-badge"],[1,"bullet-content"],[4,"ngFor","ngForOf"],[1,"quote-content"],[1,"text-content"],[1,"visual-aid-container"],[1,"visual-aid-image",3,"error","src","alt"],[1,"visual-aid-url"],["target","_blank",1,"url-link",3,"href"],[1,"astro-chips"],["class","planet-chip",4,"ngIf"],["class","zodiac-chip",4,"ngIf"],[1,"planet-chip"],[1,"zodiac-chip"],[1,"no-keynote"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"div",1)(2,"h1"),a(3,"Keynote Details"),n(),o(4,"div",2)(5,"button",3),y("click",function(){return r.goBack()}),o(6,"mat-icon"),a(7,"arrow_back"),n(),a(8," Back to Keynotes "),n(),m(9,gn,4,3,"button",4),n()(),m(10,un,2,0,"div",5)(11,In,54,19,"div",6)(12,Tn,9,0,"div",7),n()),t&2&&(l(9),s("ngIf",r.keynote),l(),s("ngIf",r.loading),l(),s("ngIf",!r.loading&&r.keynote),l(),s("ngIf",!r.loading&&!r.keynote))},dependencies:[w,Be,K,O,Ne,ae,V,A,D,B,F,R,N,j,q,_e,xe,he,z,$,H],styles:[".container[_ngcontent-%COMP%]{padding:20px;max-width:1000px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.actions[_ngcontent-%COMP%]{display:flex;gap:12px}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:60px}.keynote-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.info-card[_ngcontent-%COMP%]{width:100%}.header-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.header-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:24px}.keynote-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.keynote-title[_ngcontent-%COMP%]{font-size:28px;font-weight:600;margin:0 0 16px;color:#fff}.badges[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap}.order-badge[_ngcontent-%COMP%]{background-color:#fff3;color:#fff}.important-badge[_ngcontent-%COMP%]{background-color:#ff6b6b;color:#fff}.content-type-badge[_ngcontent-%COMP%]{color:#fff;font-weight:500}.content-type-text[_ngcontent-%COMP%]{background-color:#4caf50cc}.content-type-bullet_points[_ngcontent-%COMP%]{background-color:#ff9800cc}.content-type-quote[_ngcontent-%COMP%]{background-color:#9c27b0cc}.content-type-example[_ngcontent-%COMP%]{background-color:#2196f3cc}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;min-height:40px}.label[_ngcontent-%COMP%]{font-weight:600;color:#666;min-width:100px;margin-right:12px}.value[_ngcontent-%COMP%]{color:#333;word-break:break-word}.lesson-link[_ngcontent-%COMP%]{color:#1976d2;cursor:pointer;text-decoration:underline}.content-card[_ngcontent-%COMP%]{min-height:150px}.content-display[_ngcontent-%COMP%]{font-size:16px;line-height:1.6}.bullet-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:20px}.bullet-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:8px}.quote-content[_ngcontent-%COMP%]   blockquote[_ngcontent-%COMP%]{margin:0;padding:20px;background-color:#f5f5f5;border-left:4px solid #9c27b0;border-radius:4px;font-style:italic;position:relative}.quote-content[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;color:#9c27b0;opacity:.3;font-size:32px;width:32px;height:32px}.text-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#333}.visual-aid-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.visual-aid-image[_ngcontent-%COMP%]{max-width:100%;max-height:400px;border-radius:8px;box-shadow:0 4px 8px #0000001a}.visual-aid-url[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.url-link[_ngcontent-%COMP%]{color:#1976d2;text-decoration:none;display:flex;align-items:center;gap:4px}.url-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.url-link[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.astro-chips[_ngcontent-%COMP%]{display:flex;gap:12px;flex-wrap:wrap}.planet-chip[_ngcontent-%COMP%]{background-color:#fce4ec;color:#c2185b}.zodiac-chip[_ngcontent-%COMP%]{background-color:#e1f5fe;color:#0277bd}.planet-chip[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .zodiac-chip[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.no-keynote[_ngcontent-%COMP%]{text-align:center;padding:80px 20px;color:#666}.no-keynote[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:16px}.no-keynote[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:16px 0;color:#333}@media (max-width: 768px){.header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.actions[_ngcontent-%COMP%]{width:100%;justify-content:flex-start}.keynote-header[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.info-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.label[_ngcontent-%COMP%]{min-width:auto;margin-right:0;margin-bottom:4px}}"]})};var k=class{static extractErrorMessage(e,t="An error occurred. Please try again."){if(!e)return t;if(e.error&&e.error.fieldErrors){let r=e.error.fieldErrors;return Object.entries(r).map(([d,C])=>`${d}: ${C}`).join(", ")||e.error.message||t}if(e.error&&e.error.message)return e.error.message;if(e.error&&typeof e.error=="string")return e.error;if(e.error&&e.error.error)return e.error.error;if(e.message)return e.message;if(e.status)switch(e.status){case 400:return e.error?.message||"Invalid request. Please check your input data.";case 401:return"Authentication failed. Please log in again.";case 403:return"You do not have permission to perform this action.";case 404:return"The requested resource was not found.";case 409:return e.error?.message||"A conflict occurred. The resource may already exist.";case 422:return e.error?.message||"Validation failed. Please check your input data.";case 500:return e.error?.message||"Server error. Please try again later.";case 0:return"Unable to connect to the server. Please check your internet connection.";default:return e.error?.message||`Server error (${e.status}). Please try again later.`}return t}static formatValidationErrors(e){if(!e||typeof e!="object")return"Validation failed. Please check your input data.";let t=Object.entries(e).map(([r,c])=>`${r.replace(/([A-Z])/g," $1").replace(/^./,C=>C.toUpperCase()).trim()}: ${c}`);return t.length===1?t[0]:`Multiple validation errors: ${t.join("; ")}`}static isValidationError(e){return e?.error?.fieldErrors||e?.status===400||e?.status===422||e?.error?.message&&e.error.message.toLowerCase().includes("validation")}static isConflictError(e){return e?.status===409||e?.error?.message&&(e.error.message.toLowerCase().includes("duplicate")||e.error.message.toLowerCase().includes("already exists")||e.error.message.toLowerCase().includes("conflict"))}static getSnackbarClass(e){return this.isValidationError(e)?["warning-snackbar"]:this.isConflictError(e)?["warning-snackbar"]:["error-snackbar"]}};var be=class i{snackBar=Ae(E);showError(e,t="An error occurred. Please try again.",r=5e3){let c=k.extractErrorMessage(e,t),d=k.getSnackbarClass(e);this.snackBar.open(c,"Close",{duration:r,panelClass:d})}showSuccess(e,t=3e3){this.snackBar.open(e,"Close",{duration:t,panelClass:["success-snackbar"]})}showWarning(e,t=4e3){this.snackBar.open(e,"Close",{duration:t,panelClass:["warning-snackbar"]})}showInfo(e,t=3e3){this.snackBar.open(e,"Close",{duration:t,panelClass:["info-snackbar"]})}handleApiError(e,t="operation",r=5e3){let c=`Error ${t}. Please try again.`;k.isValidationError(e)?c=`Validation failed while ${t}. Please check your input data.`:k.isConflictError(e)?c=`A conflict occurred while ${t}. The resource may already exist.`:e?.status===404?c=`Resource not found while ${t}.`:e?.status===403?c=`You do not have permission to perform this ${t}.`:e?.status===401&&(c=`Authentication required to ${t}. Please log in again.`),this.showError(e,c,r)}handleFormError(e,t="form"){if(k.isValidationError(e)&&e?.error?.fieldErrors){let r=k.formatValidationErrors(e.error.fieldErrors);this.showWarning(r,6e3)}else this.handleApiError(e,`submitting ${t}`)}logError(e,t){console.error(`Error in ${t}:`,e),e?.error&&console.error("Error details:",e.error),e?.status&&console.error("HTTP Status:",e.status),e?.message&&console.error("Error message:",e.message)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=Le({token:i,factory:i.\u0275fac,providedIn:"root"})};function Kn(i,e){i&1&&(o(0,"div",6),h(1,"mat-spinner"),n())}function On(i,e){if(i&1&&(o(0,"mat-option",40)(1,"div",41)(2,"span",42),a(3),n(),o(4,"span",43),a(5),n()()()),i&2){let t=e.$implicit;s("value",t),l(3),u(t.title),l(2),u(t.topicTitle)}}function wn(i,e){i&1&&(o(0,"mat-error"),a(1," Lesson is required "),n())}function Ln(i,e){i&1&&(o(0,"mat-error"),a(1," Title is required "),n())}function An(i,e){i&1&&(o(0,"mat-error"),a(1," Content type is required "),n())}function Fn(i,e){i&1&&(o(0,"span"),a(1," Use bullet points format (\u2022 item 1, \u2022 item 2, etc.) "),n())}function Dn(i,e){i&1&&(o(0,"span"),a(1," Include quotation marks for quotes "),n())}function Bn(i,e){i&1&&(o(0,"mat-error"),a(1," Content is required "),n())}function Vn(i,e){i&1&&(o(0,"mat-form-field",10)(1,"mat-label"),a(2,"Visual Aid URL"),n(),h(3,"input",44),o(4,"mat-hint"),a(5,"URL to image, diagram, or other visual content"),n()())}function Nn(i,e){if(i&1&&(o(0,"mat-option",40),a(1),n()),i&2){let t=e.$implicit;s("value",t),l(),_(" ",t," ")}}function Rn(i,e){if(i&1&&(o(0,"mat-option",40),a(1),n()),i&2){let t=e.$implicit;s("value",t),l(),_(" ",t," ")}}function qn(i,e){if(i&1&&(o(0,"mat-option",40),a(1),n()),i&2){let t=e.$implicit;s("value",t.tagId),l(),_(" ",t.tagName," ")}}function jn(i,e){i&1&&(o(0,"mat-error"),a(1," Tag selection is required "),n())}function $n(i,e){if(i&1){let t=b();o(0,"div",45)(1,"mat-form-field",46)(2,"mat-label"),a(3,"Tag"),n(),o(4,"mat-select",47),m(5,qn,2,2,"mat-option",13),n(),m(6,jn,2,0,"mat-error",14),n(),o(7,"mat-form-field",46)(8,"mat-label"),a(9,"Relevance Score"),n(),h(10,"input",48),o(11,"mat-hint"),a(12,"Enter a score from 1-10 indicating relevance to the keynote"),n()(),o(13,"div",49)(14,"button",50),y("click",function(){let c=x(t).index,d=p(2);return v(d.saveTag(c))}),o(15,"mat-icon"),a(16,"save"),n()(),o(17,"button",51),y("click",function(){let c=x(t).index,d=p(2);return v(d.removeTag(c))}),o(18,"mat-icon"),a(19,"delete"),n(),a(20," Remove "),n()()()}if(i&2){let t,r=e.$implicit,c=e.index,d=p(2);s("formGroupName",c),l(5),s("ngForOf",d.allTags),l(),s("ngIf",(t=r.get("tagId"))==null?null:t.hasError("required"))}}function zn(i,e){i&1&&(o(0,"div",52)(1,"mat-icon"),a(2,"label_off"),n(),o(3,"p"),a(4,'No tags added yet. Click "Add Tag" to start tagging this keynote.'),n()())}function Hn(i,e){i&1&&h(0,"mat-spinner",53)}function Un(i,e){if(i&1){let t=b();o(0,"form",7),y("ngSubmit",function(){x(t);let c=p();return v(c.onSubmit())}),o(1,"div",8)(2,"h3"),a(3,"Basic Information"),n(),o(4,"div",9)(5,"mat-form-field",10)(6,"mat-label"),a(7,"Lesson"),n(),h(8,"input",11),o(9,"mat-autocomplete",12,0),m(11,On,6,3,"mat-option",13),Q(12,"async"),n(),m(13,wn,2,0,"mat-error",14),n(),o(14,"mat-form-field",10)(15,"mat-label"),a(16,"Order Sequence"),n(),h(17,"input",15),n()(),o(18,"mat-form-field",10)(19,"mat-label"),a(20,"Title"),n(),h(21,"input",16),m(22,Ln,2,0,"mat-error",14),n(),o(23,"div",9)(24,"mat-form-field",10)(25,"mat-label"),a(26,"Content Type"),n(),o(27,"mat-select",17)(28,"mat-option",18),a(29,"Text"),n(),o(30,"mat-option",19),a(31,"Bullet Points"),n(),o(32,"mat-option",20),a(33,"Quote"),n(),o(34,"mat-option",21),a(35,"Example"),n()(),m(36,An,2,0,"mat-error",14),n(),o(37,"div",22)(38,"mat-checkbox",23)(39,"mat-icon"),a(40,"star"),n(),a(41," Mark as Important "),n()()()(),o(42,"div",8)(43,"h3"),a(44,"Content"),n(),o(45,"mat-form-field",10)(46,"mat-label"),a(47,"Content"),n(),o(48,"textarea",24),a(49,"                "),n(),o(50,"mat-hint"),m(51,Fn,2,0,"span",14)(52,Dn,2,0,"span",14),n(),m(53,Bn,2,0,"mat-error",14),n()(),o(54,"div",8)(55,"h3"),a(56,"Visual Aid"),n(),o(57,"div",22)(58,"mat-checkbox",25),y("change",function(c){x(t);let d=p();return v(d.onVisualAidChange(c))}),o(59,"mat-icon"),a(60,"image"),n(),a(61," Has Visual Aid "),n()(),m(62,Vn,6,0,"mat-form-field",26),n(),o(63,"div",8)(64,"h3"),a(65,"Astrological Relations"),n(),o(66,"div",9)(67,"mat-form-field",10)(68,"mat-label"),a(69,"Related Planet"),n(),o(70,"mat-select",27)(71,"mat-option",28),a(72,"None"),n(),m(73,Nn,2,2,"mat-option",13),n()(),o(74,"mat-form-field",10)(75,"mat-label"),a(76,"Related Zodiac Sign"),n(),o(77,"mat-select",29)(78,"mat-option",28),a(79,"None"),n(),m(80,Rn,2,2,"mat-option",13),n()()()(),h(81,"mat-divider"),o(82,"div",8)(83,"div",30)(84,"h3",31)(85,"mat-icon"),a(86,"label"),n(),a(87," Keynote Tags "),n(),o(88,"button",32),y("click",function(){x(t);let c=p();return v(c.addTag())}),o(89,"mat-icon"),a(90,"add"),n(),a(91," Add Tag "),n()(),o(92,"div",33),m(93,$n,21,3,"div",34)(94,zn,5,0,"div",35),n()(),o(95,"div",36)(96,"button",37),y("click",function(){x(t);let c=p();return v(c.goBack())}),a(97,"Cancel"),n(),o(98,"button",38),m(99,Hn,1,0,"mat-spinner",39),a(100),n()()()}if(i&2){let t,r,c,d,C,W,Ee,Ke=Fe(10),g=p();s("formGroup",g.keynoteForm),l(8),s("matAutocomplete",Ke),l(),s("displayWith",g.displayLessonFn),l(2),s("ngForOf",De(12,18,g.filteredLessons)),l(2),s("ngIf",(t=g.keynoteForm.get("lessonSearch"))==null?null:t.hasError("required")),l(9),s("ngIf",(r=g.keynoteForm.get("title"))==null?null:r.hasError("required")),l(14),s("ngIf",(c=g.keynoteForm.get("contentType"))==null?null:c.hasError("required")),l(15),s("ngIf",((d=g.keynoteForm.get("contentType"))==null?null:d.value)==="bullet_points"),l(),s("ngIf",((C=g.keynoteForm.get("contentType"))==null?null:C.value)==="quote"),l(),s("ngIf",(W=g.keynoteForm.get("content"))==null?null:W.hasError("required")),l(9),s("ngIf",(Ee=g.keynoteForm.get("hasVisualAid"))==null?null:Ee.value),l(11),s("ngForOf",g.planets),l(7),s("ngForOf",g.zodiacSigns),l(13),s("ngForOf",g.keynoteTags.controls),l(),s("ngIf",g.keynoteTags.length===0),l(4),s("disabled",g.keynoteForm.invalid||g.submitting),l(),s("ngIf",g.submitting),l(),_(" ",g.submitting?"Saving...":g.isEditMode?"Update Keynote":"Create Keynote"," ")}}var Z=class i{constructor(e,t,r,c,d,C,W,Ee,Ke){this.fb=e;this.keynoteService=t;this.lessonService=r;this.keynoteTagService=c;this.tagService=d;this.errorHandler=C;this.router=W;this.route=Ee;this.snackBar=Ke;this.keynoteForm=this.createForm(),this.filteredLessons=this.keynoteForm.get("lessonSearch").valueChanges.pipe(we(""),Oe(g=>this.filterLessons(g)))}keynoteForm;isEditMode=!1;keynoteId=null;loading=!1;submitting=!1;lessons=[];filteredLessons;allTags=[];planets=["Sun","Moon","Mars","Mercury","Jupiter","Venus","Saturn","Rahu","Ketu"];zodiacSigns=["Aries","Taurus","Gemini","Cancer","Leo","Virgo","Libra","Scorpio","Sagittarius","Capricorn","Aquarius","Pisces"];ngOnInit(){this.loadLessons(),this.loadAllTags(),this.route.params.subscribe(e=>{e.id&&(this.isEditMode=!0,this.keynoteId=+e.id,this.loadKeynote())})}get keynoteTags(){return this.keynoteForm.get("keynoteTags")}createForm(){return this.fb.group({lessonSearch:["",[I.required]],lessonId:[""],title:["",[I.required]],content:["",[I.required]],contentType:["text",[I.required]],orderSequence:[""],isImportant:[!1],hasVisualAid:[!1],visualAidUrl:[""],relatedPlanet:[""],relatedZodiac:[""],keynoteTags:this.fb.array([])})}loadLessons(){this.lessonService.getAllLessons().subscribe({next:e=>{this.lessons=e},error:e=>{console.error("Error loading lessons:",e),this.errorHandler.handleApiError(e,"loading lessons")}})}loadKeynote(){this.keynoteId&&(this.loading=!0,this.keynoteService.getKeynoteById(this.keynoteId).subscribe({next:e=>{let t=this.lessons.find(r=>r.lessonId===e.lessonId);this.keynoteForm.patchValue(J(Y({},e),{lessonSearch:t})),this.loadKeynoteTags(),this.loading=!1},error:e=>{console.error("Error loading keynote:",e),this.errorHandler.handleApiError(e,"loading keynote details"),this.loading=!1}}))}filterLessons(e){if(!e||typeof e=="object")return this.lessons;let t=e.toLowerCase();return this.lessons.filter(r=>r.title.toLowerCase().includes(t)||r.topicTitle?.toLowerCase().includes(t))}displayLessonFn=e=>e?e.title:"";onVisualAidChange(e){e.checked||this.keynoteForm.patchValue({visualAidUrl:""})}onSubmit(){if(this.keynoteForm.invalid)return;this.submitting=!0;let e=this.keynoteForm.value,t=e.lessonSearch;if(!t||!t.lessonId){this.snackBar.open("Please select a valid lesson","Close",{duration:3e3}),this.submitting=!1;return}let r={lessonId:t.lessonId,title:e.title,content:e.content,contentType:e.contentType,orderSequence:e.orderSequence||void 0,isImportant:e.isImportant,hasVisualAid:e.hasVisualAid,visualAidUrl:e.hasVisualAid?e.visualAidUrl:null,relatedPlanet:e.relatedPlanet||null,relatedZodiac:e.relatedZodiac||null};(this.isEditMode?this.keynoteService.updateKeynote(this.keynoteId,r):this.keynoteService.createKeynote(r)).subscribe({next:d=>G(this,null,function*(){try{!this.isEditMode&&d.keynoteId&&(this.keynoteId=d.keynoteId),yield this.handleKeynoteTags();let C=this.isEditMode?`Keynote updated successfully with ${this.keynoteTags.length} tag(s)!`:`Keynote created successfully with ${this.keynoteTags.length} tag(s)!`;this.errorHandler.showSuccess(C),this.router.navigate(["/keynotes"])}catch(C){console.error("Error handling keynote tags:",C);let W=this.isEditMode?"Keynote updated but some tags failed to save":"Keynote created but some tags failed to save";this.errorHandler.showWarning(W),this.router.navigate(["/keynotes"])}}),error:d=>{console.error("Error saving keynote:",d),this.errorHandler.handleApiError(d,"saving keynote"),this.submitting=!1}})}handleKeynoteTags(){return G(this,null,function*(){if(!this.keynoteId)throw new Error("Keynote ID is required to handle tags");let e=this.keynoteTags.value||[];for(let t=0;t<e.length;t++){let r=e[t];if(!r.tagId||!r.relevanceScore)continue;let c={keynoteId:this.keynoteId,tagId:Number(r.tagId),relevanceScore:Number(r.relevanceScore)};try{if(r.keynoteTagId)yield this.keynoteTagService.updateKeynoteTag(r.keynoteTagId,J(Y({},c),{keynoteTagId:r.keynoteTagId})).toPromise();else{let d=yield this.keynoteTagService.createKeynoteTag(c).toPromise();d&&d.keynoteTagId&&this.keynoteTags.at(t).patchValue({keynoteTagId:d.keynoteTagId})}}catch(d){throw console.error(`Error handling keynote tag at index ${t}:`,d),d}}})}loadAllTags(){this.tagService.getTags().subscribe({next:e=>{this.allTags=e},error:e=>{this.errorHandler.handleApiError(e,"loading tags")}})}loadKeynoteTags(){this.keynoteId&&this.keynoteTagService.getTagsByKeynoteId(this.keynoteId).subscribe({next:e=>{for(;this.keynoteTags.length!==0;)this.keynoteTags.removeAt(0);e.forEach(t=>{let r=this.fb.group({keynoteTagId:[t.keynoteTagId],tagId:[t.tagId,I.required],relevanceScore:[t.relevanceScore||5]});this.keynoteTags.push(r)})},error:e=>{this.errorHandler.handleApiError(e,"loading keynote tags")}})}addTag(){let e=this.fb.group({keynoteTagId:[null],tagId:[null,I.required],relevanceScore:[5]});this.keynoteTags.push(e)}saveTag(e){return G(this,null,function*(){let t=this.keynoteTags.at(e);if(!t.valid){this.snackBar.open("Please select a tag and enter a valid relevance score.","Close",{duration:3e3});return}if(!this.keynoteId){this.snackBar.open("Keynote must be saved before adding tags.","Close",{duration:3e3});return}let r=t.value,c={keynoteId:this.keynoteId,tagId:Number(r.tagId),relevanceScore:Number(r.relevanceScore)};try{if(r.keynoteTagId)yield this.keynoteTagService.updateKeynoteTag(r.keynoteTagId,J(Y({},c),{keynoteTagId:r.keynoteTagId})).toPromise(),this.errorHandler.showSuccess("Tag updated successfully.");else{let d=yield this.keynoteTagService.createKeynoteTag(c).toPromise();d&&d.keynoteTagId&&t.patchValue({keynoteTagId:d.keynoteTagId}),this.errorHandler.showSuccess("Tag added successfully.")}this.loadKeynoteTags()}catch(d){this.errorHandler.handleApiError(d,"saving tag")}})}removeTag(e){return G(this,null,function*(){let r=this.keynoteTags.at(e).value;if(r.keynoteTagId)try{yield this.keynoteTagService.deleteKeynoteTag(r.keynoteTagId).toPromise(),this.errorHandler.showSuccess("Tag deleted successfully."),this.loadKeynoteTags()}catch(c){this.errorHandler.handleApiError(c,"deleting tag")}else this.keynoteTags.removeAt(e)})}goBack(){this.router.navigate(["/keynotes"])}static \u0275fac=function(t){return new(t||i)(f(Ye),f(U),f(ke),f(vt),f(Ct),f(be),f(L),f(oe),f(E))};static \u0275cmp=T({type:i,selectors:[["app-add-keynote"]],standalone:!0,features:[P],decls:15,vars:4,consts:[["lessonAuto","matAutocomplete"],[1,"container"],[1,"header"],["mat-button","",3,"click"],["class","loading-container",4,"ngIf"],["class","keynote-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading-container"],[1,"keynote-form",3,"ngSubmit","formGroup"],[1,"section"],[1,"form-row"],["appearance","outline"],["matInput","","formControlName","lessonSearch","placeholder","Search and select lesson",3,"matAutocomplete"],[3,"displayWith"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","type","number","formControlName","orderSequence","placeholder","Auto-assigned if empty"],["matInput","","formControlName","title","placeholder","Enter keynote title"],["formControlName","contentType"],["value","text"],["value","bullet_points"],["value","quote"],["value","example"],[1,"checkbox-group"],["formControlName","isImportant"],["matInput","","formControlName","content","rows","6","placeholder","Enter keynote content"],["formControlName","hasVisualAid",3,"change"],["appearance","outline",4,"ngIf"],["formControlName","relatedPlanet"],["value",""],["formControlName","relatedZodiac"],[1,"section-header"],[1,"section-title"],["mat-raised-button","","color","accent","type","button",1,"add-tag-btn",3,"click"],["formArrayName","keynoteTags",1,"tags-container"],["class","tag-item",3,"formGroupName",4,"ngFor","ngForOf"],["class","no-tags",4,"ngIf"],[1,"form-actions"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",4,"ngIf"],[3,"value"],[1,"lesson-option"],[1,"lesson-title"],[1,"topic-title"],["matInput","","formControlName","visualAidUrl","placeholder","Enter image/media URL"],[1,"tag-item",3,"formGroupName"],["appearance","outline",1,"full-width"],["formControlName","tagId","required",""],["matInput","","formControlName","relevanceScore","type","number","min","1","max","10"],[1,"tag-actions"],["mat-icon-button","","color","primary","type","button","matTooltip","Save this tag",1,"save-tag-btn",3,"click"],["mat-button","","color","warn","type","button","matTooltip","Remove this tag",3,"click"],[1,"no-tags"],["diameter","20"]],template:function(t,r){t&1&&(o(0,"div",1)(1,"div",2)(2,"h1"),a(3),n(),o(4,"button",3),y("click",function(){return r.goBack()}),o(5,"mat-icon"),a(6,"arrow_back"),n(),a(7," Back to Keynotes "),n()(),o(8,"mat-card")(9,"mat-card-header")(10,"mat-card-title"),a(11),n()(),o(12,"mat-card-content"),m(13,Kn,2,0,"div",4)(14,Un,101,20,"form",5),n()()()),t&2&&(l(3),u(r.isEditMode?"Edit Keynote":"Add New Keynote"),l(8),u(r.isEditMode?"Edit Keynote Details":"Keynote Information"),l(2),s("ngIf",r.loading),l(),s("ngIf",!r.loading))},dependencies:[w,K,O,Ve,Xe,je,re,$e,le,Re,Ze,Qe,Ge,ze,We,He,Ue,V,A,D,B,F,me,de,ce,tt,et,ge,pe,R,N,ue,ye,fe,se,yt,ft,j,q,H,z,$,xt,_t,ht,_e,it,Ce,ve],styles:[".container[_ngcontent-%COMP%]{padding:20px;max-width:900px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px}.keynote-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.section[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;padding:20px;background-color:#fafafa}.section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;color:#333;font-size:16px;font-weight:500}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:start}.form-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]{width:100%}.checkbox-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:8px}.checkbox-group[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.lesson-option[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;padding:8px 0}.lesson-title[_ngcontent-%COMP%]{font-weight:500;color:#333}.topic-title[_ngcontent-%COMP%]{font-size:12px;color:#666}.form-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end;padding-top:20px;border-top:1px solid #e0e0e0}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:120px}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin:0;color:#333;font-size:16px;font-weight:500}.add-tag-btn[_ngcontent-%COMP%]{min-width:auto}.tags-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.tag-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr auto;gap:12px;align-items:start;padding:16px;border:1px solid #e0e0e0;border-radius:8px;background-color:#fff}.tag-actions[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.save-tag-btn[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.no-tags[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#666;border:2px dashed #e0e0e0;border-radius:8px;background-color:#f9f9f9}.no-tags[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;color:#ccc;margin-bottom:8px}.no-tags[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}@media (max-width: 768px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}.header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.form-actions[_ngcontent-%COMP%]{flex-direction:column}}"]})};var oo=[{path:"",component:Me},{path:"add",component:Z},{path:"edit/:id",component:Z},{path:":id",component:Se}];export{oo as KEYNOTES_ROUTES};

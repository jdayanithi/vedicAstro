import{a as me}from"./chunk-KKIKTYDG.js";import{a as se,b as ce,c as le}from"./chunk-2CMLN76B.js";import{a as pe}from"./chunk-O2DZIKZR.js";import{a as U,b as J,c as K,e as Q,g as X}from"./chunk-ZNL3IKF2.js";import{a as _e,c as z}from"./chunk-FQ67QF65.js";import{a as Ue}from"./chunk-CTIDPCH7.js";import{a as We,b as qe}from"./chunk-RNMBNA6J.js";import{a as Be,b as Le,c as Ne,d as ke,e as Pe,f as Re,g as $e,h as ze,i as He,j as je,k as Ge}from"./chunk-LZWXBBKL.js";import{b as te,c as ie,d as ne,e as ae}from"./chunk-PNTWHU5I.js";import{l as Ve,m as Oe}from"./chunk-BYQJPZHC.js";import"./chunk-EFSOZXE7.js";import{a as Y,c as we,h as Z,i as ee}from"./chunk-TGCRKVSN.js";import{$ as v,$c as ve,Ab as B,Bb as a,C as A,Cb as I,Db as g,Ea as s,Fa as x,H as F,Jb as L,Kb as fe,Mb as M,Nb as N,O as D,Ob as ge,P as V,Sc as H,Ua as p,Uc as ue,Wc as j,Xc as ye,Za as l,Zc as G,ad as Se,bd as Te,ca as O,cd as Ie,fd as xe,gb as n,gc as k,hb as r,hc as P,hd as be,he as q,ib as f,id as Me,jb as S,jc as R,jd as Ee,k as _,ka as d,kb as T,la as u,lc as he,ld as W,mb as b,ne as oe,pb as C,pc as $,pe as Ae,qe as re,rb as h,re as Fe,se as De}from"./chunk-7VMAUSLR.js";import{a as w,b as Ce}from"./chunk-GAL4ENT6.js";var rt=()=>[5,10,20];function nt(o,e){if(o&1&&(n(0,"mat-option",16),a(1),r()),o&2){let t=e.$implicit;l("value",t.categoryId),s(),g(" ",t.name," ")}}function at(o,e){if(o&1&&(n(0,"mat-option",16),a(1),r()),o&2){let t=e.$implicit;l("value",t.courseId),s(),g(" ",t.title," ")}}function st(o,e){if(o&1&&(n(0,"mat-option",16),a(1),r()),o&2){let t=e.$implicit,i=h();l("value",t),s(),g(" ",i.displayCourseFn(t)," ")}}function ct(o,e){if(o&1&&(n(0,"span",31),a(1),r()),o&2){let t=h(2);s(),g(" (",t.selectedCategory.name,") ")}}function lt(o,e){o&1&&(n(0,"th",32),a(1,"ID"),r())}function pt(o,e){if(o&1&&(n(0,"td",33),a(1),r()),o&2){let t=e.$implicit;s(),I(t.topicId)}}function mt(o,e){o&1&&(n(0,"th",32),a(1,"Order"),r())}function dt(o,e){if(o&1&&(n(0,"td",33),a(1),r()),o&2){let t=e.$implicit;s(),I(t.orderNumber)}}function ut(o,e){o&1&&(n(0,"th",32),a(1,"Title"),r())}function Ct(o,e){if(o&1&&(n(0,"td",33),a(1),r()),o&2){let t=e.$implicit;s(),I(t.title)}}function ft(o,e){o&1&&(n(0,"th",32),a(1,"Description"),r())}function gt(o,e){if(o&1&&(n(0,"td",33),a(1),r()),o&2){let t=e.$implicit;s(),g(" ",t.description?t.description.length>100?t.description.substring(0,100)+"...":t.description:"-"," ")}}function ht(o,e){o&1&&(n(0,"th",32),a(1,"Created"),r())}function _t(o,e){if(o&1&&(n(0,"td",33),a(1),M(2,"date"),r()),o&2){let t=e.$implicit;s(),I(ge(2,1,t.createdAt,"short"))}}function yt(o,e){o&1&&(n(0,"th",32),a(1,"Actions"),r())}function vt(o,e){if(o&1){let t=b();n(0,"td",33)(1,"button",34),C("click",function(){let c=d(t).$implicit,m=h(2);return u(m.navigateToEditTopic(c.topicId))}),n(2,"mat-icon"),a(3,"edit"),r()(),n(4,"button",35),C("click",function(){let c=d(t).$implicit,m=h(2);return u(m.deleteTopic(c.topicId))}),n(5,"mat-icon"),a(6,"delete"),r()()()}}function St(o,e){o&1&&f(0,"tr",36)}function Tt(o,e){o&1&&f(0,"tr",37)}function It(o,e){o&1&&(n(0,"div",38)(1,"p"),a(2,"No topics found for this course."),r()())}function xt(o,e){if(o&1){let t=b();n(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),a(3),p(4,ct,2,1,"span",17),r()(),n(5,"mat-card-content")(6,"table",18),S(7,19),p(8,lt,2,0,"th",20)(9,pt,2,1,"td",21),T(),S(10,22),p(11,mt,2,0,"th",20)(12,dt,2,1,"td",21),T(),S(13,23),p(14,ut,2,0,"th",20)(15,Ct,2,1,"td",21),T(),S(16,24),p(17,ft,2,0,"th",20)(18,gt,2,1,"td",21),T(),S(19,25),p(20,ht,2,0,"th",20)(21,_t,3,4,"td",21),T(),S(22,26),p(23,yt,2,0,"th",20)(24,vt,7,0,"td",21),T(),p(25,St,1,0,"tr",27)(26,Tt,1,0,"tr",28),r(),n(27,"mat-paginator",29),C("page",function(c){d(t);let m=h();return u(m.onPageChange(c))}),r(),p(28,It,3,0,"div",30),r()()}if(o&2){let t=h();s(3),g(" Topics for: ",t.selectedCourse.title," "),s(),l("ngIf",t.selectedCategory),s(2),l("dataSource",t.pagedTopics),s(19),l("matHeaderRowDef",t.displayedColumns),s(),l("matRowDefColumns",t.displayedColumns),s(),l("length",t.topics.length)("pageSize",t.pageSize)("pageIndex",t.pageIndex)("pageSizeOptions",fe(10,rt)),s(),l("ngIf",t.topics.length===0)}}function bt(o,e){o&1&&(n(0,"mat-card",39)(1,"mat-card-content")(2,"div",38)(3,"mat-icon"),a(4,"school"),r(),n(5,"p"),a(6,"Please select a course to view its topics."),r()()()())}var de=class o{constructor(e,t,i,c,m){this.topicService=e;this.courseService=t;this.categoryService=i;this.snackBar=c;this.router=m}topics=[];selectedCourse=null;selectedCategory=null;categories=[];filteredCoursesList=[];allCourses=[];categoryControl=new G("");courseControl=new G("");courseSearchControl=new G("");filteredCourses=_([]);displayedColumns=["topicId","orderNumber","title","description","createdAt","actions"];pageIndex=0;pageSize=10;get pagedTopics(){let e=this.pageIndex*this.pageSize;return this.topics.slice(e,e+this.pageSize)}ngOnInit(){Promise.all([this.loadCategoriesAsync(),this.loadAllCoursesAsync()]).then(()=>{this.setupCourseAutocomplete(),this.restoreSelectedCourse()})}loadCategories(){this.categoryService.getCategories().subscribe({next:e=>{this.categories=e},error:()=>{this.snackBar.open("Error loading categories","Close",{duration:3e3})}})}loadCategoriesAsync(){return new Promise((e,t)=>{this.categoryService.getCategories().subscribe({next:i=>{this.categories=i,e()},error:i=>{this.snackBar.open("Error loading categories","Close",{duration:3e3}),t(i)}})})}loadAllCourses(){this.courseService.getAllCourses().subscribe({next:e=>{this.allCourses=e},error:()=>{this.snackBar.open("Error loading courses","Close",{duration:3e3})}})}loadAllCoursesAsync(){return new Promise((e,t)=>{this.courseService.getAllCourses().subscribe({next:i=>{this.allCourses=i,e()},error:i=>{this.snackBar.open("Error loading courses","Close",{duration:3e3}),t(i)}})})}setupCourseAutocomplete(){this.filteredCourses=this.courseSearchControl.valueChanges.pipe(D(""),A(300),F(),V(e=>this._filterCourses(e||"")))}_filterCourses(e){let t=typeof e=="string"?e:e?.title||"";if(!t||t.trim()==="")return this.categoryControl.value?_(this.allCourses.filter(c=>c.categoryId===this.categoryControl.value)):_(this.allCourses);let i=this.allCourses.filter(c=>c.title.toLowerCase().includes(t.toLowerCase()));return this.categoryControl.value&&(i=i.filter(c=>c.categoryId===this.categoryControl.value)),_(i)}displayCourseFn=e=>{if(!e)return"";let t=e.title||"Untitled",i=e.courseId||"N/A",c="";return e.categoryId&&this.selectedCategory&&(c=` - ${this.selectedCategory.name}`),`${t} (ID: ${i})${c}`};onCategorySelected(e){let t=e.value;this.selectedCategory=t&&this.categories.find(i=>i.categoryId===t)||null,this.courseControl.setValue(""),this.courseSearchControl.setValue(""),this.selectedCourse=null,this.topics=[],t?this.loadCoursesByCategory(t):this.filteredCoursesList=[]}onCourseSelected(e){let t=e.value;this.selectedCourse=t&&this.filteredCoursesList.find(i=>i.courseId===t)||null,this.courseSearchControl.setValue(""),this.topics=[],this.selectedCourse&&this.loadTopics()}onCourseSearchSelected(e){let t=e.option.value;if(this.selectedCourse=t,!this.selectedCategory&&t.categoryId){let i=this.categories.find(c=>c.categoryId===t.categoryId);i&&i.categoryId&&(this.selectedCategory=i,this.categoryControl.setValue(i.categoryId),this.loadCoursesByCategory(i.categoryId),setTimeout(()=>{this.courseControl.setValue(t.courseId)},100))}this.loadTopics()}loadCoursesByCategory(e){this.filteredCoursesList=this.allCourses.filter(t=>t.categoryId===e)}restoreSelectedCourse(){let e=history.state;if(e&&e.selectedCourse){let t=e.selectedCourse;if(this.selectedCourse=t,this.courseSearchControl.setValue(t),e.selectedCategory)this.selectedCategory=e.selectedCategory,this.selectedCategory&&this.selectedCategory.categoryId&&(this.categoryControl.setValue(this.selectedCategory.categoryId),this.loadCoursesByCategory(this.selectedCategory.categoryId),this.courseControl.setValue(this.selectedCourse.courseId));else if(t.categoryId){let i=this.categories.find(c=>c.categoryId===t.categoryId);i&&i.categoryId&&(this.selectedCategory=i,this.categoryControl.setValue(i.categoryId),this.loadCoursesByCategory(i.categoryId),this.courseControl.setValue(t.courseId))}this.loadTopics()}}onPageChange(e){this.pageIndex=e.pageIndex,this.pageSize=e.pageSize}loadTopics(){this.selectedCourse&&this.topicService.getTopicsByCourseId(this.selectedCourse.courseId).subscribe({next:e=>{this.topics=e.map(t=>Ce(w({},t),{createdAt:this.parseCustomDate(t.createdAt)})),this.pageIndex=0},error:()=>{this.snackBar.open("Error loading topics","Close",{duration:3e3})}})}parseCustomDate(e){if(!e)return new Date(0);if(typeof e=="string"){let t=e.split(",").map(Number);if(t.length===6)return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5]);let i=new Date(e);return isNaN(i.getTime())?new Date(0):i}return e instanceof Date?e:new Date(0)}deleteTopic(e){confirm("Are you sure you want to delete this topic?")&&this.topicService.deleteTopic(e).subscribe({next:()=>{this.loadTopics(),this.snackBar.open("Topic deleted successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error deleting topic","Close",{duration:3e3})}})}navigateToAddTopic(){this.selectedCourse&&this.router.navigate(["topics/add"],{state:{selectedCourse:this.selectedCourse,selectedCategory:this.selectedCategory}})}navigateToEditTopic(e){this.router.navigate(["topics/update",e],{state:{selectedCourse:this.selectedCourse,selectedCategory:this.selectedCategory}})}static \u0275fac=function(t){return new(t||o)(x(me),x(pe),x(Ue),x(ne),x(z))};static \u0275cmp=O({type:o,selectors:[["app-topic-list"]],standalone:!0,features:[L],decls:35,vars:14,consts:[["auto","matAutocomplete"],[1,"container"],[1,"header"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"filter-card"],[1,"filter-row"],[1,"filter-field"],[3,"selectionChange","formControl"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"selectionChange","formControl","disabled"],[1,"full-width"],["type","text","matInput","","placeholder","Type to search courses...",3,"formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[4,"ngIf"],["class","placeholder-card",4,"ngIf"],[3,"value"],["class","course-context",4,"ngIf"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","topicId"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","orderNumber"],["matColumnDef","title"],["matColumnDef","description"],["matColumnDef","createdAt"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize","pageIndex","pageSizeOptions"],["class","no-data",4,"ngIf"],[1,"course-context"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","primary",3,"click"],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[1,"no-data"],[1,"placeholder-card"]],template:function(t,i){if(t&1){let c=b();n(0,"div",1)(1,"div",2)(2,"h1"),a(3,"Topics"),r(),n(4,"button",3),C("click",function(){return d(c),u(i.navigateToAddTopic())}),n(5,"mat-icon"),a(6,"add"),r(),a(7," Add Topic "),r()(),n(8,"mat-card",4)(9,"mat-card-content")(10,"div",5)(11,"mat-form-field",6)(12,"mat-label"),a(13,"Filter by Category"),r(),n(14,"mat-select",7),C("selectionChange",function(y){return d(c),u(i.onCategorySelected(y))}),n(15,"mat-option",8),a(16,"All Categories"),r(),p(17,nt,2,2,"mat-option",9),r()(),n(18,"mat-form-field",6)(19,"mat-label"),a(20,"Filter by Course"),r(),n(21,"mat-select",10),C("selectionChange",function(y){return d(c),u(i.onCourseSelected(y))}),n(22,"mat-option",8),a(23,"All Courses"),r(),p(24,at,2,2,"mat-option",9),r()()(),n(25,"mat-form-field",11)(26,"mat-label"),a(27,"Search Course"),r(),f(28,"input",12),n(29,"mat-autocomplete",13,0),C("optionSelected",function(y){return d(c),u(i.onCourseSearchSelected(y))}),p(31,st,2,2,"mat-option",9),M(32,"async"),r()()()(),p(33,xt,29,11,"mat-card",14)(34,bt,7,0,"mat-card",15),r()}if(t&2){let c=B(30);s(4),l("disabled",!i.selectedCourse),s(10),l("formControl",i.categoryControl),s(3),l("ngForOf",i.categories),s(4),l("formControl",i.courseControl)("disabled",!i.categoryControl.value),s(3),l("ngForOf",i.filteredCoursesList),s(4),l("formControl",i.courseSearchControl)("matAutocomplete",c),s(),l("displayWith",i.displayCourseFn),s(2),l("ngForOf",N(32,12,i.filteredCourses)),s(2),l("ngIf",i.selectedCourse),s(),l("ngIf",!i.selectedCourse)}},dependencies:[$,k,P,R,he,Ge,Be,Ne,$e,ke,Le,ze,Pe,Re,He,je,re,oe,Ae,De,Fe,X,U,K,Q,J,ee,Z,Y,Oe,Ve,q,le,se,ce,ie,te,ae,W,H,j,Te,qe,We],styles:[".container[_ngcontent-%COMP%]{padding:20px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.full-width[_ngcontent-%COMP%]{width:100%}.filter-card[_ngcontent-%COMP%]{margin-bottom:20px}.filter-row[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:16px}.filter-field[_ngcontent-%COMP%]{flex:1}.course-context[_ngcontent-%COMP%]{font-size:14px;color:#666;font-weight:400}.no-data[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:16px}.placeholder-card[_ngcontent-%COMP%]{margin-top:20px}"]})};function Mt(o,e){if(o&1&&(n(0,"mat-option",14),a(1),r()),o&2){let t=e.$implicit,i=h();l("value",t),s(),g(" ",i.displayCourseFn(t)," ")}}function Et(o,e){o&1&&(n(0,"mat-form-field",3)(1,"mat-label"),a(2,"Order Number"),r(),f(3,"input",15),r())}var E=class o{topicForm;filteredCourses=_([]);isEditMode=!1;topicId=null;fb=v(Ee);topicService=v(me);courseService=v(pe);router=v(z);route=v(_e);snackBar=v(ne);constructor(){this.topicForm=this.fb.group({title:["",ue.required],description:[""],courseId:["",ue.required],courseSearch:[""],orderNumber:[1]})}ngOnInit(){this.setupCourseAutocomplete(),this.checkEditMode(),this.handleNavigationState()}handleNavigationState(){let t=this.router.getCurrentNavigation()?.extras?.state||history.state;if(t&&t.selectedCourse&&!this.isEditMode){let i=t.selectedCourse;this.topicForm.patchValue({courseId:i.courseId,courseSearch:i})}}setupCourseAutocomplete(){this.filteredCourses=this.topicForm.get("courseSearch").valueChanges.pipe(D(""),A(300),F(),V(e=>this._filterCourses(e)))}_filterCourses(e){return typeof e!="string"?_([]):!e||e.trim()===""?this.courseService.getAllCourses():this.courseService.getAllCourses()}displayCourseFn=e=>e?`${e.title} (ID: ${e.courseId})`:"";onCourseSelected(e){let t=e.option.value;this.topicForm.patchValue({courseId:t.courseId})}checkEditMode(){let e=this.route.snapshot.paramMap.get("id");e&&(this.isEditMode=!0,this.topicId=+e,this.loadTopic())}loadTopic(){this.topicId&&this.topicService.getTopicById(this.topicId).subscribe({next:e=>{this.topicForm.patchValue({title:e.title,description:e.description,courseId:e.courseId,orderNumber:e.orderNumber}),this.courseService.getCourseById(e.courseId).subscribe({next:t=>{this.topicForm.patchValue({courseSearch:t})}})},error:()=>{this.snackBar.open("Error loading topic","Close",{duration:3e3})}})}onSubmit(){if(this.topicForm.valid){let e=this.topicForm.value,t=w({title:e.title,description:e.description,courseId:e.courseId},this.isEditMode&&{orderNumber:e.orderNumber});this.isEditMode&&this.topicId?this.topicService.updateTopic(this.topicId,t).subscribe({next:()=>{this.snackBar.open("Topic updated successfully","Close",{duration:3e3}),this.goBack()},error:()=>{this.snackBar.open("Error updating topic","Close",{duration:3e3})}}):this.topicService.createTopic(t).subscribe({next:()=>{this.snackBar.open("Topic created successfully","Close",{duration:3e3}),this.goBack()},error:()=>{this.snackBar.open("Error creating topic","Close",{duration:3e3})}})}}goBack(){let t=this.router.getCurrentNavigation()?.extras?.state||history.state,c=this.topicForm.get("courseSearch")?.value||t?.selectedCourse,m=t?.selectedCategory;this.router.navigate(["/topics"],{state:{selectedCourse:c,selectedCategory:m}})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=O({type:o,selectors:[["app-add-topic"]],standalone:!0,features:[L],decls:35,vars:10,consts:[["auto","matAutocomplete"],[1,"container"],[3,"ngSubmit","formGroup"],["appearance","fill",1,"full-width"],["type","text","matInput","","formControlName","courseSearch","placeholder","Type to search courses...",3,"matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","courseId","required","","readonly",""],["matInput","","formControlName","title","required",""],["matInput","","formControlName","description","rows","4"],["appearance","fill","class","full-width",4,"ngIf"],[1,"button-container"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"],["matInput","","type","number","formControlName","orderNumber","min","1"]],template:function(t,i){if(t&1){let c=b();n(0,"div",1)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),a(4),r()(),n(5,"mat-card-content")(6,"form",2),C("ngSubmit",function(){return d(c),u(i.onSubmit())}),n(7,"mat-form-field",3)(8,"mat-label"),a(9,"Search Course"),r(),f(10,"input",4),n(11,"mat-autocomplete",5,0),C("optionSelected",function(y){return d(c),u(i.onCourseSelected(y))}),p(13,Mt,2,2,"mat-option",6),M(14,"async"),r()(),n(15,"mat-form-field",3)(16,"mat-label"),a(17,"Course ID"),r(),f(18,"input",7),n(19,"mat-hint"),a(20,"Selected from course search above"),r()(),n(21,"mat-form-field",3)(22,"mat-label"),a(23,"Title"),r(),f(24,"input",8),r(),n(25,"mat-form-field",3)(26,"mat-label"),a(27,"Description"),r(),f(28,"textarea",9),r(),p(29,Et,4,0,"mat-form-field",10),n(30,"div",11)(31,"button",12),C("click",function(){return d(c),u(i.goBack())}),a(32,"Cancel"),r(),n(33,"button",13),a(34),r()()()()()()}if(t&2){let c=B(12);s(4),I(i.isEditMode?"Edit Topic"+(i.topicId?" (ID: "+i.topicId+")":""):"Add New Topic"),s(2),l("formGroup",i.topicForm),s(4),l("matAutocomplete",c),s(),l("displayWith",i.displayCourseFn),s(2),l("ngForOf",N(14,8,i.filteredCourses)),s(16),l("ngIf",i.isEditMode),s(4),l("disabled",i.topicForm.invalid),s(),g(" ",i.isEditMode?"Update":"Create"," ")}},dependencies:[$,k,P,R,W,ve,H,Se,j,ye,Me,be,Ie,xe,ee,Z,Y,we,ie,te,re,oe,X,U,K,Q,J,le,se,q,ce,ae],styles:[".container[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px;margin-top:20px}"]})};var xi=[{path:"",component:de},{path:"add",component:E},{path:"update/:id",component:E}];export{xi as TOPICS_ROUTES};
